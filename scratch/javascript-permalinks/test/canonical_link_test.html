<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>CanonicalLink Test</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src="assets/jsunittest.js" type="text/javascript"></script>
    <script src="../permalinks.user.js" type="text/javascript"></script>
    <link rel="stylesheet" href="assets/unittest.css" type="text/css" />
  </head>
  <body>

    <div id="content">

      <div id="header">
        <h1>JavaScript unit test file</h1>
      </div>

      <!-- Log output (one per Runner, via {testLog: "testlog"} option)-->
      <div id="testlog"></div>
  
      <!-- Put sample/test html here -->
      <div id="sample">
      </div>
    </div>

    <script type="text/javascript">
    // <![CDATA[
      new Test.Unit.Runner({
        setup: function() {
          // Set the playing field by removing any link rel=canonical elements
          var linkElements = document.getElementsByTagName('link');
          for (var i = 0; i < linkElements.length; i++) {
            if (linkElements[i].getAttribute('rel') == 'canonical') {
              linkElements[i].parentNode.removeChild(linkElements[i]);
            }
          }
        },
    
        teardown: function() {
        },

        'test should write the canonical link element into the head of the document if permalink href returns a non-empty string': function() { with(this) {
          var permalink = {
            'href' : function() {
              return 'http://localhost';
            }
          }
          var linkElements = document.getElementsByTagName('link');
          for (var i = 0; i < linkElements.length; i++) {
            assertNotEqual('canonical', linkElements[i].getAttribute('rel'));
          }
          CanonicalLink.write(permalink);
          for (var i = 0; i < linkElements.length; i++) {
            if (linkElements[i].getAttribute('rel') == 'canonical') {
              assertEqual('http://localhost', linkElements[i].getAttribute('href'));
            }
          }
        }},
        
        'test should not write the canonical link element into the document if the permalink returns an empty string': function() { with(this) {
          var permalink = {
            'href' : function() {
              return '';
            }
          }
          var linkElements = document.getElementsByTagName('link');
          for (var i = 0; i < linkElements.length; i++) {
            assertNotEqual('canonical', linkElements[i].getAttribute('rel'));
          }
          CanonicalLink.write(permalink);
          for (var i = 0; i < linkElements.length; i++) {
            assertNotEqual('canonical', linkElements[i].getAttribute('rel'));
          }
        }}

      }); 
    // ]]>
    </script>
  </body>
</html>