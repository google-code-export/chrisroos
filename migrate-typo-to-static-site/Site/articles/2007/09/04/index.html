<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

  <head>
    <meta name="microid" content="ff511e16d7108be450fccd6f4611cf8d1d5416d1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/DeferredUntilInspirationHits" />
    <link rel="stylesheet" href="/stylesheets/azure.css" media="all" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/print.css" media="print" type="text/css" />
    <link rel="openid.server" href="http://www.myopenid.com/server"/>
    <link rel="openid.delegate" href="http://chrisroos.myopenid.com/"/>
    <title>Posts published on Tue, 04 September 2007 - deferred until inspiration hits</title>
  </head>

  <body>
  
    <div id="container" class="clearfix">
    
      <div id="header">
        <div id="logo">
          <h1 id="sitename"><a href="/">deferred until inspiration hits</a></h1>
        </div>
      </div>

      <div id="search">
      </div>

      <div id="content" class="clearfix">

        <div id="main">

          
            <div class="post">
              <h2>
                <a href="/articles/2007/09/04/permalinks-for-del-icio-us-bookmarks-posts">Permalinks for del.icio.us bookmarks (posts)</a>
              </h2>
              <p class="auth">
                Posted by Chris Roos
                <span class="typo_date" title="Tue, 04 Sep 2007 23:23:00">
                  Tue, 04 Sep 2007 23:23:00
                </span>
              </p>
          
              <p>I&#8217;ve wondered in the <a href="http://tech.groups.yahoo.com/group/ydn-delicious/message/1447">past</a> about sending <a href="http://en.wikipedia.org/wiki/Trackback">trackbacks</a> (or <a href="http://en.wikipedia.org/wiki/Pingback">pingbacks</a>) to bookmarked resources on <a href="http://del.icio.us">del.icio.us</a>.  As with most things, you can either wait for someone to do it for you, or you can do it yourself&#8230;  I started to investigate last Thursday afternoon and soon got sucked into the much more interesting issue of the missing <a href="http://en.wikipedia.org/wiki/Permalink">permalinks</a> for bookmarks.  You see, every time you bookmark something on del.icio.us, you are creating a new <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer#REST.27s_Central_Principle:_Resources">resource</a>.  Unfortunately, it&#8217;s a very sad :-( resource.  Sad because it doesn&#8217;t have a <a href="http://www.wikipedia.org/wiki/URL"><span class="caps">URL</span></a> and so can&#8217;t be linked to.  An anonymous resource floating around the world wide web looking for love.  Boo hoo.  Anyway, enough of that.  I figured that if we could assign a unique tag to each of these resources then they would, as a side effect, get a permalink (you can already get your bookmarks containing a given tag by using http://del.icio.us/USERNAME/MY_TAG).  I experimented with using the url as a tag.  Although there seem to be some limits on what you can use, I found that if you strip the protocol and trailing slash from a url you are generally OK.  So, if we bookmark <a href="http://news.bbc.co.uk"><span class="caps">BBC</span> News</a> and tag it with news.bbc.co.uk then we can access that individual bookmark at <a href="http://del.icio.us/chrisjroos/news.bbc.co.uk">http://del.icio.us/chrisjroos/news.bbc.co.uk</a>.</p>


	<p><a href="http://flickr.com/photos/chrisjroos/1293075032/"><img src="http://farm2.static.flickr.com/1140/1293075032_372cce286d_m.jpg" alt="" /></a></p>


	<p>As you can only bookmark the same <span class="caps">URL</span> once, it should guarantee that the url-tag is unique.  I can, however, see a problem with the trailing slash.  Although it&#8217;s possible to bookmark URLs that differ only in the trailing slash (http://example.com/article1 and http://example.com/article1/ for example), it doesn&#8217;t seem possible to create a tag that contains that same trailing slash.  OK, so we could always ensure that we remove the trailing slashes from the URLs we bookmark but that doesn&#8217;t seem like a very robust solution.</p>


	<p>While experimenting, I found that I could use forward slashes within my tags, www.foo.com/bar/baz for example.  So, I started prepending url/ to my url-tag so that I could easily recognise posts that already had permalinks.  It was at this time that I noticed the similarity between the del.icio.us url history page del.icio.us/url/MD5_OF_URL (e.g. <a href="http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151"><span class="caps">BBC</span> News</a>) and my permalinked bookmark, del.icio.us/chrisjroos/url/URL.  If I was to <a href="http://en.wikipedia.org/wiki/MD5">hash</a> the bookmarked url in the same way as del.icio.us then I would end up with a url like del.icio.us/chrisjroos/url/MD5_OF_URL.  You can see the similarity in the URLs below.</p>


	<ul>
	<li><a href="http://del.icio.us/chrisjroos/url/4961e08b5118fbfddec7fb18fa303151">http://del.icio.us/chrisjroos/url/4961e08b5118fbfddec7fb18fa303151</a></li>
		<li><a href="http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151">http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151</a></li>
	</ul>


	<p>It looks as though it&#8217;s part of del.icio.us itself doesn&#8217;t it?  Cool huh.  It&#8217;d be really cool to extend the del.icio.us <a href="http://www.mozilla.com/en-US/firefox/">firefox</a> <a href="https://addons.mozilla.org/en-US/firefox/addon/1532">extension</a> to automatically add this tag when bookmarking a site.</p>


	<p>I&#8217;ve created a crappy script that will add this url/MD5_OF_URL tag to each of your posts.  It&#8217;s hosted on <a href="http://chrisroos.googlecode.com/svn/trunk/delicious_url_tags">google code</a> and pasted below.  Err, use at your own risk by the way.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">USERNAME</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_USERNAME</span><span class="punct">'</span>
<span class="constant">PASSWORD</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_PASSWORD</span><span class="punct">'</span>
<span class="constant">POSTS_CACHE</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">FILE_TO_STORE_YOUR_EXISTING_DELICIOUS_POSTS_IN</span><span class="punct">'</span>

<span class="comment"># GET ALL POSTS</span>
<span class="keyword">unless</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">exists?</span><span class="punct">(</span><span class="constant">POSTS_CACHE</span><span class="punct">)</span>
  <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Downloading all posts...</span><span class="punct">&quot;</span>
  <span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">&lt;&lt;-</span><span class="constant">EndCurl</span><span class="string">
curl &quot;https://api.del.icio.us/v1/posts/all&quot; <span class="escape">\
</span>-u&quot;<span class="expr">#{USERNAME}</span>:<span class="expr">#{PASSWORD}</span>&quot; <span class="escape">\
</span>-s
&gt; <span class="expr">#{POSTS_CACHE}</span></span><span class="constant">
  EndCurl</span>
  `<span class="comment">#{curl_cmd}`</span>
<span class="keyword">end</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">hpricot</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">md5</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">cgi</span><span class="punct">'</span>

<span class="keyword">def </span><span class="method">add_url_hash_to_post</span><span class="punct">(</span><span class="ident">post</span><span class="punct">)</span>
  <span class="ident">url</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">post</span><span class="punct">['</span><span class="string">href</span><span class="punct">'])</span>
  <span class="ident">url_hash</span> <span class="punct">=</span> <span class="constant">MD5</span><span class="punct">.</span><span class="ident">md5</span><span class="punct">(</span><span class="ident">url</span><span class="punct">)</span>
  <span class="ident">url</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="ident">url</span><span class="punct">)</span>

  <span class="ident">tags</span> <span class="punct">=</span> <span class="ident">post</span><span class="punct">['</span><span class="string">tag</span><span class="punct">'].</span><span class="ident">split</span><span class="punct">('</span><span class="string"> </span><span class="punct">').</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">tag</span><span class="punct">|</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">tag</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="ident">tags</span> <span class="punct">&lt;&lt;</span> <span class="punct">&quot;</span><span class="string">url/<span class="expr">#{url_hash}</span></span><span class="punct">&quot;</span> <span class="keyword">unless</span> <span class="ident">tags</span><span class="punct">.</span><span class="ident">include?</span><span class="punct">(&quot;</span><span class="string">url/<span class="expr">#{url_hash}</span></span><span class="punct">&quot;)</span>
  <span class="ident">tags</span> <span class="punct">=</span> <span class="ident">tags</span><span class="punct">.</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">tag</span><span class="punct">|</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="ident">tag</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="ident">tags</span> <span class="punct">=</span> <span class="ident">tags</span><span class="punct">.</span><span class="ident">join</span><span class="punct">('</span><span class="string"> </span><span class="punct">')</span>

  <span class="ident">shared</span> <span class="punct">=</span> <span class="ident">post</span><span class="punct">['</span><span class="string">shared</span><span class="punct">']</span>
  <span class="ident">description</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">post</span><span class="punct">['</span><span class="string">description</span><span class="punct">']))</span>
  <span class="ident">extended</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">post</span><span class="punct">['</span><span class="string">extended</span><span class="punct">']))</span>

  <span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">&lt;&lt;-</span><span class="constant">EndCurl</span><span class="string">
curl &quot;https://api.del.icio.us/v1/posts/add&quot; <span class="escape">\
</span>-u&quot;<span class="expr">#{USERNAME}</span>:<span class="expr">#{PASSWORD}</span>&quot; <span class="escape">\
</span>-d&quot;url=<span class="expr">#{url}</span>&quot; <span class="escape">\
</span>-d&quot;description=<span class="expr">#{description}</span>&quot; <span class="escape">\
</span>-d&quot;extended=<span class="expr">#{extended}</span>&quot; <span class="escape">\
</span>-d&quot;tags=<span class="expr">#{tags}</span>&quot; <span class="escape">\
</span>-d&quot;shared=<span class="expr">#{shared}</span>&quot; <span class="escape">\
</span>-s
</span><span class="constant">  EndCurl</span>
  `<span class="comment">#{curl_cmd}`</span>
<span class="keyword">end</span>

<span class="comment"># ADD THE URL/&lt;md5_hash&gt; TAG TO EACH POST</span>
<span class="ident">posts_xml</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">open</span><span class="punct">(</span><span class="constant">POSTS_CACHE</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">f</span><span class="punct">|</span> <span class="ident">f</span><span class="punct">.</span><span class="ident">read</span> <span class="punct">}</span>
<span class="ident">posts_doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">posts_xml</span><span class="punct">)</span>
<span class="ident">count</span> <span class="punct">=</span> <span class="number">1</span>
<span class="punct">(</span><span class="ident">posts_doc</span><span class="punct">/'</span><span class="string">posts</span><span class="punct">'/'</span><span class="string">post</span><span class="punct">').</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">post_xml</span><span class="punct">|</span>
  <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Bookmark: <span class="expr">#{count}</span></span><span class="punct">&quot;</span> <span class="keyword">if</span> <span class="punct">(</span><span class="ident">count</span> <span class="punct">%</span> <span class="number">5</span><span class="punct">)</span> <span class="punct">==</span> <span class="number">0</span>
  <span class="ident">add_url_hash_to_post</span><span class="punct">(</span><span class="ident">post_xml</span><span class="punct">.</span><span class="ident">attributes</span><span class="punct">)</span>
  <span class="ident">count</span> <span class="punct">+=</span> <span class="number">1</span>
<span class="keyword">end</span></code></pre></div>
            </div>
        
            <p class="meta">
              
                Tags 
                
                  <a href="/articles/tag/bookmark" rel="tag">bookmark</a>, 
                
                  <a href="/articles/tag/cool" rel="tag">cool</a>, 
                
                  <a href="/articles/tag/curl" rel="tag">curl</a>, 
                
                  <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                
                  <a href="/articles/tag/permalink" rel="tag">permalink</a>, 
                
                  <a href="/articles/tag/pingback" rel="tag">pingback</a>, 
                
                  <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                
                  <a href="/articles/tag/trackback" rel="tag">trackback</a>, 
                
              
            </p>
          

        </div>

        <div id="sidebar">

          <div class="sidebar-node">
            <h3>Syndicate</h3>
            <a href="http://feeds.feedburner.com/DeferredUntilInspirationHits" title="Subscribe to my feed, deferred until inspiration hits" rel="alternate" type="application/rss+xml">
              <img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="border:0"/> 
              Subscribe to the feed
            </a>
          </div>

        </div>

        <br clear="all" />

      </div>
    
      <div id="footer">
      </div>

    </div>
  
  </body>

</html>