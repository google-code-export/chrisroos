<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
    <!--#include virtual="/includes/_head.html"-->
    <title>Web service to convert UK Postcodes (outcode) to Latitude and Longitude - deferred until inspiration hits</title>
  </head>

  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <div class="header">
          <!--#include virtual="/includes/_header.html"-->
        </div>
        <div class="navigation">
          
            <span class="previousPost">
              &larr; (older)
              <a class="previousPost" href="/blog/2007-07-12-wesabe-open-up-their-api-and-ask-me-to-help-write-their-press-release" title="Wesabe open up their API and ask me to help write their press release...">
                
                Wesabe open up their API and ask me to help write their ...
              </a> 
            </span>
          
          
            <span class="nextPost">
              <a class="nextPost" href="/blog/2007-07-17-free-google-website-optimizer-isnt-actually-free" title="Free google website optimizer isn't actually free">
                
                Free google website optimizer isn't actually free
              </a> (newer) &rarr;
            </span>
          
        </div>
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">
              
              <h1>Web service to convert UK Postcodes (outcode) to Latitude and Longitude</h1>
            
              <p class="postedOn">
                Posted by Chris Roos
                <span title="Fri, 13 Jul 2007 14:41:00">
                  Fri, 13 Jul 2007 14:41:00
                </span>
              </p>
          
              <p>Using the data supplied in this <a href="http://postcodes.easypeasy.com">article</a>, by <a href="http://www.niksargent.com">Nik Sargent</a>, I&#8217;ve created a simple web service that returns <a href="http://www.json.org"><span class="caps">JSON</span></a> formatted data about UK Outcodes (the first bit of the postcode).</p>


	<p>The idea is that you can request, for example, /postcodes/se1 and get some json in return.  For se1, we receive the following data.</p>


<div class="typocode"><pre><code class="javascript">
{"latitude":"51.498","x":"532600","postcode":"SE1","y":"179500","longitude":"51.498"}
</code></pre></div>

	<p>The service is currently running at <a href="http://seagul.co.uk/postcodes">http://seagul.co.uk/postcodes</a> (<a href="http://seagul.co.uk/postcodes/se1">se1</a>) but I make no guarantees as to its reliability.  I&#8217;d suggest that if anyone actually finds this useful that they go host it somewhere for themselves in order to control the availability.</p>


	<p>The code is, as always, on <a href="http://chrisroos.googlecode.com/svn/trunk/uk-postcodes/">google code</a> and pasted below.</p>


	<p>I&#8217;ve created it as a proof of concept but I figure that, given a little love, it may prove useful to some folks.</p>


<div class="typocode"><pre><code class="ruby">
require 'rubygems'
require 'mongrel'
require 'json'

postcodes_file = File.dirname(__FILE__) + '/uk-postcodes.json'
Postcodes = JSON.parse(File.open(postcodes_file) { |f| f.read })
Index = Postcodes.inject([]) { |index, postcode| index &lt;&lt; postcode['postcode'].downcase }

class PostcodeHandler &lt; Mongrel::HttpHandler
  def process(request, response)
    outcode = request.params['PATH_INFO'].sub(/^\//, '').downcase
    postcode_index = Index.index(outcode)
    if postcode_index
      response.start do |head, out|
        head["Content-Type"] = "text/plain" 
        out &lt;&lt; Postcodes[postcode_index].to_json
      end
    else
      response.start(404) do |head,out|
        out &lt;&lt; "Postcode not found\n" 
      end
    end
  end
end

config = Mongrel::Configurator.new :host =&gt; 'localhost', :port =&gt; '4000' do
  listener do
    uri "/postcodes", :handler =&gt; PostcodeHandler.new
  end
  trap("INT") { stop }
  run
end

config.join
</code></pre></div>
        
              <div id="disqus_thread"></div>
              <script type="text/javascript" src="http://disqus.com/forums/deferred-until-inspiration-hits/embed.js"></script>
              <noscript>
                <p><a href="http://deferred-until-inspiration-hits.disqus.com/?url=ref">View the forum thread.</a></p>
              </noscript>

            </div>
          </div>
        </div>
        <div class="yui-b">
          <!--#include virtual="/includes/_navigation.html"-->
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <!--#include virtual="/includes/_twitter.html" -->
    <!--#include virtual="/includes/_delicious.html" -->
    <!--#include virtual="/includes/_google_analytics.html" -->
  </body>

</html>
