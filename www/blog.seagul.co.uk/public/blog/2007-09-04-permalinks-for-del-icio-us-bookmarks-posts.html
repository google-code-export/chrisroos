<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
    <!--#include virtual="/includes/_head.html"-->
    <title>Permalinks for del.icio.us bookmarks (posts) - deferred until inspiration hits</title>
  </head>

  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <div class="header">
          <!--#include virtual="/includes/_header.html"-->
        </div>
        <div class="navigation">
          
            <span class="previousPost">
              &larr; (older)
              <a class="previousPost" href="/blog/2007-08-31-blue-card-user-stories-coming-out-of-the-reevoo-com-feedback" title="Blue card user stories coming out of the reevoo.com feedback">
                
                Blue card user stories coming out of the reevoo.com feed...
              </a> 
            </span>
          
          
            <span class="nextPost">
              <a class="nextPost" href="/blog/2007-09-05-patching-the-del-icio-us-firefox-extension-to-add-permalinks" title="Patching the del.icio.us firefox extension to add permalinks">
                
                Patching the del.icio.us firefox extension to add permal...
              </a> (newer) &rarr;
            </span>
          
        </div>
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">
              
              <h1>Permalinks for del.icio.us bookmarks (posts)</h1>
            
              <p class="postedOn">
                Posted by Chris Roos
                <span title="Tue, 04 Sep 2007 23:23:00">
                  Tue, 04 Sep 2007 23:23:00
                </span>
              </p>
          
              <p>I&#8217;ve wondered in the <a href="http://tech.groups.yahoo.com/group/ydn-delicious/message/1447">past</a> about sending <a href="http://en.wikipedia.org/wiki/Trackback">trackbacks</a> (or <a href="http://en.wikipedia.org/wiki/Pingback">pingbacks</a>) to bookmarked resources on <a href="http://del.icio.us">del.icio.us</a>.  As with most things, you can either wait for someone to do it for you, or you can do it yourself&#8230;  I started to investigate last Thursday afternoon and soon got sucked into the much more interesting issue of the missing <a href="http://en.wikipedia.org/wiki/Permalink">permalinks</a> for bookmarks.  You see, every time you bookmark something on del.icio.us, you are creating a new <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer#REST.27s_Central_Principle:_Resources">resource</a>.  Unfortunately, it&#8217;s a very sad :-( resource.  Sad because it doesn&#8217;t have a <a href="http://www.wikipedia.org/wiki/URL"><span class="caps">URL</span></a> and so can&#8217;t be linked to.  An anonymous resource floating around the world wide web looking for love.  Boo hoo.  Anyway, enough of that.  I figured that if we could assign a unique tag to each of these resources then they would, as a side effect, get a permalink (you can already get your bookmarks containing a given tag by using http://del.icio.us/USERNAME/MY_TAG).  I experimented with using the url as a tag.  Although there seem to be some limits on what you can use, I found that if you strip the protocol and trailing slash from a url you are generally OK.  So, if we bookmark <a href="http://news.bbc.co.uk"><span class="caps">BBC</span> News</a> and tag it with news.bbc.co.uk then we can access that individual bookmark at <a href="http://del.icio.us/chrisjroos/news.bbc.co.uk">http://del.icio.us/chrisjroos/news.bbc.co.uk</a>.</p>


	<p><a href="http://flickr.com/photos/chrisjroos/1293075032/"><img src="http://farm2.static.flickr.com/1140/1293075032_372cce286d_m.jpg" alt="" /></a></p>


	<p>As you can only bookmark the same <span class="caps">URL</span> once, it should guarantee that the url-tag is unique.  I can, however, see a problem with the trailing slash.  Although it&#8217;s possible to bookmark URLs that differ only in the trailing slash (http://example.com/article1 and http://example.com/article1/ for example), it doesn&#8217;t seem possible to create a tag that contains that same trailing slash.  OK, so we could always ensure that we remove the trailing slashes from the URLs we bookmark but that doesn&#8217;t seem like a very robust solution.</p>


	<p>While experimenting, I found that I could use forward slashes within my tags, www.foo.com/bar/baz for example.  So, I started prepending url/ to my url-tag so that I could easily recognise posts that already had permalinks.  It was at this time that I noticed the similarity between the del.icio.us url history page del.icio.us/url/MD5_OF_URL (e.g. <a href="http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151"><span class="caps">BBC</span> News</a>) and my permalinked bookmark, del.icio.us/chrisjroos/url/URL.  If I was to <a href="http://en.wikipedia.org/wiki/MD5">hash</a> the bookmarked url in the same way as del.icio.us then I would end up with a url like del.icio.us/chrisjroos/url/MD5_OF_URL.  You can see the similarity in the URLs below.</p>


	<ul>
	<li><a href="http://del.icio.us/chrisjroos/url/4961e08b5118fbfddec7fb18fa303151">http://del.icio.us/chrisjroos/url/4961e08b5118fbfddec7fb18fa303151</a></li>
		<li><a href="http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151">http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151</a></li>
	</ul>


	<p>It looks as though it&#8217;s part of del.icio.us itself doesn&#8217;t it?  Cool huh.  It&#8217;d be really cool to extend the del.icio.us <a href="http://www.mozilla.com/en-US/firefox/">firefox</a> <a href="https://addons.mozilla.org/en-US/firefox/addon/1532">extension</a> to automatically add this tag when bookmarking a site.</p>


	<p>I&#8217;ve created a crappy script that will add this url/MD5_OF_URL tag to each of your posts.  It&#8217;s hosted on <a href="http://chrisroos.googlecode.com/svn/trunk/delicious_url_tags">google code</a> and pasted below.  Err, use at your own risk by the way.</p>


<div class="typocode"><pre><code class="ruby">
USERNAME = 'YOUR_USERNAME'
PASSWORD = 'YOUR_PASSWORD'
POSTS_CACHE = 'FILE_TO_STORE_YOUR_EXISTING_DELICIOUS_POSTS_IN'

# GET ALL POSTS
unless File.exists?(POSTS_CACHE)
  puts "Downloading all posts..." 
  curl_cmd = &lt;&lt;-EndCurl
curl "https://api.del.icio.us/v1/posts/all" \
-u"#{USERNAME}:#{PASSWORD}" \
-s
&gt; #{POSTS_CACHE}
  EndCurl
  `#{curl_cmd}`
end

require 'hpricot'
require 'md5'
require 'cgi'

def add_url_hash_to_post(post)
  url = CGI.unescapeHTML(post['href'])
  url_hash = MD5.md5(url)
  url = CGI.escape(url)

  tags = post['tag'].split(' ').collect { |tag| CGI.unescapeHTML(tag) }
  tags &lt;&lt; "url/#{url_hash}" unless tags.include?("url/#{url_hash}")
  tags = tags.collect { |tag| CGI.escape(tag) }
  tags = tags.join(' ')

  shared = post['shared']
  description = CGI.escape(CGI.unescapeHTML(post['description']))
  extended = CGI.escape(CGI.unescapeHTML(post['extended']))

  curl_cmd = &lt;&lt;-EndCurl
curl "https://api.del.icio.us/v1/posts/add" \
-u"#{USERNAME}:#{PASSWORD}" \
-d"url=#{url}" \
-d"description=#{description}" \
-d"extended=#{extended}" \
-d"tags=#{tags}" \
-d"shared=#{shared}" \
-s
  EndCurl
  `#{curl_cmd}`
end

# ADD THE URL/&lt;md5_hash&gt; TAG TO EACH POST
posts_xml = File.open(POSTS_CACHE) { |f| f.read }
posts_doc = Hpricot(posts_xml)
count = 1
(posts_doc/'posts'/'post').each do |post_xml|
  puts "Bookmark: #{count}" if (count % 5) == 0
  add_url_hash_to_post(post_xml.attributes)
  count += 1
end
</code></pre></div>
        
              <div id="disqus_thread"></div>
              <script type="text/javascript" src="http://disqus.com/forums/deferred-until-inspiration-hits/embed.js"></script>
              <noscript>
                <p><a href="http://deferred-until-inspiration-hits.disqus.com/?url=ref">View the forum thread.</a></p>
              </noscript>

            </div>
          </div>
        </div>
        <div class="yui-b">
          <!--#include virtual="/includes/_navigation.html"-->
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <!--#include virtual="/includes/_twitter.html" -->
    <!--#include virtual="/includes/_delicious.html" -->
    <!--#include virtual="/includes/_google_analytics.html" -->
  </body>

</html>
