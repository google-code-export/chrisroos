<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
    <!--#include virtual="/includes/_head.html"-->
    <title>Crappy ruby script to download photos from a flickr photoset - deferred until inspiration hits</title>
  </head>

  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <div class="header">
          <!--#include virtual="/includes/_header.html"-->
        </div>
        <div class="navigation">
          
            <span class="previousPost">
              &larr; (older)
              <a class="previousPost" href="/blog/2006-11-29-del-icio-us-as-a-simple-to-do-list" title="del.icio.us as a simple to do list">
                
                del.icio.us as a simple to do list
              </a> 
            </span>
          
          
            <span class="nextPost">
              <a class="nextPost" href="/blog/2006-12-13-reevoo-com-dips-its-toes-into-the-opensearch-water" title="Reevoo.com dips its toes into the opensearch water">
                
                Reevoo.com dips its toes into the opensearch water
              </a> (newer) &rarr;
            </span>
          
        </div>
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">
              
              <h1>Crappy ruby script to download photos from a flickr photoset</h1>
            
              <p class="postedOn">
                Posted by Chris Roos
                <span title="Sun, 10 Dec 2006 16:55:00">
                  Sun, 10 Dec 2006 16:55:00
                </span>
              </p>
          
              <p>So, it seems far more difficult than it should be to retrieve a bunch of <strong>my</strong> photos from flickr.com.  Having unsuccessfully experimented with some of the flickr libs on <a href="http://www.rubyforge.org">rubyforge</a> I hacked this together.</p>


	<p><strong><span class="caps">UPDATE</span></strong>: Something caused curl to get &#8216;stuck&#8217; downloading a particular picture so I amended the script to ensure it ignores already downloaded files.</p>


	<p><strong><span class="caps">UPDATE 2</span></strong>: Surround output filename with quotes.</p>


<div class="code"><pre><code class="ruby">
require 'cgi'

API_KEY = 'YOUR_API_KEY'
PHOTOSET_ID = 'YOUR_PHOTOSET_ID'
LOCAL_PHOTO_DIR = '/users/chrisroos/desktop/photos/'

curl_cmd = %[curl "http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&#38;api_key=#{API_KEY}&#38;photoset_id=#{PHOTOSET_ID}"]
photoset_photos = `#{curl_cmd}`

number_of_photos = photoset_photos.scan(/&lt;photo .*&gt;/).size
current_photo = 0

photoset_photos.scan(/&lt;photo .*&gt;/) do |line|
  current_photo += 1

  photo_id = line[/id="(\d+)"/, 1]
  photo_secret = line[/secret="(\w+)"/, 1]
  photo_server = line[/server="(\d+)"/, 1]
  photo_title = line[/title="(.+?)"/, 1]

  url = "http://static.flickr.com/#{photo_server}/#{photo_id}_#{photo_secret}_o_d.jpg" 
  filename = CGI.unescapeHTML(photo_title).gsub(/ |&#38;|,|-/, '_').gsub(/'/, '').downcase.squeeze('_') + '_' + photo_id + '.jpg' # Sanitize title to use as filename
  filepath = LOCAL_PHOTO_DIR + filename

  if File.exists?(filepath)
    puts "Skipping photo (already downloaded) #{current_photo} of #{number_of_photos}" 
  else
    puts "Retrieving photo #{current_photo} of #{number_of_photos}" 
    curl_cmd = %[curl "#{url}" &gt; "#{filepath}"]
    `#{curl_cmd}`
  end
end
</code></pre></div>
        
              <div id="disqus_thread"></div>
              <script type="text/javascript" src="http://disqus.com/forums/deferred-until-inspiration-hits/embed.js"></script>
              <noscript>
                <p><a href="http://deferred-until-inspiration-hits.disqus.com/?url=ref">View the forum thread.</a></p>
              </noscript>

            </div>
          </div>
        </div>
        <div class="yui-b">
          <!--#include virtual="/includes/_navigation.html"-->
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <!--#include virtual="/includes/_twitter.html" -->
    <!--#include virtual="/includes/_delicious.html" -->
    <!--#include virtual="/includes/_google_analytics.html" -->
  </body>

</html>
