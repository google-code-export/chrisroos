<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

  <head>
    <!--#include virtual="/includes/_head.html"-->
    <title>Posts published in October 2006 - deferred until inspiration hits</title>
    <meta name="robots" content="noindex" />
  </head>
  
  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <!--#include virtual="/includes/_header.html"-->
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">

              
                <h2>
                  <a href="/articles/2006/10/24/connecting-to-gmail-with-ruby-or-connecting-to-pop3-servers-over-ssl-with-ruby">Connecting to gmail with Ruby (or Connecting to POP3 servers over SSL with Ruby)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 24 Oct 2006 22:42:00">
                    Tue, 24 Oct 2006 22:42:00
                  </span>
                </p>

                <h3>Short version (or, &#8220;I want to connect to gmail <span class="caps">NOW</span>&#8221;)</h3>


	<ul>
	<li>Download the <a href="http://ruby-doc.org/stdlib-1.9/libdoc/net/pop/rdoc/index.html">pop3 library</a> from <a href="http://www.ruby-lang.org/cgi-bin/cvsweb.cgi//?only_with_tag=HEAD">Ruby <span class="caps">HEAD</span></a> (Ruby 1.9) (<a href="http://www.ruby-lang.org/cgi-bin/cvsweb.cgi/~checkout~/ruby/lib/net/pop.rb?rev=1.73;content-type=application%2Fx-ruby;only_with_tag=HEAD">download file</a>)</li>
		<li>Use the following script to get started (making sure that you explicitly reference the downloaded pop3 file)...</li>
	</ul>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">pop_ssl</span><span class="punct">'</span> <span class="comment"># I renamed the file from pop.rb to pop_ssl.rb to ensure I was requiring the correct version</span>

<span class="ident">username</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_GMAIL_USERNAME@gmail.com</span><span class="punct">'</span>
<span class="ident">password</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_GMAIL_PASSWORD</span><span class="punct">'</span>

<span class="constant">Net</span><span class="punct">::</span><span class="constant">POP3</span><span class="punct">.</span><span class="ident">enable_ssl</span><span class="punct">(</span><span class="constant">OpenSSL</span><span class="punct">::</span><span class="constant">SSL</span><span class="punct">::</span><span class="constant">VERIFY_NONE</span><span class="punct">)</span>
<span class="constant">Net</span><span class="punct">::</span><span class="constant">POP3</span><span class="punct">.</span><span class="ident">start</span><span class="punct">('</span><span class="string">pop.gmail.com</span><span class="punct">',</span> <span class="number">995</span><span class="punct">,</span> <span class="ident">username</span><span class="punct">,</span> <span class="ident">password</span><span class="punct">)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">pop</span><span class="punct">|</span>
  <span class="keyword">if</span> <span class="ident">pop</span><span class="punct">.</span><span class="ident">mails</span><span class="punct">.</span><span class="ident">empty?</span>
    <span class="ident">puts</span> <span class="punct">'</span><span class="string">No mail.</span><span class="punct">'</span>
  <span class="keyword">else</span>
    <span class="ident">pop</span><span class="punct">.</span><span class="ident">each_mail</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">mail</span><span class="punct">|</span>
      <span class="ident">p</span> <span class="ident">mail</span><span class="punct">.</span><span class="ident">header</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<h3>Medium version (or, &#8220;Let me know I&#8217;m connecting to the correct site, Dammit&#8221;)</h3>


	<p>This is identical to the short version except that we verify the ssl certificate this time round.</p>


	<ul>
	<li>Follow the first step above (i.e. download new version of pop3 lib).</li>
		<li>Download the CA Root Certificates bundle from <a href="http://curl.haxx.se/">cURL site</a> (<a href="http://curl.haxx.se/ca/cacert.pem">download file</a>)</li>
		<li>Copy the code above but change the Net::POP3.enable_ssl line to read&#8230;</li>
	</ul>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Net</span><span class="punct">::</span><span class="constant">POP3</span><span class="punct">.</span><span class="ident">enable_ssl</span><span class="punct">(</span><span class="constant">OpenSSL</span><span class="punct">::</span><span class="constant">SSL</span><span class="punct">::</span><span class="constant">VERIFY_PEER</span><span class="punct">,</span> <span class="punct">'</span><span class="string">/PATH/TO/DOWNLOADED/cacert.pem</span><span class="punct">')</span></code></pre></div>

	<h3>Longer version (or, &#8220;Pray tell, how did you find this information sir&#8221;)</h3>


	<p>An explanation of how I got here.  Feel free to ignore.</p>


	<p>For a while I&#8217;ve wanted to play around with receiving emails within a <a href="http://www.rubyonrails.org">rails</a> app (with <a href="http://am.rubyonrails.org/files/README.html">action mailer</a>).  I had an hour or two free the other evening and so started to play.  First step was to take a look at the <a href="http://wiki.rubyonrails.org">rails wiki</a> and see that there&#8217;s already a <a href="http://wiki.rubyonrails.org/rails/pages/HowToReceiveEmailsWithActionMailer">page</a> detailing exactly what I wanted to do.  As I started reading, I was getting put off by the thought of configuring <a href="http://www.sendmail.org">sendmail</a> or some other &#8216;heavyweight&#8217; solution.  Luckily, someone has added a much better suggestion at the bottom of the page &#8211; using <a href="http://ruby-doc.org/stdlib/libdoc/net/pop/rdoc/index.html">net/pop</a> (or <a href="http://ruby-doc.org/stdlib/libdoc/net/imap/rdoc/index.html">net/imap</a>) to collect emails from a pre-configured mail server.  Although I use <a href="http://www.fastmail.co.uk">imap</a> for my own email provision, I wanted a pop server for testing.  Aha, I thought, I&#8217;ll just set-up another <a href="http://www.gmail.com">gmail</a> account and use that&#8230;  And that&#8217;s where the problems started.</p>


	<p>You see, gmail only accepts <a href="http://en.wikipedia.org/wiki/POP3"><span class="caps">POP3</span></a> connections over <a href="http://en.wikipedia.org/wiki/SSL"><span class="caps">SSL</span></a> (on port 995), a feature not found in our beloved net/pop library.  Hmm.  Time for some help from google.  The first page I <a href="http://involution.com/2006/07/20/access-gmail-from-ruby-using-netpop3-and-stunnel/">came across</a> described using <a href="http://www.stunnel.org">stunnel</a> to create an ssl tunnel to route standard net/pop traffic through.  This sounded great, except that I couldn&#8217;t get stunnel (v4.16) to compile on mac os x, although I didn&#8217;t try too hard&#8230;  The other point of interest in that original article was that the pop3 with ssl support was in development.  The next step was to track down some mailing list threads that talked about the ssl support and hope for a patch.  We&#8217;re in luck, the <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/2703">first patch</a> was actually submitted in March 2004, with the second, accepted and committed, <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/2745">patch</a> coming in April 2004.  As per the <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/2780">last message</a> in the second thread, the patch was accepted into core, and is now available in the 1.9 release.  So, we don&#8217;t even need to patch our existing copy of net/pop, we can just download the newer version.  I named this downloaded version as pop_ssl, to avoid confusion, and placed it in my ruby load path.</p>


	<p>Next step was to follow the example on the <a href="http://ruby-doc.org/stdlib-1.9/libdoc/net/pop/rdoc/classes/Net/POP3.html">net/pop3 page</a>, and, with the addition of the Net::POP3::enable_ssl directive, try to connect.  Hmm, things still weren&#8217;t working quite right.  I was getting the following error.</p>


<div class="typocode"><pre><code class="typocode_default">OpenSSL::SSL::SSLError: certificate verify failed</code></pre></div>

	<p>Some more googling led me to <a href="http://ghouston.blogspot.com/2006/03/using-ssl-with-ruby-http-access2.html">this post</a> by <a href="http://ghouston.blogspot.com/">Greg Houston</a>.  It turns out that the error is actually raised in the <a href="http://www.openssl.org">OpenSSL</a> layer.  It is caused by us trying to verify the server certificate without having the correct trusted root certificate.  It turns out that we can either disable the verification (by using <code>Net::POP3::enable_ssl(OpenSSL::SSL::VERIFY_NONE)</code>), or we can verify against a trusted root certificate bundle, like the one <a href="http://curl.haxx.se/docs/caextract.html">supplied</a> by cURL.  To verify using the certificate bundle from cURL (or similar), we would amend the above line of code to <code>Net::POP3.enable_ssl(OpenSSL::SSL::VERIFY_PEER, File.dirname(__FILE__) + '/PATH/TO/DOWNLOADED/cacert.pem')</code>.</p>


	<p>I can finally now get on with my rails app to retrieve emails from gmail.</p>


	<h3>Conclusion</h3>


	<ul>
	<li>I&#8217;ve spent a lot more than the intended couple of hours investigating this stuff, yet still have no rails app receiving emails (although I&#8217;m a lot closer now&#8230;)</li>
		<li>There&#8217;s very little information on the ssl enabled libraries (net/https, net/pop, http-access2 to name but a few) in ruby.  Maybe everybody else just knows about this stuff already, but I&#8217;m certainly pretty unclear.</li>
		<li>I have a feeling that it should be possible to use net/https to connect (unverified) to a site that uses ssl and obtain the certificate for use in subsequent verified connections.  Indeed, another <a href="http://curl.haxx.se/docs/sslcerts.html">document</a> hosted on curl.haxx.se seems to indicate that this is possible.</li>
		<li>I still know very little about ssl and certificates.</li>
		<li>I hope that what little information is here can help someone else in a similar situation.</li>
	</ul>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/gmail" rel="tag">gmail</a>, 
                    
                      <a href="/articles/tag/pop" rel="tag">pop</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/20/boolean-method-in-ruby-sibling-of-array-float-integer-and-string">Boolean method in Ruby (sibling of Array, Float, Integer and String) </a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 20 Oct 2006 00:19:00">
                    Fri, 20 Oct 2006 00:19:00
                  </span>
                </p>

                <p>I was reading in data from a file and expected one particular column to contain either &#8216;true&#8217; or &#8216;false&#8217;.  I wanted a nice way to convert the string representation into its object counterpart.  I thought to the Kernel#Float (and kin) and decided I wanted a Kernel#Boolean method.  So I made one.  Tada&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">module </span><span class="module">Kernel</span>

  <span class="keyword">def </span><span class="method">Boolean</span><span class="punct">(</span><span class="ident">string</span><span class="punct">)</span>
    <span class="keyword">return</span> <span class="constant">true</span> <span class="keyword">if</span> <span class="ident">string</span> <span class="punct">==</span> <span class="constant">true</span> <span class="punct">||</span> <span class="ident">string</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">^true$</span><span class="punct">/</span><span class="ident">i</span>
    <span class="keyword">return</span> <span class="constant">false</span> <span class="keyword">if</span> <span class="ident">string</span> <span class="punct">==</span> <span class="constant">false</span> <span class="punct">||</span> <span class="ident">string</span><span class="punct">.</span><span class="ident">nil?</span> <span class="punct">||</span> <span class="ident">string</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">^false$</span><span class="punct">/</span><span class="ident">i</span>
    <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(&quot;</span><span class="string">invalid value for Boolean: <span class="escape">\&quot;</span><span class="expr">#{string}</span><span class="escape">\&quot;</span></span><span class="punct">&quot;)</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="ident">require</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/../test_helper</span><span class="punct">'</span>

<span class="keyword">class </span><span class="class">KernelTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>

  <span class="keyword">def </span><span class="method">test_should_return_true</span>
    <span class="ident">assert_equal</span> <span class="constant">true</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">true</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">true</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">TrUe</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">true</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="constant">true</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_return_false</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="constant">nil</span><span class="punct">)</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">false</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">FaLsE</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="constant">false</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_raise_exception</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">true </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> true</span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> true </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">false </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> false</span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> false </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">BLAH</span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="number">1</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/18/inactive-keywords-too-high-mincpc-when-using-google-adwords-api">Inactive keywords (too high minCpc) when using Google Adwords Api</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 18 Oct 2006 07:40:00">
                    Wed, 18 Oct 2006 07:40:00
                  </span>
                </p>

                <h3>Short version</h3>


	<p><strong><span class="caps">ALWAYS</span></strong> create adverts (creatives) <strong>before</strong> keywords when setting up an ad group using the Adwords Api</p>


	<h3>Longer version</h3>


	<p>Our first use of the adwords api was to create around 850 ad groups, each with three text ads and one keyword.  Although the creation seemed to go to plan, a quick inspection in the adwords interface revealed that all of our ads were marked as inactive, with most of our keywords having a minimum bid of £2.50!</p>


	<p>Adding the exact same keywords and text ads manually resulted in active keywords, so we knew there was nothing wrong with our content.</p>


	<p>A few searches on google didn&#8217;t yield any relevant results, but searching the <a href="http://groups.google.com/group/adwords-api">adwords api google group</a> seemed to reveal other people having the same problem.  The solution was (and is) simple &#8211; ensure that you create your keywords <strong>after</strong> you&#8217;ve created your ad content.  Indeed, it is impossible to create them in any other order from within the adwords interface itself.</p>


	<p>Right now this is just a pain, as it needlessly wastes api quota &#8211; about 700,000 in our case.  Come  <a href="http://adwordsapi.blogspot.com/2006/09/deadline-for-registration-and-billing.html">November 1st</a> this will cost you hard cash &#8211; around £80.00 &#8211; £90 for our 700,000&#8217;ish.</p>


	<p>I&#8217;m hoping google will change their api to warn you when keywords are created before creatives, or, at the very least, make it extremely clear in the docs that there is an order in which the two should be created.  In the meantime, maybe this will help people searching google for an answer to the same problem.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/adwords" rel="tag">adwords</a>, 
                    
                      <a href="/articles/tag/api" rel="tag">api</a>, 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/14/some-useful-assertions-maybe">Some useful assertions, maybe</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 14 Oct 2006 10:27:00">
                    Sat, 14 Oct 2006 10:27:00
                  </span>
                </p>

                <p>The first is to ensure two arrays contain the same elements not necessarily in the same order.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">set</span><span class="punct">'</span>
<span class="keyword">module </span><span class="module">AssertEqualArray</span>

  <span class="keyword">def </span><span class="method">assert_equal_array</span><span class="punct">(</span><span class="ident">array_1</span><span class="punct">,</span> <span class="ident">array_2</span><span class="punct">)</span>
    <span class="ident">assert_equal</span> <span class="ident">array_1</span><span class="punct">.</span><span class="ident">size</span><span class="punct">,</span> <span class="ident">array_2</span><span class="punct">.</span><span class="ident">size</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">Arrays must be of the same size to be equal</span><span class="punct">&quot;</span>
    <span class="ident">assert_equal</span> <span class="ident">array_1</span><span class="punct">.</span><span class="ident">to_set</span><span class="punct">,</span> <span class="ident">array_2</span><span class="punct">.</span><span class="ident">to_set</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">Test::Unit::TestCase</span>
  <span class="ident">include</span> <span class="constant">AssertEqualArray</span>
<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">MyTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>

  <span class="keyword">def </span><span class="method">test_should_assert_equal_arrays</span>
    <span class="ident">assert_equal_array</span> <span class="punct">[</span><span class="number">1</span><span class="punct">,</span> <span class="number">2</span><span class="punct">,</span> <span class="number">3</span><span class="punct">],</span> <span class="punct">[</span><span class="number">2</span><span class="punct">,</span> <span class="number">1</span><span class="punct">,</span> <span class="number">3</span><span class="punct">]</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

	<p>The second is to test for generated warnings.  In my <a href="http://blog.seagul.co.uk/articles/2006/10/06/recording-daily-spending-with-a-ruby-dsl">current project</a> app, I use method_missing and wanted to warn the user if the unknown message looks like it&#8217;s supposed to be a payment mechanism&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">day</span> <span class="punct">'</span><span class="string">25-oct-2006</span><span class="punct">'</span> <span class="keyword">do</span>
  <span class="ident">cash</span> <span class="number">30.29</span><span class="punct">,</span> <span class="ident">beer</span>
<span class="keyword">end</span>

<span class="comment"># Results in NoMethodError and, more importantly, this friendly warning..</span>
<span class="comment"># Maybe you expected 'cash' to be a payment mechanism?</span>
<span class="comment"># Cool huh?</span></code></pre></div>

	<p>Anyway, I wanted a way to test that the warning was being generated and came up with another assertion&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">stringio</span><span class="punct">'</span>
<span class="keyword">module </span><span class="module">AssertWarning</span>

  <span class="keyword">def </span><span class="method">assert_warning</span><span class="punct">(</span><span class="ident">expected_warning</span><span class="punct">,</span> <span class="punct">&amp;</span><span class="ident">blk</span><span class="punct">)</span>
    <span class="ident">original_stderr</span> <span class="punct">=</span> <span class="global">$stderr</span>
    <span class="global">$stderr</span> <span class="punct">=</span> <span class="ident">stderr</span> <span class="punct">=</span> <span class="constant">StringIO</span><span class="punct">.</span><span class="ident">new</span>
    <span class="keyword">yield</span>
    <span class="ident">assert_equal</span> <span class="ident">expected_warning</span><span class="punct">,</span> <span class="ident">stderr</span><span class="punct">.</span><span class="ident">string</span><span class="punct">.</span><span class="ident">chomp</span>
  <span class="keyword">ensure</span>
    <span class="global">$stderr</span> <span class="punct">=</span> <span class="ident">original_stderr</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">Test::Unit::TestCase</span>
  <span class="ident">include</span> <span class="constant">AssertWarning</span>
<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">MyTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>

  <span class="keyword">def </span><span class="method">test_should_assert_warning</span>
    <span class="ident">assert_warning</span><span class="punct">('</span><span class="string">this is a warning</span><span class="punct">')</span> <span class="punct">{</span> <span class="constant">Kernel</span><span class="punct">::</span><span class="ident">warn</span><span class="punct">('</span><span class="string">this is a warning</span><span class="punct">')</span> <span class="punct">}</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/assertions" rel="tag">assertions</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/test" rel="tag">test</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/06/recording-daily-spending-with-a-ruby-dsl">Recording daily spending with a Ruby Dsl</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 06 Oct 2006 09:19:00">
                    Fri, 06 Oct 2006 09:19:00
                  </span>
                </p>

                <p>I&#8217;m very very very bad with money.  Don&#8217;t get me wrong, I&#8217;m very good at <del>spending</del> wasting money, just bad at all <a href="http://en.wikipedia.org/wiki/Savings">the</a> <a href="http://en.wikipedia.org/wiki/Investing">boring</a> <a href="http://en.wikipedia.org/wiki/Pension">stuff</a>.</p>


	<p>The main part of my problem is that I never know how much I have and therefore don&#8217;t know when to stop spending.  This is down to laziness.  It takes time to check balances at a cash point or via my bank&#8217;s website.  I feel that this time can be better spent withdrawing the cash and wandering to the pub.</p>


	<p>Anyhoo.  What I really need is a something that illustrates (preferably with big colourful graphs) the amount going out vs the amount coming in.  This needs to be as un-intrusive as possible or I&#8217;m not going to use it.  I&#8217;d also kinda like to see what sort of things I&#8217;m spending on, so that I can maybe shock myself into stopping.  So, I need a record of what I spend my money on.  Enter&#8230; The little dsl to do just that.</p>


<div class="typocode"><pre><code class="typocode_default">payment_mechanisms :cash, :cheque

day '6-oct-2006' do
  cheque 9.99, lunch, 'expensivo restaurant', burger
  cash 4.00, 'return ticket', train
  cash 1.00, 'mars bar', coke
end</code></pre></div>

	<p>This basically records when and how much I spent, what I spent it on and how I paid for it.  It does nothing more than record at present (and offer some basic addition), but I&#8217;ve got some more ideas.</p>


	<p>There&#8217;s also a budgeting counterpart.  The idea being that my colourful graphs can show (very clearly) when I go over budget for a given day/week/month etc.</p>


<div class="typocode"><pre><code class="typocode_default">weekly do
  outgoing 18.00, lunch
  outgoing 40.00, 'train travel'
end

monthly do
  income 1_000_000, 'wages (not really my monthly wage)'
  outgoing 500_000, tax
end

yearly do
  outgoing 25.00, 'flickr subscription'
end</code></pre></div>

	<p>That&#8217;s about all I have at the moment.  Unfortunately, I&#8217;m already getting a bit bored with this project so this may be the last of it and I&#8217;ll continue spending over my limits.  Or, I&#8217;ll get those colourful graphs added and it&#8217;ll be heralded as the best budgeting app in the world ever<sup><a href="#fn1">1</a></sup>.</p>


	<p id="fn1"><sup>1</sup> This reminds me of the &#8216;best [dance|rock|urban|insert music genre here] album in the world ever&#8230;&#8217; type compilations, of which <a href="http://www.amazon.co.uk/Worst-Album-World-Ever-Ever-Shirehorses/dp/B000024V87">this</a> is undoubtedly the best.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/dsl" rel="tag">dsl</a>, 
                    
                      <a href="/articles/tag/finance" rel="tag">finance</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              

            </div>
          </div>
        </div>
        <div class="yui-b">
          <!--#include virtual="/includes/_navigation.html"-->
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <!--#include virtual="/includes/_twitter.html" -->
    <!--#include virtual="/includes/_delicious.html" -->
    <!--#include virtual="/includes/_google_analytics.html" -->
  </body>

</html>
