<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

  <head>
    <meta name="microid" content="ff511e16d7108be450fccd6f4611cf8d1d5416d1" >
    <meta http-equiv="content-type" content="text/html; charset=utf-8" >
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/DeferredUntilInspirationHits" >
    <link rel="stylesheet" href="http://yui.yahooapis.com/2.5.1/build/reset-fonts-grids/reset-fonts-grids.css" type="text/css" media="all">
    <link rel="stylesheet" href="/blog.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="/syntax.css" type="text/css" media="screen" charset="utf-8">
    <link rel="openid.server" href="http://www.myopenid.com/server">
    <link rel="openid.delegate" href="http://chrisroos.myopenid.com/">
    <title>Posts published in 2007 - deferred until inspiration hits</title>
  </head>
  
  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <h1><a class="blogTitle" href="/">deferred until inspiration hits</a></h1>
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">

              
                <h2>
                  <a href="/articles/2007/12/18/extracting-my-del-icio-us-permalinks-functionality-into-its-own-firefox-extension">Extracting my del.icio.us permalinks functionality into its own firefox extension</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 18 Dec 2007 23:01:00">
                    Tue, 18 Dec 2007 23:01:00
                  </span>
                </p>

                <p>My <a href="http://blog.seagul.co.uk/articles/2007/09/05/patching-the-del-icio-us-firefox-extension-to-add-permalinks">previous implementation</a> amended the <a href="https://addons.mozilla.org/en-US/firefox/addon/3615">del.icio.us bookmarks extension</a>.  I spent some time this morning, and evening, extracting the functionality into its own <a href="http://chrisroos.googlecode.com/svn/trunk/delicious-permalinks/">extension</a>.  This should mean that I remain decoupled from their extension: I don&#8217;t have to update, or even just apply, my original patch whenever the del.icio.us extension is changed.  It should also make it much easier for anyone else to try (if they so wish).</p>


	<p>I&#8217;ve created a <a href="http://groups.google.com/group/delicious-permalinks/">google group</a> if folks want to chat about it.</p>


	<p>To install the extension just visit the (very, very basic) <a href="http://delicious-permalinks.googlegroups.com/web/installation.html">installation page</a>.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/bookmark" rel="tag">bookmark</a>, 
                    
                      <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                    
                      <a href="/articles/tag/extension" rel="tag">extension</a>, 
                    
                      <a href="/articles/tag/firefox" rel="tag">firefox</a>, 
                    
                      <a href="/articles/tag/permalinks" rel="tag">permalinks</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/12/14/cross-browser-well-ie-6-firefox-2-and-safari-3-bookmarklet-script">Cross browser (well, IE 6, Firefox 2 and Safari 3) bookmarklet script</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 14 Dec 2007 21:27:00">
                    Fri, 14 Dec 2007 21:27:00
                  </span>
                </p>

                <p>I <a href="http://blog.seagul.co.uk/articles/2007/12/14/bookmarklet-favelet-limits-in-internet-explorer-6-and-7">mentioned</a> that I&#8217;d been playing with bookmarklets in Internet Explorer 6 (among other, proper, browsers).</p>


	<p>I thought it might be useful to paste the script that bootstraps the bookmarklet.  The concept is that we use the bookmarklet javascript to insert a script tag into the page that links to the full javascript file containing the function(s) that we wish to execute.  I know this has been documented elsewhere and I&#8217;ve probably missed some important stuff out but it may prove useful to someone.</p>


	<h3>The commented, un-compressed, version</h3>


<div class="typocode"><pre><code class="typocode_javascript">if (typeof(rvmBM) == 'undefined') { // Best to name rvmBM to something unlikely to clash with pre-defined variables
  var s = document.createElement('script'); // Use of s versus script saves some precious space
  s.type = 'text/javascript';
  s.src = 'http://example.com/my-external-bookmarklet.js'; // The location of your bookmarklet javascript that does all the work
  void(rvmBM = true); // Prevent the bookmarklet javascript from being loaded multiple times by setting this flag
  void(document.body.appendChild(s)); // Place the script tag in the body of the document
  // If we don't use void() above then we end up writing either 'true' or some junk to the screen in Internet Explorer (only)
};
function addRvm() { // A wrapper function around the actual function we want to call
  if (typeof(addReevooMark) == 'function') { // We want to make sure our bookmarklet function is defined (there's some delay in it becoming available in Firefox.  It's defined immediately in Internet Explorer.)
    addReevooMark();
  } else {
    void(setTimeout(addRvm, 100)); // If our function isn't ready yet we'll just hang on 1/10th of a second and try again
  };
};
addRvm(); // Ask our wrapper function to call the actual bookmarklet function</code></pre></div>

	<h3>The compressed version</h3>


<div class="typocode"><pre><code class="typocode_javascript">javascript:if(typeof(rvmBM)=='undefined'){var s=document.createElement('script');s.type='text/javascript';s.src='http://example.com/my-external-bookmarklet.js';void(rvmBM=true);void(document.body.appendChild(s));};function addRvm(){if(typeof(addReevooMark)=='function'){addReevooMark();}else{void(setTimeout(addRvm,100));};};addRvm();</code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/bookmarklet" rel="tag">bookmarklet</a>, 
                    
                      <a href="/articles/tag/browser" rel="tag">browser</a>, 
                    
                      <a href="/articles/tag/explorer" rel="tag">explorer</a>, 
                    
                      <a href="/articles/tag/firefox" rel="tag">firefox</a>, 
                    
                      <a href="/articles/tag/internet" rel="tag">internet</a>, 
                    
                      <a href="/articles/tag/internet-explorer" rel="tag">internet-explorer</a>, 
                    
                      <a href="/articles/tag/javascript" rel="tag">javascript</a>, 
                    
                      <a href="/articles/tag/safari" rel="tag">safari</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/12/14/web-pages-should-specify-their-canonical-url-permalink">Web pages should specify their canonical URL (permalink)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 14 Dec 2007 17:49:00">
                    Fri, 14 Dec 2007 17:49:00
                  </span>
                </p>

                <p>I&#8217;ve been using <a href="http://del.icio.us">del.icio.us</a> to record items on <a href="http://www.ebay.co.uk">ebay</a> that I&#8217;m interested in.  The problem is that each ebay page can have multiple URLs &#8211; none of which redirect to the canonical version.  I can end up tagging the same listing twice if I happen to visit it with two different URLs &#8211; this is annoying.  It wouldn&#8217;t be hard for them to either redirect to the canonical version or just add a <code>&lt;link rel="bookmark" ... /&gt;</code> tag to the document.  This way, I could ensure that I was always bookmarking the same version (even modifying the del.icio.us plugin if necessary).</p>


	<p>This isn&#8217;t just a problem for ebay: lots of sites duplicate their content on multiple URLs (hello retailers).  Maybe in the short term we could come up with some rules for turning any given <span class="caps">URL</span> on a specific site into its canonical representation.  That sounds like a nice, useful, little service to me.  Can someone build it for me please?</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/bookmark" rel="tag">bookmark</a>, 
                    
                      <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/12/14/bookmarklet-favelet-limits-in-internet-explorer-6-and-7">Bookmarklet (Favelet) limits in Internet Explorer 6 (and 7?)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 14 Dec 2007 08:46:00">
                    Fri, 14 Dec 2007 08:46:00
                  </span>
                </p>

                <p>I wasted quite a bit of time over the last couple of days trying to get a <a href="http://en.wikipedia.org/wiki/Bookmarklet">bookmarklet</a> (or favelet) working in Internet Explorer 6.  It worked perfectly in Firefox and Safari but wasn&#8217;t doing anything at all in IE.  Through lots of trial and error, I came to the conclusion that it was because of the length of the bookmarklet: it seems that Microsoft <a href="http://www.squarefree.com/2005/01/12/internet-explorer-drops-support-for-bookmarklets/">reduced the maximum length of a bookmarklet in <span class="caps">IE 6</span></a></p>


	<p>Although my original bookmarklet wasn&#8217;t all that long, I had it spread over multiple lines for readability.  The fix in my case was to remove all the spaces and place the bookmarklet on one line.</p>


	<p>I started to think that it might be nice to have a bookmarklet <a href="http://www.rubyonrails.com">rails</a> helper.  The bookmarklet helper would allow you to format your javascript for readability but shorten it all in the resulting html (it could even warn if the bookmarklet is too long for IE).  I couldn&#8217;t find anything similar, and I probably won&#8217;t get around to doing it myself, but I did decide to investigate the limit in IE (which could form the basis of such a helper).</p>


	<p>I used the html page below to test the limits of Internet Explorer.  This is the longest bookmarklet that I could get to work: one more character (a 2 on the end of those numbers, for example) and the bookmarklet won&#8217;t work (it still works if you click the link in the page &#8211; it only fails when used as an actual bookmarklet).</p>


<div class="typocode"><pre><code class="typocode_default">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;a href=&quot;javascript:
      var msg = 'hello world, this is my message.  i\'m trying to see how long i can be until internet explorer blows up in my face.';
      var msg = msg + '\n';
      var msg = msg + 'this is the second line of my long message';
      var msg = msg + '\n';
      var msg = msg + '12345679012345678901';
      alert(msg);&quot;&gt;bookmarklet&lt;/a&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre></div>

	<p>I noticed that, once added to Internet Explorer, the bookmarklet appeared to be <a href="http://www.blooberry.com/indexdot/html/topics/urlencoding.htm"><span class="caps">URL</span> encoded</a> (my assumption was based on the conversion of spaces to %20.)</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/2109757023/"><img src="http://farm3.static.flickr.com/2321/2109757023_0f69015c44.jpg" alt="" /></a></p>


	<p>I tried to replicate this encoded string in <a href="http://www.ruby-lang.org">ruby</a> but failed:  A simple <span class="caps">URI</span>.escape in ruby was escaping too much.  Inspecting the bookmarklet again seemed to suggest that the only encoding performed is to remove newlines and convert spaces to %20.  Replicating this in irb gave me the same string that Internet Explorer had in its favourites.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">irb</span><span class="punct">)</span> <span class="ident">str</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">javascript:
  var msg = 'hello world, this is my message.  i<span class="escape">\'</span>m trying to see how long i can be until internet explorer blows up in my face.';
  var msg = msg + '<span class="escape">\n</span>';
  var msg = msg + 'this is the second line of my long message';
  var msg = msg + '<span class="escape">\n</span>';
  var msg = msg + '12345679012345678901';
  alert(msg);</span><span class="punct">&quot;</span>
<span class="ident">irb</span><span class="punct">)</span> <span class="ident">p</span> <span class="ident">str</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(&quot;</span><span class="string">'<span class="escape">\n</span>'</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">'--NEW-LINE--'</span><span class="punct">&quot;).</span><span class="ident">gsub</span><span class="punct">(&quot;</span><span class="string"><span class="escape">\n</span></span><span class="punct">&quot;,</span> <span class="punct">'</span><span class="string"></span><span class="punct">').</span><span class="ident">gsub</span><span class="punct">(&quot;</span><span class="string">'--NEW-LINE--'</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">'<span class="escape">\n</span>'</span><span class="punct">&quot;).</span><span class="ident">gsub</span><span class="punct">('</span><span class="string"> </span><span class="punct">',</span> <span class="punct">&quot;</span><span class="string">%20</span><span class="punct">&quot;).</span><span class="ident">length</span>
<span class="punct">=&gt;</span> <span class="number">505</span></code></pre></div>

	<p>Everything I&#8217;d read about these bookmarklets in Internet Explorer suggested that the limit was 508 characters: the length of the bookmarklet above (once encoded) is only 505 characters.  Adding one more character makes it fail as a bookmarklet.  Hmm, maybe I&#8217;m doing something dumb?</p>


	<p>I&#8217;ve cheated a bit in the &#8216;encoding&#8217; above.  IE removes all newlines (I wonder if this happens in the <span class="caps">DOM</span> or just when you add it as a favourite?) so that the bookmarklet appears on one line.  I needed to do the same but also needed those newlines in the msg to remain (hence the <span class="caps">NEW</span>-LINE replacement stuff).  This is a very naive imlpementation: if you have &#8217;\n\n&#8217;, for example, then it breaks.  The &#8216;encoding&#8217; would need to be a little more intelligent in an actual helper (but only if you wanted to report on the size of the bookmarklet).</p>


	<p>I couldn&#8217;t find any reference to source of this 508 character limit in Internet Explorer: all the blog articles just state it as fact.  So, maybe it&#8217;s not 508.  Maybe it&#8217;s actually 505&#8230;</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/bookmarklet" rel="tag">bookmarklet</a>, 
                    
                      <a href="/articles/tag/browser" rel="tag">browser</a>, 
                    
                      <a href="/articles/tag/explorer" rel="tag">explorer</a>, 
                    
                      <a href="/articles/tag/internet" rel="tag">internet</a>, 
                    
                      <a href="/articles/tag/internet-explorer" rel="tag">internet-explorer</a>, 
                    
                      <a href="/articles/tag/javascript" rel="tag">javascript</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/url" rel="tag">url</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/12/07/testing-actionmailer-base-server_settings">Testing ActionMailer::Base.server_settings</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 07 Dec 2007 17:23:00">
                    Fri, 07 Dec 2007 17:23:00
                  </span>
                </p>

                <p>I needed to use an external <span class="caps">SMTP</span> server to get mail through to certain providers (notably, hotmail).</p>


	<p>I was sending my <a href="http://api.rubyonrails.org/classes/ActionMailer/Base.html">action mailer</a> email but couldn&#8217;t be sure that I&#8217;d configured the settings correctly as I didn&#8217;t get any detailed log output (or at least not where I was looking).</p>


	<p>I dug into the code and found the lines that were responsible for sending the email.  Replaying that code in the console allowed me to identify the problem immediately (a missing domain in my case).  I thought I&#8217;d paste those few lines here in case they&#8217;re of some use to someone else.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">message</span><span class="punct">,</span> <span class="ident">from</span><span class="punct">,</span> <span class="ident">to</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">test message</span><span class="punct">',</span> <span class="punct">'</span><span class="string">sender-email</span><span class="punct">',</span> <span class="punct">'</span><span class="string">recipient-email</span><span class="punct">'</span>
<span class="ident">s</span> <span class="punct">=</span> <span class="constant">ActionMailer</span><span class="punct">::</span><span class="constant">Base</span><span class="punct">.</span><span class="ident">server_settings</span>
<span class="constant">Net</span><span class="punct">::</span><span class="constant">SMTP</span><span class="punct">.</span><span class="ident">start</span><span class="punct">(</span><span class="ident">s</span><span class="punct">[</span><span class="symbol">:address</span><span class="punct">],</span> <span class="ident">s</span><span class="punct">[</span><span class="symbol">:port</span><span class="punct">],</span> <span class="ident">s</span><span class="punct">[</span><span class="symbol">:domain</span><span class="punct">],</span> <span class="ident">s</span><span class="punct">[</span><span class="symbol">:user_name</span><span class="punct">],</span> <span class="ident">s</span><span class="punct">[</span><span class="symbol">:password</span><span class="punct">],</span> <span class="ident">s</span><span class="punct">[</span><span class="symbol">:authentication</span><span class="punct">])</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">smtp</span><span class="punct">|</span> 
  <span class="ident">smtp</span><span class="punct">.</span><span class="ident">sendmail</span><span class="punct">(</span><span class="ident">message</span><span class="punct">,</span> <span class="ident">from</span><span class="punct">,</span> <span class="ident">to</span><span class="punct">)</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/action" rel="tag">action</a>, 
                    
                      <a href="/articles/tag/action-mailer" rel="tag">action-mailer</a>, 
                    
                      <a href="/articles/tag/mailer" rel="tag">mailer</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/12/07/more-on-those-friendly-urls">More on those friendly URLs</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 07 Dec 2007 07:26:00">
                    Fri, 07 Dec 2007 07:26:00
                  </span>
                </p>

                <p>So, <a href="http://twitter.com/chrisroos/statuses/477052802">not being able to sleep</a> does have some benefits.  I managed to get started on my latest little <a href="http://blog.seagul.co.uk/articles/2007/11/27/short-human-friendly-permalinks">pet project</a>.</p>


	<p>I had been using <a href="http://httpd.apache.org/">apache</a> and <a href="http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html">mod_rewrite</a> to redirect &#8220;chrisroos.co.uk/amazonwishlist&#8221; to my actual wishlist.  I had something like this in my apache config.</p>


<div class="typocode"><pre><code class="typocode_default">&lt;VirtualHost *:80&gt;
  ServerAdmin webmaster@seagul.co.uk
  ServerName chrisroos.co.uk
  ServerAlias www.chrisroos.co.uk
  RewriteEngine On
  # &lt;anything&gt;.chrisroos.co.uk -&gt; chrisroos.co.uk
  RewriteCond %{HTTP_HOST} !^chrisroos.co.uk$ [NC]
  RewriteRule ^/(.*)$ http://chrisroos.co.uk/$1 [R=301,L] 
  # Amazon Wishlist
  RewriteRule ^/amazonwishlist http://www.amazon.co.uk/gp/registry/IO9HVNCPEWGD [R]
&lt;/VirtualHost&gt;</code></pre></div>

	<p>I&#8217;ve replaced that with a much simpler apache config that proxies requests to my new <a href="http://mongrel.rubyforge.org/">mongrel</a> redirection handler thing (<a href="http://chrisroos.co.uk/code/mongrel-redirection">source</a> &#8211; hey, even that <span class="caps">URL</span> passes through my redirection service).</p>


<div class="typocode"><pre><code class="typocode_default">&lt;VirtualHost *:80&gt;
  ServerName www.chrisroos.co.uk
  ServerAlias chrisroos.co.uk
  RewriteEngine On
  RewriteRule (.*) http://localhost:4010$1 [P]
&lt;/VirtualHost&gt;</code></pre></div>

	<p>Feel free to go run this on your own server if you&#8217;re so inclined.  At the moment you&#8217;ll have to generate the redirection rules by hand.  In irb, you can do something like:</p>


<div class="typocode"><pre><code class="typocode_default"># require 'yaml'
# # For www.example.com
# rules = { 'www.example.com' =&gt; 'example.com' }
# File.open('PATH_TO_RULES_FOLDER' + '/www.example.com', 'w') { |file| file.puts(rules.to_yaml) }
# # For example.com
# rules = { '/google' =&gt; 'www.google.com' }
# File.open('PATH_TO_RULES_FOLDER' + '/example.com', 'w') { |file| file.puts(rules.to_yaml) }</code></pre></div>

	<p>Start the redirection server.</p>


<div class="typocode"><pre><code class="typocode_default">$ REDIRECTION_PORT=XXXX ruby mongrel-redir.rb &amp;
$# Leaving out REDIRECTION_PORT will mean that the server starts on port 4000
$# Leaving out the final ampersand (&amp;) will mean that server runs in the foreground</code></pre></div>

	<p>Visit www.example.com/google<sup><a href="#fn1">1</a></sup> and watch<sup><a href="#fn2">2</a></sup> as you&#8217;re redirected first to example.com/google and then onto www.google.com.  Cool huh.</p>


	<p>Lots to do &#8211; notably a user interface for managing rules but it&#8217;s not a bad start.</p>


	<p>Oh, and this is specifically so that you can redirect from your own domain.  If you don&#8217;t care about the domain then you could try <a href="http://tinyurl.com">tinyurl</a> or, for human friendly URLs, <a href="http://decenturl.com">decent url</a>.</p>


	<p>[1] Assuming, of course, that www.example.com and example.com both point to the server that this redirection server is running on.</p>


	<p>[2] You probably won&#8217;t be able to watch as it&#8217;ll redirect too quickly in the browser &#8211; your best bet is to use <a href="http://curl.haxx.se/">curl</a> or the <a href="http://livehttpheaders.mozdev.org/">Live <span class="caps">HTTP</span> Headers</a> <a href="http://www.mozilla.com/en-US/firefox/">firefox</a> extension so see what&#8217;s actually going on.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/apache" rel="tag">apache</a>, 
                    
                      <a href="/articles/tag/decenturl" rel="tag">decenturl</a>, 
                    
                      <a href="/articles/tag/mod_rewrite" rel="tag">mod_rewrite</a>, 
                    
                      <a href="/articles/tag/mongrel" rel="tag">mongrel</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/tinyurl" rel="tag">tinyurl</a>, 
                    
                      <a href="/articles/tag/url" rel="tag">url</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/12/06/ruby-rake-invoke-vs-execute">Ruby Rake - Invoke vs Execute</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 06 Dec 2007 16:26:00">
                    Thu, 06 Dec 2007 16:26:00
                  </span>
                </p>

                <p>First up &#8211; I don&#8217;t know an awful lot about the magic that is <a href="http://rake.rubyforge.org/">Rake</a>.  As such, this is probably common knowledge to most people.</p>


	<p>I discovered the difference when trying to execute the db:migrate task from within another rake task (I already knew it worked when declared as a dependency).</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment"># Rakefile</span>
<span class="ident">task</span> <span class="symbol">:foo</span> <span class="keyword">do</span>
  <span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">['</span><span class="string">db:migrate</span><span class="punct">'].</span><span class="ident">execute</span>
<span class="keyword">end</span>

<span class="comment">#$ rake foo</span>
<span class="comment">#=&gt; rake aborted!</span>
<span class="comment">#=&gt; uninitialized constant ActiveRecord</span></code></pre></div>

	<p>I changed <a href="http://rake.rubyforge.org/classes/Rake/Task.html#M000100">Task#execute</a> to <a href="http://rake.rubyforge.org/classes/Rake/Task.html#M000098">Task#invoke</a> and, voila, it all worked fine.  The rdoc for those methods is actually pretty self explanatory, having seen the differences in action.  Oh well.</p>


	<p>I put together a simple example to demonstrate the differences.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment"># The task (task_1) and its dependency (to_be_run_before_task_1)</span>

<span class="ident">task</span> <span class="symbol">:to_be_run_before_task_1</span> <span class="keyword">do</span>
  <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">to_be_run_before_task_1</span><span class="punct">&quot;</span>
<span class="keyword">end</span>

<span class="ident">task</span> <span class="symbol">:task_1</span> <span class="punct">=&gt;</span> <span class="punct">['</span><span class="string">to_be_run_before_task_1</span><span class="punct">']</span> <span class="keyword">do</span>
  <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">task_1</span><span class="punct">&quot;</span>
<span class="keyword">end</span>

<span class="comment"># Three tasks that 'run' task_1</span>

<span class="ident">task</span> <span class="symbol">:invoke_task_1</span> <span class="keyword">do</span>
  <span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">['</span><span class="string">task_1</span><span class="punct">'].</span><span class="ident">invoke</span>
<span class="keyword">end</span>

<span class="ident">task</span> <span class="symbol">:execute_task_1</span> <span class="keyword">do</span>
  <span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">['</span><span class="string">task_1</span><span class="punct">'].</span><span class="ident">execute</span>
<span class="keyword">end</span>

<span class="ident">task</span> <span class="symbol">:run_task_1_using_dependencies</span> <span class="punct">=&gt;</span> <span class="punct">['</span><span class="string">task_1</span><span class="punct">']</span>

<span class="comment"># 'Running' the tasks</span>

<span class="comment">#$ rake task_1</span>
<span class="comment">#=&gt; to_be_run_before_task_1</span>
<span class="comment">#=&gt; task_1</span>

<span class="comment">#$ rake invoke_task_1</span>
<span class="comment">#=&gt; to_be_run_before_task_1</span>
<span class="comment">#=&gt; task_1</span>

<span class="comment">#$ rake execute_task_1</span>
<span class="comment">#=&gt; task_1 #*** Note that the dependencies are not run</span>

<span class="comment">#$ rake run_task_1_using_dependencies</span>
<span class="comment">#=&gt; to_be_run_before_task_1</span>
<span class="comment">#=&gt; task_1</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rake" rel="tag">rake</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/27/fun-with-selenium">Fun with Selenium</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 27 Nov 2007 09:36:00">
                    Tue, 27 Nov 2007 09:36:00
                  </span>
                </p>

                <p><a href="http://interblah.net/">James</a> and I spent a frustrating, but rewarding, day last Tuesday trying to fix what, for at least four hours, seemed to be a non-reproducible error.  <a href="http://www.reevoo.com">We&#8217;ve</a> used <a href="http://www.openqa.org/selenium/">selenium</a> for a while to test that our reevoomark application is working as expected.  Every so often, some of these reevoomark tests would fail, with either of the following two messages:</p>


<pre>
Message: SeleniumCommandError: Timed out after 30000ms
Message: SeleniumCommandError: ERROR: Element xpath=//iframe/ not found
</pre>

	<p>To my knowledge it was never possible to get these tests to fail on any machine apart from our <a href="http://en.wikipedia.org/wiki/Continuous_Integration">continuous integration</a> box.  And even then the failures were intermittent.  Because these failures were so intermittent no-one had invested any real time in trying to find their cause.  Tuesday seemed a bit different though: the tests were failing almost all the time and we decided to do something about it.</p>


	<p>I&#8217;ll leave out all of the dead-ends we found and, instead, home-in on the patterns we started to see that led to the eventual resolution.</p>


	<p>One of the reevoomarks we offer opens the reviews up in a <a href="http://en.wikipedia.org/wiki/Lightbox_%28JavaScript%29">lightbox</a>.  However, if the screen isn&#8217;t quite large enough for our content we open it in a standard pop-up window instead.  I&#8217;ll pop an example reevoomark at the bottom of this post so you can see exactly what I mean (you&#8217;ll obviously have to resize your browser to see the effect).  We noticed that our tests would fail when another copy of firefox was already open on our continuous integration box.  Toggling this on and off gave us some confidence that this was, at least one of, the causes of the failures.  We were still unable to reproduce this locally though.</p>


	<p>It was around this time that James noticed that we were seeing a pop-up window more than we should have been, i.e. we were seeing a pop-up window when we were expecting to see a lightbox.  This discovery made me happy as up until this stage I&#8217;d been blaming selenium for throwing out useless error messages.  In actual fact selenium was reporting the errors correctly: it really couldn&#8217;t find the element we were looking for (the iframe in the error above) and was therefore timing out.  OK, so if the pop-up was showing in place of the lightbox then it meant that the browser window couldn&#8217;t be big enough for the lightbox.  Yet we explicitly resize the browser in our test to ensure that the lightbox will fit.</p>


<div class="typocode"><pre><code class="typocode_default">get_eval(&quot;this.browserbot.getCurrentWindow().resizeTo(800,800)&quot;)</code></pre></div>

	<p>We used the one and only javascript debugging technique (<code>alert(msg)</code>) to determine that the window was indeed too small for our lightbox.  But hang on, if there wasn&#8217;t another Firefox instance open then the browser <strong>was</strong> big enough.  So somehow, the presence of another Firefox browser was affecting the maximum size that we could resize our browser to.  It turns out it&#8217;s all to do with the maximum height that Firefox thinks it can expand to.  On a Mac with a hidden dock (or with the dock positioned to the side) the maximum height will be from the status bar at the top of the screen to the bottom of the screen.  With a dock visible at the bottom of the screen the maximum height will be from the status bar at the top of the screen to the top of the dock.  It&#8217;s not quite this simple though: Firefox appears to look at the height of the oldest open firefox window to make its decision too.  Although we had the dock at the bottom of the screen our tests were actually passing on some occasions.  This was due to selenium opening its browser at almost full screen, allowing subsequent windows to be resized to these same dimensions which happen to be plenty big enough for our lightbox.  If we already had another firefox instance open (which by default would open at a maximum height of status bar to top of dock) then our selenium browser could only resize to this height, which wasn&#8217;t big enough for our lightbox to appear.  Phew.</p>


	<p>So, the result of this entire day&#8217;s work?  Moving the dock to the right hand side of the screen.  Excellent.</p>


	<h3>Sample lightbox reevoomark</h3>



<script type="text/javascript" charset="utf-8">
  rvo_format='image_horizontal250x40';
  rvo_product_id='1'
  rvo_retailer_ref='rev';
  rvo_version = 2;
</script>
<script type="text/javascript" src='http://www.revieworld.com/javascripts/reevoomark.js'></script>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/selenium" rel="tag">selenium</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/27/short-human-friendly-permalinks">Short, Human Friendly, Permalinks</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 27 Nov 2007 09:31:00">
                    Tue, 27 Nov 2007 09:31:00
                  </span>
                </p>

                <p>I was recently asked for my Amazon wishlist.  I wasn&#8217;t able to use email and was expected to write down the <span class="caps">URL</span>.  I had a look and found that the <span class="caps">URL</span> (<a href="http://www.amazon.co.uk/gp/registry/IO9HVNCPEWGD">http://www.amazon.co.uk/gp/registry/IO9HVNCPEWGD</a>) wasn&#8217;t paper or speech friendly.  Instead of attempting to convey this <span class="caps">URL</span>, I used the opportunity to create my own human friendly permalink for my wishlist (<a href="http://chrisroos.co.uk/amazonwishlist">chrisroos.co.uk/amazonwishlist</a>).  I actually started with a hyphenated variant (amazon-wishlist) but realised that the non-hyphenated version would be easier for someone to understand in conversation.</p>


	<p>This seems to tie in with what <a href="http://www.scripting.com">Dave Winer</a> has been talking about <a href="http://www.scripting.com/stories/2007/11/20/solvingTheTinyurlCentraliz.html">recently</a>.</p>


	<p>I think this&#8217;d be quite a neat, and fairly easy, little webapp to build.  It would need a simple interface for managing permalinks and the ability to work with multiple domains.  Hmm, I&#8217;m tempted to give this a shot unless anyone knows of anything similar already out there?</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/permalink" rel="tag">permalink</a>, 
                    
                      <a href="/articles/tag/tinyurl" rel="tag">tinyurl</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/26/vrm-vs-affiliate-marketing">VRM vs Affiliate Marketing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 26 Nov 2007 22:23:00">
                    Mon, 26 Nov 2007 22:23:00
                  </span>
                </p>

                <p>I just read <a href="http://blogs.law.harvard.edu/vrm/2007/11/16/can-vrm-fix-drm/">this</a> article over on the <a href="http://blogs.law.harvard.edu/vrm/">Project <span class="caps">VRM</span></a> blog.  There was a fragment of a sentence that really resonated with me &#8211; highlighted in the quote below.</p>


<blockquote>
For copyrighted works, <span class="caps">VRM</span> could involve agreements made on an individual basis — ones that could involve actual relationships between copyright holders and their customers. For example, if I buy an open (non-DRM’d) copy of an album by Mike Marshall (my favorite mandolin player), it might involve letting him know who I am, the fact that I like his work, a commitment not to duplicate it beyond fair uses, and the option to do any number of things, <strong>including re-distributing it for pay that would get us both a slice of the take</strong>. The options are wide open. What matters is that there would means for a real reslationship based on mutual interest, trust and control.
</blockquote>

	<p>If I like something enough to want to recommend it to people why shouldn&#8217;t I take a small amount of money from any resulting transaction?  If I was to become an <a href="http://affiliate-program.amazon.co.uk/gp/associates/join/">Amazon affiliate</a> I could already get paid for recommending this album: except that I&#8217;d actually be getting paid for recommending this album <strong>at</strong> Amazon.  That just makes me feel a little less comfortable than if I was able to get paid for recommending the artist alone.</p>


	<p>Having spent about 30 minutes writing and re-writing to come up with that <strong>one</strong> paragraph above I&#8217;ve realised that I can&#8217;t quite put my finger on why I find the idea so powerful.</p>


	<p>Maybe one of the things I like is the decentralisation that the model would imply.  Rather than having one large distributor (Amazon) you have lots of smaller distributors (fans of Mike Marshall&#8217;s music).  Hmm, food for thought.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/affiliate" rel="tag">affiliate</a>, 
                    
                      <a href="/articles/tag/amazon" rel="tag">amazon</a>, 
                    
                      <a href="/articles/tag/marketing" rel="tag">marketing</a>, 
                    
                      <a href="/articles/tag/vrm" rel="tag">vrm</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/20/wow-google-must-really-love-chris">Wow.  Google must really love Chris.</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 20 Nov 2007 22:51:00">
                    Tue, 20 Nov 2007 22:51:00
                  </span>
                </p>

                <p>I&#8217;d read <a href="http://www.scripting.com/stories/2007/07/17/instantIndexing.html">previously</a> about <a href="http://www.google.com">Google</a> indexing pages in almost real-time.  I only experienced it myself for the first time this evening.  I was continuing to search for answers to my <a href="http://blog.seagul.co.uk/articles/2007/11/20/can-anyone-recommend-a-good-simple-web-hosting-solution">recent question</a> when my own question popped up at number three in the <a href="http://www.google.co.uk/search?hl=en&#38;q=static+simple+web+hosting">search results</a>.</p>


	<p><a href="http://flickr.com/photos/chrisjroos/2050547123/"><img src="http://farm3.static.flickr.com/2310/2050547123_31a16714ec.jpg" alt="" /></a></p>


	<p>I assume this might be to do with Google&#8217;s <a href="http://googlewebmastercentral.blogspot.com/2007/05/taking-advantage-of-universal-search.html">Universal Search</a> that blends lots of different sources into their main search results.  Or, they really do just love me.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                      <a href="/articles/tag/index" rel="tag">index</a>, 
                    
                      <a href="/articles/tag/search" rel="tag">search</a>, 
                    
                      <a href="/articles/tag/universal" rel="tag">universal</a>, 
                    
                      <a href="/articles/tag/universal-search" rel="tag">universal-search</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/20/can-anyone-recommend-a-good-simple-web-hosting-solution">Can anyone recommend a good simple web hosting solution?</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 20 Nov 2007 22:07:00">
                    Tue, 20 Nov 2007 22:07:00
                  </span>
                </p>

                <p>I&#8217;m keen to move some domains over to <a href="http://www.google.com/a">google apps</a> but I need more than the included Page Creator.  Ideally, I want a very basic, reliable webhost that allows me to host static files.  Anyone have any recommendations?</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/email" rel="tag">email</a>, 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                      <a href="/articles/tag/hosting" rel="tag">hosting</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/18/the-skypephone-so-far">The Skypephone so far</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 18 Nov 2007 19:15:00">
                    Sun, 18 Nov 2007 19:15:00
                  </span>
                </p>

                <p>I bought the <a href="http://www.skype.com/intl/en/allfeatures/3skypephone/">Skypephone</a> from <a href="http://three.co.uk">three</a> about a week ago.  I haven&#8217;t managed to get my number transfered yet and as such I haven&#8217;t really used it in anger, but thought I&#8217;d write some random notes anyway.</p>


	<p>I didn&#8217;t get off too a good start with <a href="http://www.skype.com">Skype</a> <a href="http://3skypephone.com/forum/viewtopic.php?t=154">not working</a> on the phone for two or three days after purchase.  Although Skype now works fine, it doesn&#8217;t seem to remember my password, which makes it a bit of a pain each time you want to log in.  I&#8217;ve used skype for text chatting but haven&#8217;t actually used it for voice yet so can&#8217;t comment on the quality.</p>


	<p>The phone is an <a href="http://www.amoi.com"><span class="caps">AMOI</span></a> (I&#8217;m not 100% sure that&#8217;s the correct site as this phone doesn&#8217;t appear there) WP-S1.  It feels remarkably similar to <a href="http://www.nokia.com">Nokia</a> phones I&#8217;ve used in the past.  In fact, the only difference I&#8217;ve found so far is the keys you press to lock the keypad (star then top-left button, rather than top-left button then start).</p>


	<p>If you try to visit a website beginning with www then a popup appears telling you that you&#8217;ll be charged for data used.  If you visit a website that doesn&#8217;t start www (e.g. <a href="http://m.twitter.com">m.twitter.com</a>) then you don&#8217;t get this message.  This made me wonder whether I was still being charged for the data I was using &#8211; I guess I must be, right?</p>


	<p>I&#8217;ve connected the phone to my computer successfully using bluetooth and used it to transfer some <a href="http://flickr.com/photos/chrisjroos/sets/72157603224666780/">photos</a> I took yesterday with the 2 megapixel camera.</p>


	<p>I think I should be able to use the phone as a modem but the supplied CD contains Windows only software.</p>


	<p>Hmm, that&#8217;s about all for now I think.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/skype" rel="tag">skype</a>, 
                    
                      <a href="/articles/tag/skypephone" rel="tag">skypephone</a>, 
                    
                      <a href="/articles/tag/three" rel="tag">three</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/16/newnet-and-bt-broadband-problems">NewNet and BT Broadband problems</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 16 Nov 2007 13:38:00">
                    Fri, 16 Nov 2007 13:38:00
                  </span>
                </p>

                <p>I&#8217;ve been having broadband problems for about 6 weeks now.  My connection continually drops in and out and when it does connect, it does so at about 100Kbps.  I held off getting a <a href="http://www.bt.com">BT</a> engineer involved because I didn&#8217;t want to have to pay the £200 if it turned out to be my fault.  Having satisfied myself that I hadn&#8217;t done anything stoopid, I called <a href="http://www.newnet.co.uk/">NewNet</a> and arranged for the BT engineer to come round this morning.  He was able to confirm that my line was capable of connecting at around 5Mbps (I&#8217;m on the upto 8Mbps service) but noticed that there was a high <a href="http://en.wikipedia.org/wiki/Signal-to-noise_ratio">Signal to Noise</a> ratio on the line (around 19dB I think).  He mentioned that the <span class="caps">SNR</span> should be around 10dB and that this might be the cause of my connectivity problems.  He then went to the local junction box to test the line between my house and the junction box and the junction box and the exchange.  The line between the house and the junction box was OK but he changed the line between the junction box and the exchange to rule out any problems at that end.  Even with these changes, he was still seeing a high <span class="caps">SNR</span>.  He then mentioned that he&#8217;d spoken to the helpdesk and they informed him that my line had been limited at 135Kbps.  This explained the poor performance once I was actually connected.  It also explains (I think) why I would see downstream connections of around 5Mbps in my router status but only actually download at around 100Kbps according to the <a href="http://www.thinkbroadband.com/">thinkbroadband</a> <a href="http://www.thinkbroadband.com/speedtest.html">speedtest</a>.  I guess that my <a href="http://www.netgear.co.uk/wireless_adslrouter_dg834g.php">Netgear <span class="caps">DG834G</span></a> actually reports the potential line speed rather than the actual speed of the connection.  In theory, the fact that my line is limited should sort itself out but I&#8217;ve been informed to call NewNet if it&#8217;s no better within the next couple of days.</p>


	<p>Fun and games eh.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/adsl" rel="tag">adsl</a>, 
                    
                      <a href="/articles/tag/broadband" rel="tag">broadband</a>, 
                    
                      <a href="/articles/tag/bt" rel="tag">bt</a>, 
                    
                      <a href="/articles/tag/newnet" rel="tag">newnet</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/11/15/hsbc-conclusion">HSBC Conclusion</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 15 Nov 2007 17:14:00">
                    Thu, 15 Nov 2007 17:14:00
                  </span>
                </p>

                <p>I finally received a reply from <span class="caps">HSBC</span> to my constant nagging about a possible bug in their Internet Banking software.</p>


<blockquote>
Our reference : 5629320

	<p>Dear Mr Roos</p>


	<p>Thank you for your e-mail.</p>


	<p>As previously advised, this has been fed back to our Development Team however, we do not offer technical support for any financial packages.</p>


	<p>Our Internet Banking terms and conditions state that 
we will not be held responsible for any financial management software which you choose to use in connection with the Internet Banking service.</p>


	<p>Please be assured that all customer feedback is taken seriously, however we do receive many change requests for our electronic banking services every day.</p>


	<p>Each request is recorded to enable us to monitor the number received, these are then assessed for suitability and prioritised accordingly.</p>


	<p>Although your suggestion cannot be implemented immediately it will be held on our database.  We do advise our customers, via an online message, when upgrades have been made to our electronic banking services.</p>


I trust that this matter is now closed but would like to thank you for bringing this to our attention.
</blockquote>

	<p>So I replied in order to explain my persistence.</p>


<blockquote>
Hey,

	<p>I appreciate you getting back to me.</p>


	<p>To start with, although this causes me some problems, it&#8217;s not big deal.  The reason for my originally getting in touch was that I thought I might be able to help you guys.  I found what I believed to be a bug in your <span class="caps">OFX</span> export and thought that by reporting it with some fairly relevant context (i.e. the section of the <span class="caps">OFX</span> spec that explains what the <span class="caps">OFX</span> export should look like) that it might help you to get it prioritised.</p>


	<p>Your response of &#8220;we do not offer technical support for any financial packages&#8221; makes me think that you&#8217;re trying to shrug me off (I appreciate that this may not be the case).  You don&#8217;t need to offer support for financial packages but I would expect that when you boast of downloads in <span class="caps">OFX</span> format that they would actually follow the specification.</p>


	<p>I don&#8217;t know whether my approach is the normal approach people would take when reporting problems but I come from an open-source background where people generally help each other out.  Actually, out of interest, how do you &#8220;receive many change requests for our electronic banking services every day&#8221;?  Do other people submit their problems in the same way or was there a more obvious route that I missed?</p>


	<p>I guess I feel a little unsatisfied.  Because of the problems I&#8217;ve had getting in contact with anyone from the beginning I find myself not necessarily believing what you are telling me.  However, I do accept that this might not be fair and that you have indeed logged my bug report into your database.</p>


	<p>Feel completely free to ignore this suggestion but&#8230;  I think you would get a lot of unexpected benefits by making it easier to give feedback about your Internet Banking site.  I can&#8217;t believe that it&#8217;s just me that feels compelled to help out when they see a problem &#8211; I think you&#8217;d get an awful lot of useful feedback from others too.</p>


	<p>Anyway, I guess that&#8217;s it for now.  If there&#8217;s anything I can possibly help with then drop me an email &#8211; I&#8217;ll help out where I can.</p>


	<p>I&#8217;m going to post this letter to my blog too<sup><a href="#fn1">1</a></sup>.</p>


	<p>Cheers,</p>


	<p>Chris</p>


[1] http://blog.seagul.co.uk 
</blockquote>

	<p>I&#8217;m sure that at some point in the future, <span class="caps">HSBC</span> will hire some consultants.  Those consultants will tell <span class="caps">HSBC</span> how to utilise the open source community to make the world a better place.  <span class="caps">HSBC</span> will listen because any advice you pay for has to be true&#8230;. Right?</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                      <a href="/articles/tag/hsbc" rel="tag">hsbc</a>, 
                    
                      <a href="/articles/tag/ofx" rel="tag">ofx</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/10/31/naughty-spammy-tesco-entertainment">Naughty spammy Tesco Entertainment</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 31 Oct 2007 22:17:00">
                    Wed, 31 Oct 2007 22:17:00
                  </span>
                </p>

                <p>Are Tesco Entertainment the new <a href="http://blog.seagul.co.uk/articles/2007/03/16/orange-orange-orange">Orange</a>?  They might just be you know.  See, I&#8217;ve been sad and pathetic enough to <a href="http://chrisjroos.stikipad.com/unsubscriptions">record</a> details of unwanted emails that I receive.  So far <a href="http://chrisjroos.stikipad.com/unsubscriptions/show/tesco-entertainment">Tesco Entertainment</a>, bless &#8216;em, have been unable to remove me from their mailing list for 90 days.  I thought I&#8217;d write them a little email to, you know, ask them to stop spamming me.</p>


<blockquote>
Here&#8217;s a list of emails you&#8217;ve sent me.

	<ul>
	<li>Received: 26-Jun-2007</li>
		<li>Received: 11-Jul-2007</li>
		<li>Received: 27-Jul-2007</li>
		<li><strong>Unsubscribed</strong>: 30-Jul-2007 (although it appeared that I wasn’t actually signed up to any offers…)</li>
		<li>Received: 08-Aug-2007</li>
		<li>Received: 21-Aug-2007</li>
		<li>Received: 16-Oct-2007</li>
		<li>I emailed you on 17th Oct:
“I unsubscribed from you guys on the 30th July 2007 (interestingly, my preferences suggested that I wasn’t actually subscribed to any mailings in the first place). Since then, you’ve sent me Tesco Entertainment emails on the 8th Aug, 21st Aug and 16th Oct1. Please stop.  Cheers,  Chris  [1] http://chrisjroos.stikipad.com/unsubscriptions/show/tesco-entertainment”</li>
		<li>Received: 30-Oct-2007</li>
	</ul>


	<p>You&#8217;ll notice that I&#8217;ve received four emails since unsubscribing on the 30th July.  I think three months is long enough to remove someone from your spam list isn&#8217;t it?  Oh, and you&#8217;ll also see I&#8217;ve emailed you in the past too.  It wouldn&#8217;t hurt to reply would it?</p>


	<p>Cheers,</p>


Chris
</blockquote>

	<p><strong>Update Thu 15th Nov 2007</strong></p>


	<p>I received a reply from Tesco.</p>


<blockquote>
Thank you for your email.

	<p>I&#8217;m sorry that you&#8217;ve received some unwanted emails.</p>


	<p>I&#8217;ve made arrangements to remove your email address chris@seagul.co.uk from our database. This process takes about 14 days and during this period you could still get emails from us.</p>


	<p>If you have any other email addresses registered, please let us know and we can remove these also.</p>


	<p>Thank you for telling us about this and giving us the chance to put things right.</p>


If you have any further queries please do not hesitate to contact us at customer.service@tesco.co.uk quoting <span class="caps">TES4278070X</span>.
</blockquote>

	<p>This phrase made me smile, &#8220;Thank you for telling us about this and giving us the chance to put things right.&#8221;.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/email" rel="tag">email</a>, 
                    
                      <a href="/articles/tag/spam" rel="tag">spam</a>, 
                    
                      <a href="/articles/tag/tesco" rel="tag">tesco</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/10/19/a-common-pattern-in-retailers-receipt-pages-and-a-microformat-solution">A common pattern in retailers' receipt pages (and a microformat solution)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 19 Oct 2007 07:58:00">
                    Fri, 19 Oct 2007 07:58:00
                  </span>
                </p>

                <p>We&#8217;ve been looking at embedding a little bit of javascript in one of our partner&#8217;s receipt pages to send us the details of which products were purchased (using <a href="http://en.wikipedia.org/wiki/Stock_Keeping_Unit">SKUs</a>).  A quick glance over the page revealed that nine other providers (<a href="http://www.google.com/analytics/">GA</a>, an <a href="http://en.wikipedia.org/wiki/Search_engine_optimization"><span class="caps">SEO</span></a> helper and a bunch of price comparators) had the same idea.  That&#8217;s the same data repeated nine times.  Ten if you include the human readable copy.  Now that seems like a problem waiting to be solved to me.  It also feels like a perfect fit for <a href="http://microformats.org/">microformats</a>.  If we had a <a href="http://microformats.org/wiki/receipt">receipt microformat</a> then we could use javascript to parse the data rather than having to re-define it each time.  We would also be removing all duplication and creating semantically rich content (I guess that&#8217;s basically what microformats do anyway) in the process.</p>


	<p>So, something that might currently look like this:</p>


<div class="typocode"><pre><code class="typocode_html">&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Order Number&lt;/th&gt;
    &lt;th&gt;Price&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt;£19.99&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

&lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;
  var order_id = 1
  var price = 1999
&lt;/script&gt;
&lt;script src=&quot;http://MY-PRICE-COMPARATOR&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;
  var orderNumber = 1
  var price = 19.99
&lt;/script&gt;
&lt;script src=&quot;http://MY-SEO-HELPER&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;!-- And repeat... --&gt;</code></pre></div>

	<p>Could become much simpler:</p>


<div class="typocode"><pre><code class="typocode_html">&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Order Number&lt;/th&gt;
    &lt;th&gt;Price&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;orderNumber&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;orderPrice&quot;&gt;&lt;span class=&quot;orderCurrency&quot;&gt;£&lt;/span&gt;19.99&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

&lt;script src=&quot;http://MY-PRICE-COMPARATOR&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;http://MY-SEO-HELPER&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</code></pre></div>

	<p>There has been discussion of such a <a href="http://microformats.org/wiki/receipt">receipt microformat</a> but a quick search seemed to suggest that it hasn&#8217;t been discussed in the context of this specific problem.  Maybe I&#8217;ll go add my voice to that discussion&#8230;</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/commerce" rel="tag">commerce</a>, 
                    
                      <a href="/articles/tag/javascript" rel="tag">javascript</a>, 
                    
                      <a href="/articles/tag/microformat" rel="tag">microformat</a>, 
                    
                      <a href="/articles/tag/receipt" rel="tag">receipt</a>, 
                    
                      <a href="/articles/tag/retail" rel="tag">retail</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/10/15/more-hsbc-shenanigans">More Hsbc Shenanigans</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 15 Oct 2007 20:13:00">
                    Mon, 15 Oct 2007 20:13:00
                  </span>
                </p>

                <p>This will be of interest to very few (if any) people &#8211; I&#8217;d suggest you just move on to something more interesting.</p>


	<p>Yesterday, I contacted Hsbc using the Internet Banking feedback form that was outside of the Internet Banking site itself.</p>


<blockquote>
I believe that the Ofx export of transactions has been broken since your internet banking &#8216;upgrade&#8217;.  I&#8217;ve tried many times to contact you using My Messages and also over the phone &#8211; the people I seem to be dealing with are unable or unwilling to help.

	<p>It&#8217;s a very minor problem &#8211; my account is overdrawn yet the balance is shown as positive in the Ofx export.</p>


	<p>I&#8217;ve posted about the issue on my blog<sup><a href="#fn1">1</a></sup>, in the hope that someone might provide me some contact details of someone that can actually help.  Unfortunately that didn&#8217;t get my anywhere.</p>


	<p>I look forward to hearing from you.</p>


	<p>Cheers,</p>


	<p>Chris</p>


[1] http://blog.seagul.co.uk/articles/2007/10/05/trying-to-speak-to-someone-in-development-at-hsbc-can-anyone-help
</blockquote>

	<p>I was hoping to get through to a human.  Unfortunately I just got the same copy and paste bot that I get from within the Internet banking site.</p>


<blockquote>
Dear Mr Roos

	<p>Our Reference: 508-5629320-15102007-RR</p>


	<p>Thank you for using the feedback facility for our Internet Banking service.</p>


	<p>This is with regard to your recent e-mail concerning problems related to the download of transactions. From our experience to date, we have found that similar queries have been most effectively dealt with over the telephone rather than an exchange of a series of e-mails.</p>


	<p>On occasions it can be of benefit to be online whilst talking to us. You may wish to call from a separate line to your Internet connection.</p>


	<p>If you require further assistance, please call us on 0845 600 2290 (within UK) or +44 1226261226 (outside UK).  Minicom support is available on 0845 7125563.  The Internet Banking Helpdesk is open from Monday to Sunday 8.00am to 10.00pm (UK times).</p>


	<p>Kind Regards</p>


Rajan
Technical Support Representative
<span class="caps">HSBC</span> Internet Banking Technical Support
</blockquote>

	<p>Tonight, I&#8217;ve emailed their complaints email address.</p>


<blockquote>
Hi,

	<p>I&#8217;ll apologise in advance for potentially mis-using your complaints email address.</p>


	<p>I&#8217;ve got a problem with downloading my transactions in Ofx format from the Internet banking site.  I&#8217;ve written up my experience so far<sup><a href="#fn1">1</a></sup>.  As a web developer with experience of the Ofx format I&#8217;m fairly sure that you&#8217;ve got a bug in your Internet banking site.  I&#8217;ve been trying for over a month to speak to someone in your support department to no avail.</p>


	<p>All I want is for you (or someone that is able to do more than hit copy, paste, send) to read the post below and pass this information on to your development team &#8211; they will be able to help.</p>


	<p>Be assured that I&#8217;m really just trying to help you guys.  If you need anything else from me then just give me a shout.</p>


	<p>Cheers,</p>


	<p>Chris</p>


[1] http://blog.seagul.co.uk/articles/2007/10/05/trying-to-speak-to-someone-in-development-at-hsbc-can-anyone-help
</blockquote>

	<p>I&#8217;m getting slightly concerned that I might be wrong now &#8211; then I&#8217;d look real stoopid.  As it is I just look a bit sad.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/banking" rel="tag">banking</a>, 
                    
                      <a href="/articles/tag/hsbc" rel="tag">hsbc</a>, 
                    
                      <a href="/articles/tag/internet" rel="tag">internet</a>, 
                    
                      <a href="/articles/tag/ofx" rel="tag">ofx</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/10/05/trying-to-speak-to-someone-in-development-at-hsbc-can-anyone-help">Trying to speak to someone in development at Hsbc - can anyone help?</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 05 Oct 2007 08:43:00">
                    Fri, 05 Oct 2007 08:43:00
                  </span>
                </p>

                <p>I&#8217;m almost 100% certain that there&#8217;s a <a href="http://twitter.com/chrisroos/statuses/247143372">bug</a> in the Hsbc Internet Banking site.</p>


	<p>My account is overdrawn yet the balance shows as positive when I download my transactions in either &#8216;Money 98 onwards (ofx)&#8217; or &#8216;Quicken 2002 (ofx)&#8217;.  I believe that section 3.2.9.2 of the <a href="http://www.ofx.net">Ofx</a> 2.1.1 spec explains that these balances should be shown as negative.</p>


	<p>I&#8217;ve tried to <a href="http://www.flickr.com/search/?w=31365693@N00&#38;q=hsbc+AND+ofx&#38;m=tags">email</a> and I&#8217;ve <a href="http://twitter.com/chrisroos/statuses/279942352">tried</a> <a href="http://twitter.com/chrisroos/statuses/279956472">to</a> <a href="http://twitter.com/chrisroos/statuses/313632312">call</a> <a href="http://twitter.com/chrisroos/statuses/313656682">hsbc</a>.  Both to no avail.</p>


	<p>Does anyone know anyone that works at Hsbc and might be able to get a message to someone in development?  If not, what&#8217;s the etiquette on facebook groups?  I notice that there a few hsbc groups &#8211; can I just post messages to them asking for help?</p>


	<p>I&#8217;ve gotten so used to dealing with <a href="http://www.wesabe.com">real</a> companies that I&#8217;d forgotten how the old world works.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/banking" rel="tag">banking</a>, 
                    
                      <a href="/articles/tag/bug" rel="tag">bug</a>, 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                      <a href="/articles/tag/development" rel="tag">development</a>, 
                    
                      <a href="/articles/tag/hsbc" rel="tag">hsbc</a>, 
                    
                      <a href="/articles/tag/internet" rel="tag">internet</a>, 
                    
                      <a href="/articles/tag/ofx" rel="tag">ofx</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/10/03/a-microformat-for-my-contact-details-instant-messaging-twitter-et-al">A microformat for my contact details (instant messaging, twitter et al)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 03 Oct 2007 23:52:00">
                    Wed, 03 Oct 2007 23:52:00
                  </span>
                </p>

                <p>I haven&#8217;t done any research on this so it may have already been proposed over at the <a href="http://microformats.org/">microformats</a> site.</p>


	<h3>The problem</h3>


	<p>Sometimes I want to communicate with the author of a webpage.  I don&#8217;t want to have to hunt around to find contact details and I probably don&#8217;t want to fill in a form.</p>


	<h3>A proposal to fix part of the problem</h3>


	<p>If the author&#8217;s contact details were semantically marked up, either on the page I was looking at or linked to elsewhere on the web, then I could use a simple parser to extract those details and select the best communication tool to use manually.</p>


	<p>Maybe some code can help explain what I mean.</p>


	<h4>A semantically marked up contact page.</h4>


<div class="typocode"><pre><code class="typocode_html">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&gt;

&lt;html&gt;

  &lt;head&gt;
    &lt;title&gt;Contact Details&lt;/title&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;dl class=&quot;contactDetails&quot;&gt;
      &lt;dt&gt;Skype&lt;/dt&gt;
      &lt;dd class=&quot;skype identifier&quot;&gt;skype-username&lt;/dd&gt;
      &lt;dt&gt;MSN&lt;/dt&gt;
      &lt;dd class=&quot;msn identifier&quot;&gt;msn-username&lt;/dd&gt;
    &lt;/dl&gt;
  &lt;/body&gt;

&lt;/html&gt;</code></pre></div>

	<h4>A parser in <a href="http://www.ruby-lang.org/">ruby</a></h4>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">hpricot</span><span class="punct">'</span>

<span class="keyword">class </span><span class="class">ContactParser</span>
  <span class="keyword">def </span><span class="method">self.from_html</span><span class="punct">(</span><span class="ident">html</span><span class="punct">)</span>
    <span class="ident">doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">html</span><span class="punct">)</span>
    <span class="ident">new</span><span class="punct">(</span><span class="ident">doc</span><span class="punct">)</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">initialize</span><span class="punct">(</span><span class="ident">hpricot_doc</span><span class="punct">)</span>
    <span class="attribute">@hpricot_doc</span> <span class="punct">=</span> <span class="ident">hpricot_doc</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">service_identifiers</span>
    <span class="punct">(</span><span class="attribute">@hpricot_doc</span><span class="punct">/'</span><span class="string">.contactDetails .identifier</span><span class="punct">').</span><span class="ident">inject</span><span class="punct">({})</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">hash</span><span class="punct">,</span> <span class="ident">e</span><span class="punct">|</span>
       <span class="ident">service</span> <span class="punct">=</span> <span class="punct">(</span><span class="ident">e</span><span class="punct">.</span><span class="ident">classes</span> <span class="punct">-</span> <span class="punct">['</span><span class="string">identifier</span><span class="punct">']).</span><span class="ident">first</span>
       <span class="ident">identifier</span> <span class="punct">=</span> <span class="ident">e</span><span class="punct">.</span><span class="ident">inner_text</span>
       <span class="ident">hash</span><span class="punct">[</span><span class="ident">service</span><span class="punct">]</span> <span class="punct">=</span> <span class="ident">identifier</span>
       <span class="ident">hash</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">identifier</span><span class="punct">(</span><span class="ident">service</span><span class="punct">)</span>
    <span class="punct">(</span><span class="attribute">@hpricot_doc</span><span class="punct">/&quot;</span><span class="string">.contactDetails .<span class="expr">#{service}</span>.identifier</span><span class="punct">&quot;).</span><span class="ident">inner_text</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">contact_details_file</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/contact-details.html</span><span class="punct">'</span>
<span class="ident">html</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">open</span><span class="punct">(</span><span class="ident">contact_details_file</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">f</span><span class="punct">|</span> <span class="ident">f</span><span class="punct">.</span><span class="ident">read</span> <span class="punct">}</span>
<span class="ident">parser</span> <span class="punct">=</span> <span class="constant">ContactParser</span><span class="punct">.</span><span class="ident">from_html</span><span class="punct">(</span><span class="ident">html</span><span class="punct">)</span>

<span class="ident">p</span> <span class="ident">parser</span><span class="punct">.</span><span class="ident">service_identifiers</span>
<span class="comment"># =&gt; {&quot;skype&quot;=&gt;&quot;skype-username&quot;, &quot;msn&quot;=&gt;&quot;msn-username&quot;}</span>
<span class="ident">p</span> <span class="ident">parser</span><span class="punct">.</span><span class="ident">identifier</span><span class="punct">('</span><span class="string">skype</span><span class="punct">')</span>
<span class="comment"># =&gt; 'skype-username'</span>
<span class="ident">p</span> <span class="ident">parser</span><span class="punct">.</span><span class="ident">identifier</span><span class="punct">('</span><span class="string">blurgh</span><span class="punct">')</span>
<span class="comment"># =&gt; ''</span></code></pre></div>

	<h3>Further considerations</h3>


	<ul>
	<li>If existing communication tools<sup><a href="#fn1">1</a></sup> were to integrate this parser then it would be easy to add a contact by giving the url of, for example, their blog.</li>
		<li>Author&#8217;s should be able to specify the order of the tools that they wish to use for communication.  We could just assume that the list of contact details is in the author&#8217;s preferred order.</li>
		<li>This would be open to spam.  Err, not too sure what to do about this.</li>
		<li>Ultimately, I&#8217;d like to hit a &#8216;communicate&#8217; button in <a href="http://www.mozilla.com/en-US/firefox/">firefox</a> that automatically decides which communication protocols we have in common and allows me to get my message through.</li>
	</ul>


	<p>Anyone have any thoughts?</p>


	<p>Code is all over on <a href="http://chrisroos.googlecode.com/svn/trunk/contact-microformat/">google code</a>.</p>


	<p id="fn1"><sup>1</sup> I&#8217;m thinking of multi protocol tools, like <a href="http://www.adiumx.com/">adium</a>, in particular.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/aim" rel="tag">aim</a>, 
                    
                      <a href="/articles/tag/contact" rel="tag">contact</a>, 
                    
                      <a href="/articles/tag/email" rel="tag">email</a>, 
                    
                      <a href="/articles/tag/im" rel="tag">im</a>, 
                    
                      <a href="/articles/tag/messaging" rel="tag">messaging</a>, 
                    
                      <a href="/articles/tag/microformat" rel="tag">microformat</a>, 
                    
                      <a href="/articles/tag/msn" rel="tag">msn</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/skype" rel="tag">skype</a>, 
                    
                      <a href="/articles/tag/twitter" rel="tag">twitter</a>, 
                    
                      <a href="/articles/tag/yim" rel="tag">yim</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/10/03/finding-similar-sites-by-mining-the-del-icio-us-data">Finding similar sites by mining the del.icio.us data</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 03 Oct 2007 08:00:00">
                    Wed, 03 Oct 2007 08:00:00
                  </span>
                </p>

                <p>So this is very much proof of concept and definitely not very useful in its current form&#8230;</p>


	<p>You need to execute this javascript in the context of a webpage.  In <a href="http://getfirebug.com/">firebug</a> (for example), paste it into the console and run.</p>


<div class="typocode"><pre><code class="typocode_javascript">// Execute this within an existing webpage, using, for example, firebug console
function includeDelicious() {
  function loadScript(scriptUrl) {
    var scriptTag = document.createElement('script');
    scriptTag.setAttribute('type', 'text/javascript');
    scriptTag.src = scriptUrl;
    document.body.appendChild(scriptTag);
  }
  loadScript('http://s3.amazonaws.com/seagul/delicious.js');
}
if (typeof(getRelatedPosts) != 'function') { includeDelicious(); }</code></pre></div>

	<p>The javascript above loads this <a href="http://s3.amazonaws.com/seagul/delicious.js">script</a> that in turn loads <a href="http://s3.amazonaws.com/seagul/md5.js">md5.js</a>,  <a href="http://s3.amazonaws.com/seagul/jquery.js">jquery.js</a>, does some magic with the <a href="http://del.icio.us">del.icio.us</a> <a href="http://www.json.org">json</a> <a href="http://del.icio.us/help/json/">feeds</a> before finally writing some &#8216;similar&#8217; sites to the bottom of the page you&#8217;re currently looking.  At the moment it finds the three most recent sites you&#8217;ve bookmarked for each of the tags that people have used when bookmarking the site you&#8217;re looking at.  It writes all this to the bottom of the current page, as this <a href="http://flickr.com/photos/chrisjroos/1474875125/">screenshot</a> shows.</p>


	<p>Lots of things to do before this could possibly be deemed useful but I think it&#8217;s got some potential.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                    
                      <a href="/articles/tag/dom" rel="tag">dom</a>, 
                    
                      <a href="/articles/tag/javascript" rel="tag">javascript</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/09/29/commenting-on-my-del-icio-us-bookmarks">Commenting on my del.icio.us bookmarks</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 29 Sep 2007 09:32:00">
                    Sat, 29 Sep 2007 09:32:00
                  </span>
                </p>

                <p>A side effect of my <a href="http://del.icio.us">del.icio.us</a> <a href="http://del.icio.us/chrisjroos">bookmarks</a> having <a href="http://blog.seagul.co.uk/articles/2007/09/05/patching-the-del-icio-us-firefox-extension-to-add-permalinks">permalinks</a> is that you can, if you really really want, &#8216;comment&#8217; on them.  You just need to bookmark (in del.icio.us) my permalinked bookmark, write a comment in the notes field and tag it for:chrisjroos.  One small step to people being able to comment on anything they see (just an idea I&#8217;ve had bubbling for a while).</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/bookmark" rel="tag">bookmark</a>, 
                    
                      <a href="/articles/tag/comments" rel="tag">comments</a>, 
                    
                      <a href="/articles/tag/conversation" rel="tag">conversation</a>, 
                    
                      <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/09/29/monitoring-the-mac-osx-filesystem-with-ruby">Monitoring the Mac OSX Filesystem with ruby</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 29 Sep 2007 09:11:00">
                    Sat, 29 Sep 2007 09:11:00
                  </span>
                </p>

                <p>On Thursday, <a href="http://blog.floehopper.org/">James</a> and I spent some time investigating remote pairing options.  One tiny part of that investigation was finding a way to keep two remote filesystems in sync.  I initially thought of using <a href="http://en.wikipedia.org/wiki/Rsync">rsync</a> at regular intervals with <a href="http://en.wikipedia.org/wiki/Cron">cron</a>.  Unless I&#8217;ve missed something, the smallest interval between cron jobs is one minute which is potentially too long.  We wanted a way to rsync (or sync in general) whenever the filesystem changed.  A little searching brought this <a href="http://www.kernelthread.com/software/fslogger/">fslogger</a> tool to my attention.  It simply writes some event details to <span class="caps">STDOUT</span> every time something changes on the filesystem.  I figured that we could use this, with a little bit of ruby glue, to trigger rsync.  Our glue script continuously reads from <span class="caps">STDIN</span>, tries to match some pre-defined patterns and triggers rsync if those patterns are matched.  It&#8217;s very brittle but it gets the job done.  Well, actually, it only partially gets the job done: I&#8217;m very unfamiliar with rsync but it seemed to take between 10 and 30 seconds to sync even if only one file had changed.  I suspect that I may have been doing something wrong though.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment">#!/usr/bin/env ruby</span>

<span class="constant">REMOTE_SERVER</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_REMOTE_SERVER</span><span class="punct">'</span>
<span class="constant">REMOTE_PATH</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_REMOTE_PATH</span><span class="punct">'</span>

<span class="constant">DIRECTORY_PATTERN</span> <span class="punct">=</span> <span class="constant">ARGV</span><span class="punct">.</span><span class="ident">delete_at</span><span class="punct">(</span><span class="number">0</span><span class="punct">)</span>
<span class="keyword">raise</span> <span class="punct">&quot;</span><span class="string">You must specify a directory_pattern</span><span class="punct">&quot;</span> <span class="keyword">unless</span> <span class="constant">DIRECTORY_PATTERN</span>

<span class="keyword">def </span><span class="method">rsync!</span>
  `<span class="ident">rsync</span> <span class="punct">-</span><span class="ident">rz</span> <span class="comment">#{File.join(DIRECTORY_PATTERN, '*')} #{REMOTE_SERVER}:#{REMOTE_PATH}`</span>
<span class="keyword">end</span>

<span class="keyword">while</span> <span class="ident">line</span><span class="punct">=</span><span class="ident">gets</span>
  <span class="keyword">if</span> <span class="ident">line</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">FSE_ARG_VNODE</span><span class="punct">/</span> <span class="comment"># CREATE FILE OR DIR</span>
    <span class="ident">rsync!</span> <span class="keyword">if</span> <span class="ident">line</span><span class="punct">[/</span><span class="regex">path<span class="escape">\s</span>+=(.*)</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">].</span><span class="ident">strip</span> <span class="punct">=~</span> <span class="constant">Regexp</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">DIRECTORY_PATTERN</span><span class="punct">)</span>
  <span class="keyword">elsif</span> <span class="ident">line</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">FSE_ARG_STRING</span><span class="punct">/</span> <span class="comment"># REMOVE FILE OR DIR</span>
    <span class="ident">rsync!</span> <span class="keyword">if</span> <span class="ident">line</span><span class="punct">[/</span><span class="regex">string<span class="escape">\s</span>+=(.*)</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">].</span><span class="ident">strip</span> <span class="punct">=~</span> <span class="constant">Regexp</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">DIRECTORY_PATTERN</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/cron" rel="tag">cron</a>, 
                    
                      <a href="/articles/tag/file" rel="tag">file</a>, 
                    
                      <a href="/articles/tag/file-system" rel="tag">file-system</a>, 
                    
                      <a href="/articles/tag/fslogger" rel="tag">fslogger</a>, 
                    
                      <a href="/articles/tag/rsync" rel="tag">rsync</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/script" rel="tag">script</a>, 
                    
                      <a href="/articles/tag/sync" rel="tag">sync</a>, 
                    
                      <a href="/articles/tag/system" rel="tag">system</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/09/27/why-should-it-do-that">Why should it do that?</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 27 Sep 2007 07:36:00">
                    Thu, 27 Sep 2007 07:36:00
                  </span>
                </p>

                <p>I&#8217;ve started looking into my *cough* promise *cough* to do that <a href="http://blog.seagul.co.uk/articles/2007/06/01/an-open-letter-to-my-local-newspapers">local paper</a> site I mentioned sometime ago.  The code is all in me <a href="http://chrisroos.googlecode.com">google code</a> <a href="http://chrisroos.googlecode.com/svn/trunk/the-local-paper/">repository</a> if you want to see how it&#8217;s going (or finish it when I inevitably get bored again&#8230;).</p>


	<p>Anyway, the point of this post is that I realised something about testing that I feel I may have missed in the past.  I&#8217;ve got used to stating the <a href="http://behaviour-driven.org/">behavior</a> of the objects in my system through tests.  So, when I wanted to ensure that an article couldn&#8217;t be created without a title, I added a test like so:</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">ArticleTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">test_should_validate_presence_of_title</span>
    <span class="punct">...</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>In fact, for an article comprised of a title, an edition, a page number and an author, I wanted to ensure that all were there apart from the author.  It was only once I&#8217;d added tests to <a href="http://api.rubyonrails.org/classes/ActiveRecord/Validations.html">validate</a> the presence of the other three attributes that I realised it was probably important to prove that an author wasn&#8217;t required.  So, I added the relevant test.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">ArticleTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">test_should_not_validate_presence_of_author</span>
    <span class="punct">...</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>That&#8217;s all well and good, but I&#8217;ve lost some information: <span class="caps">WHY</span> it shouldn&#8217;t validate the presence of an author.  I know at the moment why it shouldn&#8217;t (because short articles don&#8217;t have an author listed), but will I know at some point the future?  I suspect not.  The same obviously applies for the things that I do want to ensure are present.  Why do I care that an article has a title, edition and page number?  At the moment I care because I&#8217;m planning on making them part of the <span class="caps">URL</span>, but what if I decide not to go down that route, yet leave the tests there?  There&#8217;ll be no easy way for someone in the future to determine whether those things are actually important or not.</p>


	<p>I wonder if this issue was highlighted because of my lack of <a href="http://subversion.tigris.org/"><span class="caps">SVN</span></a> access.  I generally like really small checkins to my <a href="http://en.wikipedia.org/wiki/Revision_control">version control software</a> which would&#8217;ve allowed me to have added and committed those validation additions one at a time, and with messages that would have stated the reasons for that change<sup><a href="#fn1">1</a></sup>.  Being disconnected means that I end up with bigger checkins that inevitably lose some information.  Actually, the more I think about it, the more I think that the repository isn&#8217;t the right place for this information anyway &#8211; it&#8217;s too far away from the code that&#8217;s solving the problems.</p>


	<p>How do other people solve this potential loss of knowledge?  Am I missing something obvious, or have I really just not noticed this before?</p>


	<p>P.S. I spent a few minutes chatting with <a href="http://interblah.net/">James</a> about it today and he had some interesting suggestions, although I&#8217;ll leave it up to him to share those if he wants (no pressure James, I&#8217;m just running out of time right now I&#8217;m afraid).</p>


	<p id="fn1"><sup>1</sup> <a href="http://po-ru.com">Paul</a> suggested a while back that we use the commit note to explain the problem that we&#8217;ve solved, rather than just describing the changeset.  Unfortunately, I can&#8217;t find the source of that suggestion so no link I&#8217;m afraid.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/agiledox" rel="tag">agiledox</a>, 
                    
                      <a href="/articles/tag/bdd" rel="tag">bdd</a>, 
                    
                      <a href="/articles/tag/development" rel="tag">development</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/tdd" rel="tag">tdd</a>, 
                    
                      <a href="/articles/tag/test" rel="tag">test</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/09/21/companies-you-must-make-it-simple-for-me-to-unsubscribe-from-your-marketing-shite">Companies.  You must make it simple for me to unsubscribe from your marketing shite.</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 21 Sep 2007 07:40:00">
                    Fri, 21 Sep 2007 07:40:00
                  </span>
                </p>

                <p>Over the past few months I&#8217;ve been actively trying to unsubscribe from things that I&#8217;m no longer interested in.  Both electronic and traditional mail.</p>


	<p>I&#8217;ve started to keep a little <a href="http://chrisjroos.stikipad.com/unsubscriptions/show/HomePage">record</a> of when I receive said shite and when I unsubscribe.</p>


	<p>Something I&#8217;ve learned over this short time.  The majority of companies make it very easy for you to signup to receive their shite.  It is almost always harder (if only by one step) to unsubscribe from the same material.  Why?  If I&#8217;m trying to unsubscribe it&#8217;s probably because I&#8217;m not interested in what you&#8217;re doing.  Why would you possibly want to make it hard for me to go.  Why not just add a second button to the form that makes it easy for me to subscribe.  This button would say &#8216;unsubscribe&#8217; and would do exactly that.  Easy huh.  Now, go do it The Companies.</p>


	<p>This reminds me that I think my contract is now up with <a href="http://blog.seagul.co.uk/articles/2007/03/16/orange-orange-orange">Orange</a>.  Time to get myself a new provider me thinks.</p>


	<p>A nice positive blog post to start the day :-)</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/marketing" rel="tag">marketing</a>, 
                    
                      <a href="/articles/tag/shite" rel="tag">shite</a>, 
                    
                      <a href="/articles/tag/spam" rel="tag">spam</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/09/05/patching-the-del-icio-us-firefox-extension-to-add-permalinks">Patching the del.icio.us firefox extension to add permalinks</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 05 Sep 2007 22:41:00">
                    Wed, 05 Sep 2007 22:41:00
                  </span>
                </p>

                <p>I spent some of my train time today hacking around with the <a href="http://del.icio.us">del.icio.us</a> <a href="http://www.mozilla.com/en-US/firefox/">firefox</a> <a href="https://addons.mozilla.org/en-US/firefox/addon/3615">extension</a>.  Although I&#8217;m sure it&#8217;s bad in many, many ways, I&#8217;ve managed to add the <a href="http://en.wikipedia.org/wiki/Permalink">permalink</a> functionality I <a href="http://blog.seagul.co.uk/articles/2007/09/04/permalinks-for-del-icio-us-bookmarks-posts">mentioned</a> yesterday.  You can either apply the patch yourself, or download the patched jar file.</p>


	<h3>To apply the patch.</h3>


<div class="typocode"><pre><code class="typocode_default"># Install Firefox extension 1.5.43
$ cd MY_FIREFOX_PROFILE_DIRECTORY # ~/Library/Application Support/Firefox/Profiles/RAND_CHARS.default for me
$ cd extensions/{2fa4ed95-0317-4c6a-a74c-5f3e3912c1f9}/chrome
$ svn export http://chrisroos.googlecode.com/svn/trunk/delicious_url_tags/delicious-extension-url-tag.patch
$ unzip deliciousBookmarks.jar
$ rm deliciousBookmarks.jar
$ patch -p1 &lt; delicious-extension-url-tag.patch
$ zip -r deliciousBookmarks.jar content/ locale/ skin/ 
$ rm -rf content/ locale/ skin/
# Restart Firefox</code></pre></div>

	<h3>To use the patched compressed file</h3>


<div class="typocode"><pre><code class="typocode_default"># Install Firefox extension 1.5.43
$ cd MY_FIREFOX_PROFILE_DIRECTORY # ~/Library/Application Support/Firefox/Profiles/RAND_CHARS.default for me
$ cd extensions/{2fa4ed95-0317-4c6a-a74c-5f3e3912c1f9}/chrome
$ rm deliciousBookmarks.jar
$ svn export http://chrisroos.googlecode.com/svn/trunk/delicious_url_tags/deliciousBookmarks.jar 
# Restart Firefox</code></pre></div>

	<p>Now, anytime you bookmark a site, the tags field will be pre-populated with a url-tag (&#8220;url/MD5_OF_URL&#8221;).  Cool huh.  Oh, and the patched extension uses this javascript <a href="http://pajhome.org.uk/crypt/md5/">md5</a> library.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/bookmarks" rel="tag">bookmarks</a>, 
                    
                      <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                    
                      <a href="/articles/tag/extension" rel="tag">extension</a>, 
                    
                      <a href="/articles/tag/firefox" rel="tag">firefox</a>, 
                    
                      <a href="/articles/tag/permalinks" rel="tag">permalinks</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/09/04/permalinks-for-del-icio-us-bookmarks-posts">Permalinks for del.icio.us bookmarks (posts)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 04 Sep 2007 23:23:00">
                    Tue, 04 Sep 2007 23:23:00
                  </span>
                </p>

                <p>I&#8217;ve wondered in the <a href="http://tech.groups.yahoo.com/group/ydn-delicious/message/1447">past</a> about sending <a href="http://en.wikipedia.org/wiki/Trackback">trackbacks</a> (or <a href="http://en.wikipedia.org/wiki/Pingback">pingbacks</a>) to bookmarked resources on <a href="http://del.icio.us">del.icio.us</a>.  As with most things, you can either wait for someone to do it for you, or you can do it yourself&#8230;  I started to investigate last Thursday afternoon and soon got sucked into the much more interesting issue of the missing <a href="http://en.wikipedia.org/wiki/Permalink">permalinks</a> for bookmarks.  You see, every time you bookmark something on del.icio.us, you are creating a new <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer#REST.27s_Central_Principle:_Resources">resource</a>.  Unfortunately, it&#8217;s a very sad :-( resource.  Sad because it doesn&#8217;t have a <a href="http://www.wikipedia.org/wiki/URL"><span class="caps">URL</span></a> and so can&#8217;t be linked to.  An anonymous resource floating around the world wide web looking for love.  Boo hoo.  Anyway, enough of that.  I figured that if we could assign a unique tag to each of these resources then they would, as a side effect, get a permalink (you can already get your bookmarks containing a given tag by using http://del.icio.us/USERNAME/MY_TAG).  I experimented with using the url as a tag.  Although there seem to be some limits on what you can use, I found that if you strip the protocol and trailing slash from a url you are generally OK.  So, if we bookmark <a href="http://news.bbc.co.uk"><span class="caps">BBC</span> News</a> and tag it with news.bbc.co.uk then we can access that individual bookmark at <a href="http://del.icio.us/chrisjroos/news.bbc.co.uk">http://del.icio.us/chrisjroos/news.bbc.co.uk</a>.</p>


	<p><a href="http://flickr.com/photos/chrisjroos/1293075032/"><img src="http://farm2.static.flickr.com/1140/1293075032_372cce286d_m.jpg" alt="" /></a></p>


	<p>As you can only bookmark the same <span class="caps">URL</span> once, it should guarantee that the url-tag is unique.  I can, however, see a problem with the trailing slash.  Although it&#8217;s possible to bookmark URLs that differ only in the trailing slash (http://example.com/article1 and http://example.com/article1/ for example), it doesn&#8217;t seem possible to create a tag that contains that same trailing slash.  OK, so we could always ensure that we remove the trailing slashes from the URLs we bookmark but that doesn&#8217;t seem like a very robust solution.</p>


	<p>While experimenting, I found that I could use forward slashes within my tags, www.foo.com/bar/baz for example.  So, I started prepending url/ to my url-tag so that I could easily recognise posts that already had permalinks.  It was at this time that I noticed the similarity between the del.icio.us url history page del.icio.us/url/MD5_OF_URL (e.g. <a href="http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151"><span class="caps">BBC</span> News</a>) and my permalinked bookmark, del.icio.us/chrisjroos/url/URL.  If I was to <a href="http://en.wikipedia.org/wiki/MD5">hash</a> the bookmarked url in the same way as del.icio.us then I would end up with a url like del.icio.us/chrisjroos/url/MD5_OF_URL.  You can see the similarity in the URLs below.</p>


	<ul>
	<li><a href="http://del.icio.us/chrisjroos/url/4961e08b5118fbfddec7fb18fa303151">http://del.icio.us/chrisjroos/url/4961e08b5118fbfddec7fb18fa303151</a></li>
		<li><a href="http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151">http://del.icio.us/url/4961e08b5118fbfddec7fb18fa303151</a></li>
	</ul>


	<p>It looks as though it&#8217;s part of del.icio.us itself doesn&#8217;t it?  Cool huh.  It&#8217;d be really cool to extend the del.icio.us <a href="http://www.mozilla.com/en-US/firefox/">firefox</a> <a href="https://addons.mozilla.org/en-US/firefox/addon/1532">extension</a> to automatically add this tag when bookmarking a site.</p>


	<p>I&#8217;ve created a crappy script that will add this url/MD5_OF_URL tag to each of your posts.  It&#8217;s hosted on <a href="http://chrisroos.googlecode.com/svn/trunk/delicious_url_tags">google code</a> and pasted below.  Err, use at your own risk by the way.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">USERNAME</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_USERNAME</span><span class="punct">'</span>
<span class="constant">PASSWORD</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_PASSWORD</span><span class="punct">'</span>
<span class="constant">POSTS_CACHE</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">FILE_TO_STORE_YOUR_EXISTING_DELICIOUS_POSTS_IN</span><span class="punct">'</span>

<span class="comment"># GET ALL POSTS</span>
<span class="keyword">unless</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">exists?</span><span class="punct">(</span><span class="constant">POSTS_CACHE</span><span class="punct">)</span>
  <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Downloading all posts...</span><span class="punct">&quot;</span>
  <span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">&lt;&lt;-</span><span class="constant">EndCurl</span><span class="string">
curl &quot;https://api.del.icio.us/v1/posts/all&quot; <span class="escape">\
</span>-u&quot;<span class="expr">#{USERNAME}</span>:<span class="expr">#{PASSWORD}</span>&quot; <span class="escape">\
</span>-s
&gt; <span class="expr">#{POSTS_CACHE}</span></span><span class="constant">
  EndCurl</span>
  `<span class="comment">#{curl_cmd}`</span>
<span class="keyword">end</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">hpricot</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">md5</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">cgi</span><span class="punct">'</span>

<span class="keyword">def </span><span class="method">add_url_hash_to_post</span><span class="punct">(</span><span class="ident">post</span><span class="punct">)</span>
  <span class="ident">url</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">post</span><span class="punct">['</span><span class="string">href</span><span class="punct">'])</span>
  <span class="ident">url_hash</span> <span class="punct">=</span> <span class="constant">MD5</span><span class="punct">.</span><span class="ident">md5</span><span class="punct">(</span><span class="ident">url</span><span class="punct">)</span>
  <span class="ident">url</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="ident">url</span><span class="punct">)</span>

  <span class="ident">tags</span> <span class="punct">=</span> <span class="ident">post</span><span class="punct">['</span><span class="string">tag</span><span class="punct">'].</span><span class="ident">split</span><span class="punct">('</span><span class="string"> </span><span class="punct">').</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">tag</span><span class="punct">|</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">tag</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="ident">tags</span> <span class="punct">&lt;&lt;</span> <span class="punct">&quot;</span><span class="string">url/<span class="expr">#{url_hash}</span></span><span class="punct">&quot;</span> <span class="keyword">unless</span> <span class="ident">tags</span><span class="punct">.</span><span class="ident">include?</span><span class="punct">(&quot;</span><span class="string">url/<span class="expr">#{url_hash}</span></span><span class="punct">&quot;)</span>
  <span class="ident">tags</span> <span class="punct">=</span> <span class="ident">tags</span><span class="punct">.</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">tag</span><span class="punct">|</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="ident">tag</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="ident">tags</span> <span class="punct">=</span> <span class="ident">tags</span><span class="punct">.</span><span class="ident">join</span><span class="punct">('</span><span class="string"> </span><span class="punct">')</span>

  <span class="ident">shared</span> <span class="punct">=</span> <span class="ident">post</span><span class="punct">['</span><span class="string">shared</span><span class="punct">']</span>
  <span class="ident">description</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">post</span><span class="punct">['</span><span class="string">description</span><span class="punct">']))</span>
  <span class="ident">extended</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">escape</span><span class="punct">(</span><span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">post</span><span class="punct">['</span><span class="string">extended</span><span class="punct">']))</span>

  <span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">&lt;&lt;-</span><span class="constant">EndCurl</span><span class="string">
curl &quot;https://api.del.icio.us/v1/posts/add&quot; <span class="escape">\
</span>-u&quot;<span class="expr">#{USERNAME}</span>:<span class="expr">#{PASSWORD}</span>&quot; <span class="escape">\
</span>-d&quot;url=<span class="expr">#{url}</span>&quot; <span class="escape">\
</span>-d&quot;description=<span class="expr">#{description}</span>&quot; <span class="escape">\
</span>-d&quot;extended=<span class="expr">#{extended}</span>&quot; <span class="escape">\
</span>-d&quot;tags=<span class="expr">#{tags}</span>&quot; <span class="escape">\
</span>-d&quot;shared=<span class="expr">#{shared}</span>&quot; <span class="escape">\
</span>-s
</span><span class="constant">  EndCurl</span>
  `<span class="comment">#{curl_cmd}`</span>
<span class="keyword">end</span>

<span class="comment"># ADD THE URL/&lt;md5_hash&gt; TAG TO EACH POST</span>
<span class="ident">posts_xml</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">open</span><span class="punct">(</span><span class="constant">POSTS_CACHE</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">f</span><span class="punct">|</span> <span class="ident">f</span><span class="punct">.</span><span class="ident">read</span> <span class="punct">}</span>
<span class="ident">posts_doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">posts_xml</span><span class="punct">)</span>
<span class="ident">count</span> <span class="punct">=</span> <span class="number">1</span>
<span class="punct">(</span><span class="ident">posts_doc</span><span class="punct">/'</span><span class="string">posts</span><span class="punct">'/'</span><span class="string">post</span><span class="punct">').</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">post_xml</span><span class="punct">|</span>
  <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Bookmark: <span class="expr">#{count}</span></span><span class="punct">&quot;</span> <span class="keyword">if</span> <span class="punct">(</span><span class="ident">count</span> <span class="punct">%</span> <span class="number">5</span><span class="punct">)</span> <span class="punct">==</span> <span class="number">0</span>
  <span class="ident">add_url_hash_to_post</span><span class="punct">(</span><span class="ident">post_xml</span><span class="punct">.</span><span class="ident">attributes</span><span class="punct">)</span>
  <span class="ident">count</span> <span class="punct">+=</span> <span class="number">1</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/bookmark" rel="tag">bookmark</a>, 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/curl" rel="tag">curl</a>, 
                    
                      <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                    
                      <a href="/articles/tag/permalink" rel="tag">permalink</a>, 
                    
                      <a href="/articles/tag/pingback" rel="tag">pingback</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/trackback" rel="tag">trackback</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/08/31/blue-card-user-stories-coming-out-of-the-reevoo-com-feedback">Blue card user stories coming out of the reevoo.com feedback</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 31 Aug 2007 15:13:00">
                    Fri, 31 Aug 2007 15:13:00
                  </span>
                </p>

                <p>It took me a while, but I&#8217;ve come up with some <a href="http://en.wikipedia.org/wiki/User_story">stories</a> to represent the feature requests from the <a href="http://www.reevoo.com">reevoo.com</a> <a href="http://blog.seagul.co.uk/articles/2007/08/23/responses-to-reevoo-com-feedback">feedback</a>.</p>


	<p>I (well <a href="http://www.po-ru.com">Paul</a> actually) even took a photo to prove it.</p>


	<p><a href="http://flickr.com/photos/chrisjroos/1284248507"><img src="http://farm2.static.flickr.com/1175/1284248507_c7d8653554_m.jpg" alt="" /></a></p>


	<p>We have a <a href="http://en.wikipedia.org/wiki/Extreme_Programming_Practices#Planning_game">planning game</a> next Tuesday (4th Sep) so we&#8217;ll have to wait to see if any of them get in.</p>


	<p>I&#8217;ve written the cards out in full below.  If anyone recognises one of their requests and thinks I&#8217;ve misrepresented it then feel free to let me know.</p>


	<h3>Remove search filters</h3>


	<p>As a user of reevoo.com, I want to be able to remove filters in the same way that I can add them, so that I don&#8217;t have to start my search again if I want to change my search criteria.</p>


	<h3>Display scores of related products</h3>


	<p>As a user of reevoo.com, I want to see the scores of &#8216;related products&#8217;, so that I can instantly decide whether those products might be of interest to me.</p>


	<h3>Display usefulness of reviews</h3>


	<p>As a user of reevoo.com, I want to know how useful the reviews are, so that I can get a feel for the &#8216;importance&#8217; of a review.</p>


	<h3>Favicon</h3>


	<p>As a user of reevoo.com, I want to immediately identify your favicon with reevoo branding, so that I can immediately pick it out in my search history and browser tabs.</p>


	<h3>Recently viewed products</h3>


	<p>As a user of reevoo.com, I want to see a list of my recently viewed products, so that I can easily find my way back to the products I&#8217;m interested in.</p>


	<h3>Scores obviously out of 10</h3>


	<p>As a user of reevoo.com, I want it to be obvious that the review scores are out of 10, so that I don&#8217;t waste time trying to work it out and can, instead, find the products that I&#8217;m interested in.</p>


	<h3>Product count on supercategory pages</h3>


	<p>As a user of reevoo.com, I always want to see the number of products appear next to the product category, so that I can easily scan down the list of categories.</p>


	<h3>General comments</h3>


	<p>As a user of reevoo.com, I want to be able to immediately identify that the general comments are indeed general comments, so that I don&#8217;t waste time trying to work out what they are and whether they&#8217;re important.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/08/23/responses-to-reevoo-com-feedback">Responses to reevoo.com feedback</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 23 Aug 2007 15:14:00">
                    Thu, 23 Aug 2007 15:14:00
                  </span>
                </p>

                <p>First of all I&#8217;d like to thank the 18 people that left feedback about the new <a href="http://www.reevoo.com">reevoo.com</a>, either in the comments on my <a href="http://blog.seagul.co.uk/articles/2007/08/01/a-new-reevoo-com">post</a> or in replies to emails sent out by various people in the company.  I&#8217;ve tried to collate the feedback (paraphrasing the points) and provide answers to each point in turn.</p>


	<p>Moving forward, we&#8217;ve created a public <a href="http://groups.google.com/group/reevoo-website">google group</a> to discuss <a href="http://www.reevoo.com">reevoo.com</a>.  Membership is open to all so feel free to sign-up.  <a href="http://www.reevoo.com/pages/about_us#Richard">Richard</a> has a few reservations about exposing ourselves to the potential problems that an open forum can bring, so this is kinda-like a private invite that the <a href="http://www.techcrunch.com">techcrunch</a> crowd love so much.  I really appreciate Richard giving us the freedom to experiment with the group and would love to see people joining up to discuss how we can make reevoo.com a better place.</p>


	<p>Anyway, on with the feedback&#8230;</p>


	<h3>Points raised by four different people</h3>


	<h4>I want it to be obvious when you couldn&#8217;t find any products for my search query.  Currently, as no message is displayed, it&#8217;s unclear whether my search didn&#8217;t work or the site is broken.</h4>


	<p>This has been fixed and is now live on <a href="http://www.reevoo.com/search?q=blurgh">reevoo.com</a>.</p>


	<h4>I question whether the google map, on the homepage, is useful.</h4>


	<p>Hmm, this is obviously a bit subjective.  While four people have questioned its usefulness (including one person that wanted to kill the individual that came up with it &#8211; err, yeah, sorry about that), three people have said that it really helps to understand where the reviews come from.  I&#8217;m open-minded but think we&#8217;ll probably keep it there for now and possibly remove it in the future if the bounce rate (from the homepage) becomes something that we care about.</p>


	<h3>Points raised by three different people</h3>


	<h4>I like the google map.</h4>


	<p>Yay.  Actually, you should probably see the point above.</p>


	<h4>I don&#8217;t always have enough time to read the reviews that flash up as part of the google map.</h4>


	<p>Agreed.  Each review is now displayed for 10 seconds, rather than the previous 5.  The development is complete, we&#8217;re just waiting for a deployment.</p>


	<h4>I find the supercategory pages (linked from the tabs at the top) hard to navigate as the categories on the left of the screen don&#8217;t appear in any useful order.</h4>


	<p>The categories are now in alphabetic order.  We also only display the five most popular (as decided by the reevoo gods) categories when you first visit the page, giving you the option to show all if you wish.</p>


	<h4>I want to be able to click the review on the homepage to see all reviews of that product.</h4>


	<p>I felt quite strongly about this too.  It didn&#8217;t seem right that a product page (with the reviews on) was a minimum of two clicks away from the homepage.  We&#8217;ve fixed this up and it&#8217;s now live.  If any of the reviews that pop-up on the homepage take your fancy then click the name of product (in the review box on the right hand side) to visit that page.</p>


	<h4>I want to know what order the products appear in on the search results and category pages.</h4>


	<p>They appear in the top-secret reevoo ranking order.  Muhahaha.  Actually, it&#8217;s not that top secret.  It&#8217;s a combination of the review score over time (how &#8216;good&#8217; it is), the number of times people see the reevoomark for that product on our partner sites (how &#8216;popular&#8217; it is) and the number of prices we get from <a href="http://www.shopping.com">shopping.com</a> (how &#8216;current&#8217; it is).</p>


	<h3>Points raised by two different people</h3>


	<h4>I want to understand the relationship between the overall score and the score breakdown for a product.  For example, the <a href="http://www.reevoo.com/reviews/mpn/ericsson/k800i">Ericsson K800i</a> is rated 9/10 yet it only scored above average in one category (&#8216;features&#8217;).</h4>


	<p>A bit of an explanation is required I feel.  The overall review score you see (9/10 in this instance) is made up of some averaged averages (hmmm, that&#8217;s not too helpful).  OK, so a reviewer will be asked a series of questions about their purchase.  Some of these questions will require text answers, while some will require a score out of ten.  For each review, we calculate the <a href="http://en.wikipedia.org/wiki/Mean#Arithmetic_mean">average</a> of all of these scores out of ten.  We then calculate the average score for a product based on each of these average review scores.  This is what will give us the 9/10 for the k800i.
The score breakdown is based on an average per question for this product versus the average per question for every product the same category as this one (hmmm, again, that&#8217;s not very clear either).  As a contrived example, let&#8217;s assume that we have two mobile phones, each with one review.  The first mobile phone (a very basic model) is awarded 6/10 for &#8216;features&#8217;.  The second mobile (a newer, all singing, all dancing model) is awarded 10/10 for &#8216;features&#8217;.  We calculate the average &#8216;features&#8217; score for mobile phones as 8/10 (6 + 10 / 2).  We use this data to state that the first mobile is &#8216;below average&#8217;, while the second mobile is &#8216;above average&#8217;, in the &#8216;features&#8217; department.  Does that make sense?</p>


	<h4>I don&#8217;t really understand the score breakdown.</h4>


	<p>See the above explanation and the one in the <a href="http://www.reevoo.com/pages/faqs#scores">Faq</a>.  If this is still unclear to folks then we should flesh it out a little further.</p>


	<h4>I&#8217;d like to see ratings against similar products in the &#8216;Other products like this&#8217; section.</h4>


	<p>I&#8217;ve added a <a href="http://en.wikipedia.org/wiki/User_story">story</a> to our development schedule that should hopefully see this feature added in the near future.</p>


	<h4>I&#8217;m having problems navigating the <a href="http://www.reevoo.com/pages/faqs">Faq</a></h4>


	<p>Unfortunately I&#8217;ve never been able to replicate this problem.  Are people still experiencing it?</p>


	<h4>I want to be able to filter the search results so that I&#8217;m not too overwhelmed when I search for a relatively generic term (e.g. <a href="http://www.reevoo.com/search?q=phone">phone</a>)</h4>


	<p>We&#8217;ve added the ability to filter your search results by product category.  Having just searched for &#8216;phone&#8217;, I get the option to filter by &#8216;Cordless phone&#8217;, &#8216;Cordless phone with answering machine&#8217;, &#8216;landline phones&#8217;, &#8216;mobile phone accessories&#8217;, &#8216;mobile phones&#8217; and a further 24 categories.</p>


	<h4>I don&#8217;t understand what the quartile link is that appears on the left hand side of a category page.</h4>


	<p>And neither do I :-)  Don&#8217;t worry though, because we&#8217;ve removed it.</p>


	<h4>I want to know why the comments on the google map don&#8217;t always appear where they should.</h4>


	<p>This&#8217;ll be because the description of the location is completely separate from the location itself.  The description of the location is entered by the reviewer when they complete the review.  Although we ask for the town, they could actually enter anything they wish.  As we didn&#8217;t think this data would be reliable enough to plot points on the map, we use the first bit of the delivery postcode instead.</p>


	<h4>I want products to have a human friendly name, Canon 4000 <span class="caps">SLR</span> instead of Canon <span class="caps">EOS 400D</span>, for example.</h4>


	<p>I&#8217;m a bit confused by this as the <span class="caps">EOS 400D</span> seems to be how <a href="http://www.canon.co.uk/eos400d">Canon</a> (it&#8217;s sad but that&#8217;s a great url) refer to it.  I&#8217;m also slightly confused as it seems we label this particular product as a Canon 4000 <span class="caps">SLR</span> when it appears on the homepage, but as the <span class="caps">EOS 400D</span> on the <a href="http://www.reevoo.com/reviews/mpn/canon/eos_4000_slr">product page</a>.  Does anyone else have any examples of misnamed products?</p>


	<h4>I want it to be obvious that the scores are out of ten.</h4>


	<p>This has been raised a couple of times internally and I personally agree that it&#8217;s not very clear.  I&#8217;m not sure that we&#8217;ve come to any decisions yet though.</p>


	<h4>I want to be able to buy a product from your site.</h4>


	<p>You can!  Well, in some cases.  We use <a href="http://www.shopping.com">shopping.com</a> to provide us with links to retailer sites that you can purchase the product from.  Just click on the shopping basket at the top of the product page, select the retailer you&#8217;re interested in and go buy it.</p>


	<p><strong><span class="caps">NB1</span>.</strong> This is how we make money on reevoo.com.</p>


	<p><strong><span class="caps">NB2</span>.</strong> As much as I think this sounds like one of the made up entries you see in some Faqs (&#8220;I love your site/product and want to give you some money, please tell me how&#8221;), I can assure you that it&#8217;s not.</p>


	<h4>I&#8217;m not sure about the language of some of the commentary on the site.</h4>


	<p>Hmm, this isn&#8217;t too specific so I&#8217;m not sure there&#8217;s much I can say really&#8230;</p>


	<h4>I prefer the selected tabs (no underline) to the unselected tabs (with an underline).</h4>


	<p>I agree that there is some inconsistency but I think we really wanted to make it obvious that the tabs were indeed links.  I believe there may also be some accessibility issues with using images as links.</p>


	<h4>I find it difficult to navigate the super category pages due to the long list of links down the left hand side.</h4>


	<p>As mentioned in one of the responses above, we now only display the five most popular categories (as decided by the reevoo gods) when you first visit the page, giving you the option to show all if you wish.  This should hopefully make it a little more manageable.</p>


	<h3>Points raised by individuals</h3>


	<h4>I don&#8217;t like the spelling errors in the reviews.</h4>


	<p>I&#8217;m afraid there&#8217;s absolutely nothing we can do about this.  Apart from <a href="http://www.reevoo.com/pages/faqs#not_published">rejecting</a> some reviews we don&#8217;t touch them.  Although, maybe we could do our bit for north/south relations and see if one is more literate than the other :-)</p>


	<h4>I don&#8217;t immediately relate your <a href="http://www.reevoo.com/images/favicon.ico">favicon</a> to your branding.</h4>


	<p>That&#8217;s probably a fair point.  I think that that little logo used to be one of our strong identifiers but I&#8217;m wondering if it&#8217;s now the orange colour instead.  I&#8217;ll pass the point on and see what others think.</p>


	<h4>I want all of the same type of product to appear in the same category, e.g. <a href="http://www.reevoo.com/browse/product_type/In+Ear">in-ear headphones</a> and <a href="http://www.reevoo.com/browse/product_type/Headphones">&#8216;normal&#8217; headphones</a> should appear together.</h4>


	<p>I agree that this isn&#8217;t currently very good.  We use a company called <a href="http://www.encodex.com">Encodex</a> for our product data.  Although we try to sanitize that data (removing useless facets like &#8216;quartile&#8217; for example) we still have someway to go.  We were actually discussing this yesterday and a <a href="http://en.wikipedia.org/wiki/User_story">story</a> should be on its way into the development schedule pretty soon.</p>


	<h4>I couldn&#8217;t find any Sony mobile phones.</h4>


	<p>I&#8217;m not sure why as they are certainly <a href="http://www.reevoo.com/search?q=sony+mobile+phone">there</a> now.</p>


	<h4>I&#8217;m not sure that the <a href="http://www.reevoo.com/pages/about_revieworld">about us</a> page is professional enough.</h4>


	<p>It looks OK to me but then I have a feeling that it may have been changed since this suggestion was made.  Do people still have concerns about it?</p>


	<h4>I find it hard to differentiate between the light blue text and the darker blue hyperlinks on certain pages, e.g. the <a href="http://www.reevoo.com/pages/faqs">Faq</a></h4>


	<p>I understand the concern but I&#8217;m not sure whether it&#8217;s something we&#8217;re currently worried about.  Maybe we need to look at whether people ever click on the links from the Faq page.  If they don&#8217;t then it either suggests that they are not interested in the content or that they can&#8217;t see the links.</p>


	<h4>I can&#8217;t easily get back to the home page.  There&#8217;s a little &#8216;home&#8217; link in the breadcrumbs but nothing more obvious.</h4>


	<p>You can always click on the reevoo logo that appears on the top left to get back to the homepage.</p>


	<h4>I want to see at a glance whether a score is an average for the product or from just one review.</h4>


	<p>The actual suggestion was to make the product scores a different colour.  Although we could do it, I&#8217;m not sure about the benefits.  After all, even the scores from the individual reviews are actually an average of all the scores from that review (explained in more detail above).</p>


	<h4>I want to know whether you round up or down and whether you use decimal points in your scores.</h4>


	<p>Good question (read &#8211; I don&#8217;t know the answer off the top of my head).  There&#8217;s probably a moderate amount of work to get the definitive answer so I&#8217;ll look into this separately and maybe add it to the <a href="http://www.reevoo.com/pages/faqs">Faq</a> or to a page in the <a href="http://groups.google.com/group/reevoo-website">group</a>.</p>


	<h4>I searched for something and got five pages of results.  Only four of those pages had any content.</h4>


	<p>This was a <a href="http://www.urbandictionary.com/define.php?term=Schoolboy+Error">schoolboy error</a> on our part.  The paging was calculated on 10 products per page yet we were displaying 12.  Oops.  All fixed now.</p>


	<h4>I&#8217;d like to be able to remove a filter independently of the rest.</h4>


	<p>Interesting suggestion and definitely something that has been discussed in the past.  I&#8217;ll get it raised as a <a href="http://wikipedia.org/wiki/user_story">story</a> and see if it gets prioritised.</p>


	<h4>I&#8217;m able to close the balloons on the google map.</h4>


	<p>Hmm, so you are.  Although I think we&#8217;ve removed the functionality to close a balloon by clicking anywhere on the map, I don&#8217;t believe we can remove the ability to close them altogether.</p>


	<h4>I&#8217;d like to have a list of recently viewed products.</h4>


	<p>Can&#8217;t you use the back button?  Sorry :-)  This has been discussed in the past.  The best I can do right now is get it raised as a <a href="http://wikipedia.org/wiki/user_story">story</a> and see if it gets prioritised.</p>


	<h4>I searched for <a href="http://www.reevoo.com/search?q=orange">orange</a> and got a <a href="http://www.reevoo.com/reviews/ean/5390660094286">Creative Zen Micro</a> in my search results but couldn&#8217;t understand why.</h4>


	<p>That&#8217;ll be because we have some top-secret (read, legacy) content that is searched but not displayed.  There&#8217;s a <a href="http://wikipedia.org/wiki/user_story">story</a> for this that&#8217;s waiting to be prioritised.</p>


	<h4>I want people to be able to leave a review for a product.  This would be especially useful for products that currently don&#8217;t have reviews.</h4>


	<p>We used to offer this functionality but <a href="http://www.reevoo.com/blogs/reevooblog/2006/12/21/add-a-review-its-been-removed">withdrew it</a> in December 2006.  I&#8217;m pretty certain that it&#8217;s not something that we&#8217;re considering re-implementing.</p>


	<h4>I want to see the list of categories (currently appearing under the search box) higher up the homepage.</h4>


	<p>I agree that it isn&#8217;t immediately obvious (especially with a lower screen resolution) how you might navigate into the site from the homepage.  As with assessing whether or not the google map should stay on the homepage, I think we&#8217;ll need to look at how many people disappear straight from the homepage and decide whether we want to play around with the layout in order to reduce it.</p>


	<h4>I want it to be made very clear that I can&#8217;t leave a review on the site.</h4>


	<p>The three step diagram at the bottom of the homepage was intended to convey this idea.  Maybe people don&#8217;t look at it because it&#8217;s too low down the page (it appears &#8216;below the fold&#8217; for the 45% of our visitors that have their screen resolution set to 1024&#215;768), or maybe it just isn&#8217;t very clear?</p>


	<h4>I was confused by the separation of the review content from the google map, on the homepage.</h4>


	<p>I agree and actually think I may have made it slightly more confusing, as there is now a small delay between the balloon appearing on the map and the review showing on the right hand side of the homepage&#8230;  I guess we&#8217;ll look into this as part of the slightly bigger issue of the homepage in general.</p>


	<h4>I&#8217;m not sure the plus and minus icons will be clear enough for people that need textual signposts to help them.</h4>


	<p>I assume you are referring to the accessibility of the site to visually impaired users.  If so, is our use of the <a href="http://www.w3.org/TR/html401/struct/objects.html#adef-alt">alt tag</a> not sufficient?  We currently have the alternative text of the <a href="http://www.reevoo.com/images/plus.gif">plus</a> image as &#8216;good points&#8217;, and the alternative text of the <a href="http://www.reevoo.com/images/minus.gif">minus</a> image as &#8216;bad points&#8217;.</p>


	<h4>I struggled to find the paging on a supercategory page, as it was hidden right at the very bottom of the page.</h4>


	<p>Two things should help this situation.  The first is that the long list of categories on the left side of the page now default to be only five long, and the second is that we&#8217;ve removed the paging :-)</p>


	<h4>I want to know how many times a review has been voted useful or useless when ordering reviews by &#8216;useful&#8217;.</h4>


	<p>I&#8217;ll add a <a href="http://wikipedia.org/wiki/user_story">story</a> to the development schedule and see whether it gets prioritised.</p>


	<h4>I don&#8217;t understand what &#8216;elsewhere on the web&#8217; means and why it sometimes displays with nothing below it.</h4>


	<p>This has been added in an attempt to make reevoo.com one of the first places to come to when you want product information.  We currently use the <a href="http://developer.yahoo.com/search">yahoo search api</a> to search a preset list of domains (e.g. <a href="http://www.bbc.co.uk">bbc.co.uk</a>, <a href="http://www.t3.co.uk">t3.co.uk</a> and <a href="http://www.engadget.com">engadget</a>) for information related to the product you are looking at.  We also currently search <a href="http://answers.yahoo.com">Yahoo answers</a> and are planning to add many more in the near future.</p>


	<h4>I only seem to be able to filter by one facet at a time.</h4>


	<p>Um, you can definitely filter by multiple facets.  Take <a href="http://www.reevoo.com/browse/product_type/mobile_phones/product_brand/Nokia/Connectivity/Bluetooth/Design/Slider/MP3%252FATRAC%2BPlayback/Yes">All bluetooth and Mp3 enabled Nokia mobile phones that have a sliding front</a> as an example.</p>


	<h4>I sometimes get strange results in the pricing table.  Take this <a href="http://www.reevoo.com/reviews/mpn/hp/psc1610">HP Cartridge</a>, that lists ten entries for &#8216;Cartridge <span class="caps">SAVE</span>&#8217; all at £23.00, as an example.</h4>


	<p>I believe this is to do with the data that we are receiving from <a href="http://www.shopping.com">shopping.com</a> (our pricing provider).  Every link in that list has a different <a href="http://en.wikipedia.org/wiki/URL">Url</a> but they all end up at the same page, maybe suggesting that cartridgesave.co.uk have that link registered multiple times with shopping.com.</p>


	<h4>I find that the high number of anonymous reviews lessens my trust in the promise that all reviews are from genuine customers.</h4>


	<p>Fair point.  I guess all I can do is assure you that we will only invite confirmed purchasers of a product to review said product.  Honest.  We want to allow people to leave anonymous reviews in the hope that we&#8217;ll get more coverage than if people were forced to enter their details.  Having said that I&#8217;m not sure we&#8217;ve ever measured the difference between the two approaches (i.e. requiring some personal details versus allowing people to remain anonymous).</p>


	<h4>I don&#8217;t know for sure what the bold statements at the bottom of a review represent.  I guess they are general comments but I&#8217;m not 100% sure.</h4>


	<p>They are indeed general comments although I agree that it&#8217;s not immediately obvious.  Maybe we need a little icon, like the plus and minus icons, that people can immediately identify.  I&#8217;ll raise it as a <a href="http://wikipedia.org/wiki/user_story">story</a> and we&#8217;ll see if it gets prioritised.</p>


	<h4>I have to scroll down to see all of the homepage.</h4>


	<p>Hmm, I&#8217;ve noticed this too.  With a resolution of 1024&#215;768 (which is the resolution of choice for 45% of our visitors) the three panel display at the bottom of the home page is completely cut off.  Maybe we should at least try to fit the homepage within this resolution.  I&#8217;ll float the idea and see if it generates a <a href="http://wikipedia.org/wiki/user_story">story</a>.</p>


	<h4>I can&#8217;t see the beginning of each link under the <a href="http://www.reevoo.com/categories">browse all categories</a> heading on the homepage.</h4>


	<p>This was identified as problem with Internet Explorer 6 and has since been fixed</p>


	<h4>I always want the number of search results to appear next to the name of the product category on the supercategory page.  If the product category is too long then the number of results drops to the next line (e.g. Audio Home Systems in the <a href="http://www.reevoo.com/browse/group/Phones+%26+Computing">Phones and Computing</a> supercategory)</h4>


	<p>I agree that this doesn&#8217;t look great, although I&#8217;m not sure it impacts the user experience too much.  I&#8217;ll get a <a href="http://wikipedia.org/wiki/user_story">story</a> written up for it.</p>


	<h4>I see the product specification panel appear below all of the reviews on some product pages.</h4>


	<p>This was found to be a problem on pages where the <a href="http://answers.yahoo.com">yahoo answers</a> that we received were too long for their container.  The problem only occurred in Internet Explorer 6 and has now been fixed.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/feedback" rel="tag">feedback</a>, 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/08/14/holiday-in-newqay">Holiday in Newqay</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 14 Aug 2007 06:30:00">
                    Tue, 14 Aug 2007 06:30:00
                  </span>
                </p>

                <p>We&#8217;ve been camping in <a href="http://en.wikipedia.org/wiki/Newquay">Newquay</a> for the past week.  I just thought I&#8217;d post a few unstructured notes about our time there.</p>


	<ul>
	<li>It took about six hours each way in the car.  Much better than last year&#8217;s nine or ten hour journeys each way.</li>
	</ul>


	<ul>
	<li>The weather was amazing.  Given the miserable forecast before we left, it couldn&#8217;t have been any better.</li>
	</ul>


	<ul>
	<li>We stayed at <a href="http://www.trencreekholidaypark.co.uk">Trencreek campsite</a>.  It was a good site about 15-20 minutes walk away from the northern end of town (coming out opposite <a href="http://www.tolcarnebeach.com">Tolcarne Beach</a>).  Along with the no single sex parties or <a href="http://ademweb.co.uk/blog/?p=750">single people</a> rule, they didn&#8217;t have any card facilities and requested that you to park on the right hand side of your tent &#8211; maybe they could modernise just a little&#8230;</li>
	</ul>


	<ul>
	<li>Spent some time at <a href="http://en.wikipedia.org/wiki/Fistral_Beach">Fistral beach</a>, watching the <a href="http://www.ripcurlboardmasters.com">Ripcurl Boardmasters</a> surfing competition, drinking <a href="http://en.wikipedia.org/wiki/Foster%27s_Lager">Fosters</a>, and <a href="http://en.wikipedia.org/wiki/Bodyboarding">body boarding</a>.  The South African commentator suggested that his mate took <a href="http://img.dailymail.co.uk/i/pix/2007/08_01/whiteSWNS00808_468x331.jpg">the picture</a> of the <a href="http://en.wikipedia.org/wiki/Great_white">great white</a> in <a href="http://en.wikipedia.org/wiki/South_africa">South Africa</a> a good few years ago (a story that seems to be confirmed by the <a href="http://www.guardian.co.uk/frontpage/story/0,,2144756,00.html">Guardian</a>).</li>
	</ul>


	<ul>
	<li>Bought a <a href="http://en.wikipedia.org/wiki/Skimboard">skimboard</a> and fell off hard at least twice.</li>
	</ul>


	<ul>
	<li>Bought a bar for my <a href="http://www.peterlynnkites.co.nz">kite</a> from <a href="http://www.airjam.co.uk">Airjam</a>.</li>
	</ul>


	<ul>
	<li>Had a good meal at the <a href="http://www.fistral-blu.co.uk">Fistral Blue</a> restaurant and took some pics of the <a href="http://flickr.com/photos/chrisjroos/1096710292/in/set-72157601392983638">sunset</a>.</li>
	</ul>


	<ul>
	<li>Had a rushed meal at the <a href="http://www.maharajah-restaurant.co.uk">Maharajah</a> restaurant.  Tip to restaurant owners, asking us to finish our drinks in another restaurant across the street (even if it does belong to you) will not make us want to come back.</li>
	</ul>


	<ul>
	<li>Took in the <a href="http://flickr.com/photos/chrisjroos/1096871898/in/set-72157601392983638">amazing views</a> along the coastal path from Newquay, via Porth to Watergate Bay for the Ripcurl unleashed music festival.</li>
	</ul>


	<ul>
	<li>Got to the festival site without any cash only to discover that there were no card facilities anywhere.  Having walked for an hour and ten minutes to get there, we had to pay £10 for a cab to take us back, virtually all the way to the campsite, to withdraw some money.  Ho hum.</li>
	</ul>


	<p>At the festival, we saw:</p>


	<ul>
	<li><a href="http://www.ffaf.co.uk">Funeral for a Friend</a>.  So much harder live than on their albums.</li>
	</ul>


	<ul>
	<li><a href="http://www.ash-official.com">Ash</a>.  I only really know their <a href="http://www.amazon.co.uk/1977-Ash/dp/B0000274GW">old stuff</a> so it was cool that that was what they mainly played.  It makes me wonder if that&#8217;s a sign that their newer stuff isn&#8217;t selling quite so well though&#8230;</li>
	</ul>


	<ul>
	<li><a href="http://www.newtonfaulkner.com">Newton Faulkner</a>.  Only caught the last three songs but was impressed with what I saw.</li>
	</ul>


	<ul>
	<li><a href="http://www.scottmatthewsmusic.co.uk">Scott Matthews</a>.  Boring.</li>
	</ul>


	<ul>
	<li><a href="http://www.guillemots.com">The Guillemots</a>.  Boring.</li>
	</ul>


	<ul>
	<li><a href="http://www.paolonutini.com">Paolo Nutini</a>.  Although the albums are pretty boring, he&#8217;s pretty cool live (having originally seen him at Isle of White festival).  It was a bit of a shame that he was so drunk as his strong accent is hard enough to understand at the best of times.</li>
	</ul>


	<ul>
	<li><a href="http://www.mattandkimmusic.com">Mat and Kim</a>.  An amazingly energetic band from New York that played in front of maybe 100 people in the <a href="http://www.relentlessenergy.com">relentless</a> tent.</li>
	</ul>


	<ul>
	<li><a href="http://en.wikipedia.org/wiki/Wakeboarding">Wakeboarding</a> and <a href="http://en.wikipedia.org/wiki/Wake_skating">Wakeskating</a> at the relentless tour.</li>
	</ul>


	<ul>
	<li><a href="http://en.wikipedia.org/wiki/Freestyle_Motocross">Freestyle motorcross</a> with the <a href="http://www.myspace.com/ukfmx"><span class="caps">UK FMX</span></a> team.</li>
	</ul>


	<p>All in all, a good week.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/camping" rel="tag">camping</a>, 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/holiday" rel="tag">holiday</a>, 
                    
                      <a href="/articles/tag/newquay" rel="tag">newquay</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/08/01/a-new-reevoo-com">A new reevoo.com</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 01 Aug 2007 08:32:00">
                    Wed, 01 Aug 2007 08:32:00
                  </span>
                </p>

                <p>This is obviously completely optional but if anyone stumbles across this post, I&#8217;d really appreciate it if you&#8217;d spend a few minutes checking out the revised <a href="http://www.reevoo.com">reevoo.com</a>.</p>


	<p>I don&#8217;t want to say too much as I want to influence any judgement.  Just check it out and let me know what you think, either in the comments here or by <a href="mailto:chrisroos@reevoo.com">email</a>.  Oh, and really don&#8217;t be scared to slag it off, praise it up or just sit on the fence &#8211; any opinion is welcome.</p>


	<p>Oh, and in case it&#8217;s not obvious, I work at Reevoo.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/comments" rel="tag">comments</a>, 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/request" rel="tag">request</a>, 
                    
                      <a href="/articles/tag/reviews" rel="tag">reviews</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/07/24/train-times-by-sms-or-improving-national-rail-enquiries">Train times by SMS (or, improving national rail enquiries)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 24 Jul 2007 14:40:00">
                    Tue, 24 Jul 2007 14:40:00
                  </span>
                </p>

                <p>I was in need of finding some train times at the weekend.  I usually use the <a href="http://www.nationalrail.co.uk">national rail enquiries</a> website but was without Internet access at the time.  Instead, I found myself waiting for about 10 minutes in a telephone queue just to spend about 30 seconds getting the information I was after.  This played on my mind a bit so last night I started <a href="http://twitter.com/chrisroos/statuses/164273922">playing around</a> with automating the national rail timetable search.  That was relatively painless so I moved on to integrating with <a href="http://www.twitter.com">twitter</a> in order to provide an <span class="caps">SMS</span> interface to the service.  Within a couple of hours I had a twitterbot that receives timetable requests, looks up the times and sends them back to you.</p>


	<p>It&#8217;s actually currently all up and running.  Just follow <a href="http://twitter.com/natrailenq">natrailenq</a> on twitter and I&#8217;ll follow you right back<sup><a href="#fn1">1</a></sup> (this seems to be necessary in order to send direct messages between each other).  A timetable request must be of the format &#8216;origin_station (3 letter short code) destination_station (3 letter short code) depart_date (dd-mmmm) depart_time (hh:mm)&#8217;.  So, if we wanted to get times of trains from London Victoria (VIC) to Clapham Junction (CLJ) tomorrow midday, we&#8217;d send a message like so:</p>


<code>d natrailenq vic clj 25-july 12:00</code>

	<p>In this instance, we get the following response back.</p>


<code>natrailenq  11:55-&gt;12:02, 12:02-&gt;12:07, 12:03-&gt;12:09, 12:05-&gt;12:11, 12:06-&gt;12:11</code>

	<p>Cool huh.</p>


	<p>The code is <strong>nasty</strong>.  You can see just how nasty it in the <a href="http://chrisroos.googlecode.com/svn/trunk/nat-rail-enq/">repository</a>.  It feels as though this could go somewhere &#8211; unless I&#8217;m violating some terms and conditions that I haven&#8217;t read&#8230;  I make no guarantees as to how long the service will stay live, and I will certainly (probably) remove it if asked to.</p>


	<p id="fn1"><sup>1</sup> Well, just as soon as I can at least &#8211; it&#8217;s not automated at the moment.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/nationalrail" rel="tag">nationalrail</a>, 
                    
                      <a href="/articles/tag/sms" rel="tag">sms</a>, 
                    
                      <a href="/articles/tag/timetable" rel="tag">timetable</a>, 
                    
                      <a href="/articles/tag/twitter" rel="tag">twitter</a>, 
                    
                      <a href="/articles/tag/twitterbot" rel="tag">twitterbot</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/07/17/free-google-website-optimizer-isnt-actually-free">Free google website optimizer isn't actually free</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 17 Jul 2007 22:36:00">
                    Tue, 17 Jul 2007 22:36:00
                  </span>
                </p>

                <p>Nup, it cost me £5.00.  That&#8217;s not free is it.</p>


	<p>OK, so I&#8217;m being intentionally blunt, but that&#8217;s because <a href="http://www.google.com">google</a> annoyed me by being misleading and incompetent.  Although I have no intention of using <a href="http://adwords.google.com">adwords</a>, I had to sign-up in order to use their <a href="http://services.google.com/websiteoptimizer">website optimizer</a> service.  I signed up but chose not to enter any billing information; I wasn&#8217;t going to buy any ads, and website optimizer is free (hmmm), so I didn&#8217;t see the point.  I went on to set-up my optimizer experiments and waited.  The docs suggest that you may have to wait up to an hour before seeing impressions, but 24 hours without impressions, that I knew should be there, seemed a little excessive.  I guessed it may have had something to do with not entering my billing information but in order to be sure I sent the folks at google an email.</p>


	<blockquote>
		<p><strong>Chris</strong> I&#8217;ve set-up my website optimizer campaigns and all seems correct.  Unfortunately, they are not showing any impressions or clickthrus.  I wonder if this is because I haven&#8217;t activated (i.e. set-up my payment information) in my adwords account.  As I don&#8217;t intend to use adwords, I didn&#8217;t really want to have to do it.  Could this be the reason?</p>
	</blockquote>


	<p>I thought I was being fairly clear in my questioning, but apparently not.</p>


	<blockquote>
		<p><strong>Adwords</strong> Thank you for your email regarding why you are not accruing any clicks or impression for your ad. I noticed that you have not entered your billing information. Below, I address this in detail.
I have reviewed your AdWords account and found that your ad is not appearing on Google because you have not yet entered your billing information. Entering valid billing information is required to activate your Google AdWords account and begin running your ads.</p>
	</blockquote>


	<p>Surely it should be common practice to read the email before replying.  Obviously not.  Oh well, I&#8217;ll get back to them (in an admittedly sarcastic tone).</p>


	<blockquote>
		<p><strong>Chris</strong> Any chance you can re-read my original query and answer that, rather than essentially ignoring it?</p>
	</blockquote>


	<p>Surely they&#8217;ll read it this time&#8230;</p>


	<blockquote>
		<p><strong>Adwords</strong> Thank you for your email. I understand you would like to know why your ads are not receiving any clicks and impressions. Upon reviewing your account, I found that this is because your account has not been activated. To activate your account and to receive clicks and impressions you will have to enter your billing details</p>
	</blockquote>


	<p>Nope.  Let&#8217;s try one more time.</p>


	<blockquote>
		<p><strong>Chris</strong> I haven&#8217;t mentioned anything about adwords ads.  My problem is, in fact with Website Optimizer.  Do I need to enter billing information just to use website optimizer, or is there another reason that I&#8217;m not recording any hits?</p>
	</blockquote>


	<p>Woot, we get an answer.</p>


	<blockquote>
		<p><strong>Adwords</strong> The Website Optimizer is integrated into your AdWords account, you will need to enter your billing information to use it. In order to use Website Optimizer, you&#8217;ll need a Standard AdWords account.</p>
	</blockquote>


	<p>Right, so we finally have a sensible answer.  In fact, I think this is probably covered in <a href="https://adwords.google.com/support/bin/index.py?fulldump=1#55902">this</a> answer, assuming that &#8220;active&#8221; means &#8220;with correct billing information&#8221;.  What about the £5.00 I had to pay to get set-up, of which there is no mention until the very last stage of sign-up?  Well, it actually seems that this is covered too, in <a href="http://adwords.google.com/support/bin/answer.py?hl=en&#38;answer=31756">this</a> answer, mentioning a &#8220;nominal setup fee&#8221; to create an adwords account.</p>


	<p>In all fairness, the big G (not His Dad, the other one) has probably not done anything wrong, but it&#8217;s certainly not very transparent.  You have to pay to activate an adwords account and you need an adwords account in order to use website optimizer.  Or, website optimizer costs a fiver.  There, much easier to understand.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/adwords" rel="tag">adwords</a>, 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                      <a href="/articles/tag/naughty" rel="tag">naughty</a>, 
                    
                      <a href="/articles/tag/optimizer" rel="tag">optimizer</a>, 
                    
                      <a href="/articles/tag/website" rel="tag">website</a>, 
                    
                      <a href="/articles/tag/website-optimizer" rel="tag">website-optimizer</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/07/13/web-service-to-convert-uk-postcodes-outcode-to-latitude-and-longitude">Web service to convert UK Postcodes (outcode) to Latitude and Longitude</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 13 Jul 2007 14:41:00">
                    Fri, 13 Jul 2007 14:41:00
                  </span>
                </p>

                <p>Using the data supplied in this <a href="http://postcodes.easypeasy.com">article</a>, by <a href="http://www.niksargent.com">Nik Sargent</a>, I&#8217;ve created a simple web service that returns <a href="http://www.json.org"><span class="caps">JSON</span></a> formatted data about UK Outcodes (the first bit of the postcode).</p>


	<p>The idea is that you can request, for example, /postcodes/se1 and get some json in return.  For se1, we receive the following data.</p>


<div class="typocode"><pre><code class="typocode_default">{&quot;latitude&quot;:&quot;51.498&quot;,&quot;x&quot;:&quot;532600&quot;,&quot;postcode&quot;:&quot;SE1&quot;,&quot;y&quot;:&quot;179500&quot;,&quot;longitude&quot;:&quot;51.498&quot;}</code></pre></div>

	<p>The service is currently running at <a href="http://seagul.co.uk/postcodes">http://seagul.co.uk/postcodes</a> (<a href="http://seagul.co.uk/postcodes/se1">se1</a>) but I make no guarantees as to its reliability.  I&#8217;d suggest that if anyone actually finds this useful that they go host it somewhere for themselves in order to control the availability.</p>


	<p>The code is, as always, on <a href="http://chrisroos.googlecode.com/svn/trunk/uk-postcodes/">google code</a> and pasted below.</p>


	<p>I&#8217;ve created it as a proof of concept but I figure that, given a little love, it may prove useful to some folks.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">mongrel</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">json</span><span class="punct">'</span>

<span class="ident">postcodes_file</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/uk-postcodes.json</span><span class="punct">'</span>
<span class="constant">Postcodes</span> <span class="punct">=</span> <span class="constant">JSON</span><span class="punct">.</span><span class="ident">parse</span><span class="punct">(</span><span class="constant">File</span><span class="punct">.</span><span class="ident">open</span><span class="punct">(</span><span class="ident">postcodes_file</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">f</span><span class="punct">|</span> <span class="ident">f</span><span class="punct">.</span><span class="ident">read</span> <span class="punct">})</span>
<span class="constant">Index</span> <span class="punct">=</span> <span class="constant">Postcodes</span><span class="punct">.</span><span class="ident">inject</span><span class="punct">([])</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">index</span><span class="punct">,</span> <span class="ident">postcode</span><span class="punct">|</span> <span class="ident">index</span> <span class="punct">&lt;&lt;</span> <span class="ident">postcode</span><span class="punct">['</span><span class="string">postcode</span><span class="punct">'].</span><span class="ident">downcase</span> <span class="punct">}</span>

<span class="keyword">class </span><span class="class">PostcodeHandler</span> <span class="punct">&lt;</span> <span class="constant">Mongrel</span><span class="punct">::</span><span class="constant">HttpHandler</span>
  <span class="keyword">def </span><span class="method">process</span><span class="punct">(</span><span class="ident">request</span><span class="punct">,</span> <span class="ident">response</span><span class="punct">)</span>
    <span class="ident">outcode</span> <span class="punct">=</span> <span class="ident">request</span><span class="punct">.</span><span class="ident">params</span><span class="punct">['</span><span class="string">PATH_INFO</span><span class="punct">'].</span><span class="ident">sub</span><span class="punct">(/</span><span class="regex">^<span class="escape">\/</span></span><span class="punct">/,</span> <span class="punct">'</span><span class="string"></span><span class="punct">').</span><span class="ident">downcase</span>
    <span class="ident">postcode_index</span> <span class="punct">=</span> <span class="constant">Index</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span><span class="ident">outcode</span><span class="punct">)</span>
    <span class="keyword">if</span> <span class="ident">postcode_index</span>
      <span class="ident">response</span><span class="punct">.</span><span class="ident">start</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">head</span><span class="punct">,</span> <span class="ident">out</span><span class="punct">|</span>
        <span class="ident">head</span><span class="punct">[&quot;</span><span class="string">Content-Type</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">text/plain</span><span class="punct">&quot;</span>
        <span class="ident">out</span> <span class="punct">&lt;&lt;</span> <span class="constant">Postcodes</span><span class="punct">[</span><span class="ident">postcode_index</span><span class="punct">].</span><span class="ident">to_json</span>
      <span class="keyword">end</span>
    <span class="keyword">else</span>
      <span class="ident">response</span><span class="punct">.</span><span class="ident">start</span><span class="punct">(</span><span class="number">404</span><span class="punct">)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">head</span><span class="punct">,</span><span class="ident">out</span><span class="punct">|</span>
        <span class="ident">out</span> <span class="punct">&lt;&lt;</span> <span class="punct">&quot;</span><span class="string">Postcode not found<span class="escape">\n</span></span><span class="punct">&quot;</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">config</span> <span class="punct">=</span> <span class="constant">Mongrel</span><span class="punct">::</span><span class="constant">Configurator</span><span class="punct">.</span><span class="ident">new</span> <span class="symbol">:host</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">localhost</span><span class="punct">',</span> <span class="symbol">:port</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">4000</span><span class="punct">'</span> <span class="keyword">do</span>
  <span class="ident">listener</span> <span class="keyword">do</span>
    <span class="ident">uri</span> <span class="punct">&quot;</span><span class="string">/postcodes</span><span class="punct">&quot;,</span> <span class="symbol">:handler</span> <span class="punct">=&gt;</span> <span class="constant">PostcodeHandler</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>
  <span class="ident">trap</span><span class="punct">(&quot;</span><span class="string">INT</span><span class="punct">&quot;)</span> <span class="punct">{</span> <span class="ident">stop</span> <span class="punct">}</span>
  <span class="ident">run</span>
<span class="keyword">end</span>

<span class="ident">config</span><span class="punct">.</span><span class="ident">join</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/mongrel" rel="tag">mongrel</a>, 
                    
                      <a href="/articles/tag/outcodes" rel="tag">outcodes</a>, 
                    
                      <a href="/articles/tag/postcodes" rel="tag">postcodes</a>, 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/service" rel="tag">service</a>, 
                    
                      <a href="/articles/tag/web" rel="tag">web</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/07/12/wesabe-open-up-their-api-and-ask-me-to-help-write-their-press-release">Wesabe open up their API and ask me to help write their press release...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 12 Jul 2007 23:49:00">
                    Thu, 12 Jul 2007 23:49:00
                  </span>
                </p>

                <p>Ok, so that second bit isn&#8217;t strictly true ;-)  I was, however, flattered to be contacted by Debbie from <a href="http://www.wesabe.com">Wesabe</a> to answer a few questions and maybe provide a quote for their press release.  They have just improved their service by <a href="http://blog.wesabe.com/index.php/2007/07/12/your-bank-has-a-rest-api-now-shhh-dont-tell-them/">offering</a> an <a href="http://www.wikipedia.org/wiki/API"><span class="caps">API</span></a> after all.</p>


	<p>They asked, and I answered by rambling quite a bit.  In the preview of the press release I&#8217;ve seen, my ramblings have been summarized in three words :-)  Hey, I&#8217;m just honoured they asked.  I also asked if I could post their questions and my reply here, so, in all its glory, here it be.</p>


	<p><strong>Debbie Pfeifer</strong></p>


	<p>Hey, Chris.</p>


	<p>I work with Marc Hedlund at Wesabe.  I know he gave you a heads up that we&#8217;re working on releasing an <span class="caps">API</span>.  We&#8217;re getting close &#8211; we plan to get it out either late this week or early next week &#8211; and I was writing to ask for a favor.</p>


	<p>I&#8217;m putting together a press release announcing the <span class="caps">API</span> and we thought it would be cool to get a quote from a developer who has done some hacks.  If you&#8217;d rather not participate, no worries whatsoever.  If you&#8217;d be willing, following is a quick list of questions:</p>


	<p><strong>Chris Roos</strong></p>


	<p>Cool, I appreciate being considered.</p>


	<p><strong>Debbie Pfeifer</strong></p>


	<p>Why do you use Wesabe?</p>


	<p><strong>Chris Roos</strong></p>


	<p>Because it&#8217;s a great application :-)   No, seriously it&#8217;s because tagging makes sense to me.  It makes sense that, if I buy an apple, I should be able to categorise it as an apple, fruit, lunch, food, groceries and others that I can&#8217;t think of right now.  It&#8217;s a bit looser than traditional finance applications which I find perfect.  I must admit that I don&#8217;t currently use the social side of wesabe, helping others out with tips and advice, but that in no way detracts from the usefulness of the service to me.  I also love the fact that I&#8217;m able to interact with you guys, it means a lot to know that you&#8217;re listening.</p>


	<p><strong>Debbie Pfeifer</strong></p>


	<p>From your blog, I saw the projects you&#8217;ve already done (automating downloads).  Are there other things you&#8217;d like to do with Wesabe once you have the <span class="caps">API</span>?</p>


	<p><strong>Chris Roos</strong></p>


	<p>Hmm, let&#8217;s see.  I&#8217;m a big fan of the command line.  I&#8217;ve already been thinking about tidying up some of the previous work I&#8217;ve done so that it effectively provides a command line interface to my banking websites.  I can see that a command line interface to Wesabe might be quite appealing to me too.  I&#8217;m just wondering about some potential mapping mashups too.  I try to tag my transactions with the place they were purchased. Assuming I tagged every purchase with at least a town or city it&#8217;d be cool to see the distribution geographically.  Actually, I have a feeling I could do this with what&#8217;s available right now so maybe scrap that thought.</p>


	<p><strong>Debbie Pfeifer</strong></p>


	<p>Anything else you&#8217;d like to add?</p>


	<p><strong>Chris Roos</strong></p>


	<p>I originally had this bit under the question of why I like Wesabe, but felt it best here.  To be fair, it probably doesn&#8217;t matter too much. Anyway, I like the fact that Wesabe is developing the software that my greedy, super-rich banks should be developing ;-)   I love the fact that you are, in a small way, changing the world.  Sticking two fingers up at traditional finance applications and banking web apps themselves, because, I assume, you know that you&#8217;re doing it right.</p>


	<p>One other idea I&#8217;ve been thinking about is uploading my mobile phone statements to Wesabe.  I currently have access to a pdf representation of my itemised bill.  I&#8217;m thinking that if I can parse the pdf, or even just copy the content into a text file that I can parse, I could upload and use all the features of Wesabe to analyse my bills.  I think this&#8217;d be great as I&#8217;ve personally never come across a phone company that allows ready, easy access to itemised call data in a useful format.  I guess this is because they don&#8217;t want to make it to easy for us to work out that they&#8217;re screwing us over in some way (cynical huh?).  Anyway, just a thought and I&#8217;m obviously not sure how that&#8217;d sit with you guys&#8230;?</p>


	<p><strong>Debbie Pfeifer</strong></p>


	<p>Again, if you&#8217;d rather not do this, I totally understand.  If you&#8217;re game, could we use your name?  Also, how would you describe yourself&#8230; a (your job) from (city)?</p>


	<p><strong>Chris Roos</strong></p>


	<p>Feel free to use my name.  Although not really one for titles, I guess I&#8217;d be classed as a software developer working in London, but from Ramsgate.</p>


	<p><strong>Debbie Pfeifer</strong></p>


	<p>Thanks, Chris.  Please let me know if you have any questions.</p>


	<p><strong>Chris Roos</strong></p>


	<p>One quick question.  Am I able to publish this email to my blog?  If not, I&#8217;ll probably just published my answers to your questions, which I could paraphrase to offer context.</p>


	<p>Cheers, and hope there&#8217;s at least something useful in these ramblings.</p>


	<p>Chris</p>


	<p><strong>Debbie Pfeifer</strong></p>


	<p>Best,
Debbie Pfeifer
Wesabe</p>


	<p><strong>Update 17:10 &#8211; made the email legible. Thanks Paul.</strong></p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/api" rel="tag">api</a>, 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/pr" rel="tag">pr</a>, 
                    
                      <a href="/articles/tag/praise" rel="tag">praise</a>, 
                    
                      <a href="/articles/tag/ramble" rel="tag">ramble</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/26/a-great-day-at-work-and-reevoovision-twittervision-for-reviews">A great day at work and reevoovision (twittervision for reviews)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 26 Jun 2007 09:20:00">
                    Tue, 26 Jun 2007 09:20:00
                  </span>
                </p>

                <p>A few of days ago I <a href="http://twitter.com/chrisroos/statuses/114202552">came across</a> <a href="http://twittervision.com/">twittervision</a>.  Just ten hours later I had checked some code into <a href="http://www.reevoo.com">our</a> repository that allows us to do the same thing (as twittervision) but for our reviews.  Yup, it was a very good day indeed.  Although the initial code was complete within a few hours, it needed a bit of polishing (kudos to <a href="http://po-ru.com">Paul</a>) which meant that we only got it deployed yesterday.  I guess one working day between proof of concept and deployment isn&#8217;t that bad&#8230;  Anyway, go check it out &#8211; <a href="http://www.reevoo.com/vision.html">reevoovision</a>.</p>


	<h3>The days events</h3>


	<p>I started the morning by creating an <a href="http://en.wikipedia.org/wiki/Xml">xml</a> feed of the ten most recently published reviews.  On filling a review, the reviewer is asked to enter their town, which needed to be converted to latitude/longitude to allow us to plot a point on the map.  Luckily, a little googling revealed the <a href="http://www.geonames.org/">geonames</a> web service that did exactly what I wanted.  So, using a combination of <a href="http://www.ruby-lang.org/en/">ruby</a>, <a href="http://rubyonrails.com/">rails</a>, <a href="http://curl.haxx.se/">curl</a>, <a href="http://code.whytheluckystiff.net/hpricot/">hpricot</a> and <a href="http://mongrel.rubyforge.org/">mongrel</a> I had a simple web server that downloaded and parsed the reviews, converted place name to lat/long, and plotted the results on a google map (with help from the <a href="http://pragmaticprogrammer.com/fridays.html">fridays</a> <a href="http://pragmaticprogrammer.com/titles/sdgmapi2/index.html">google map book</a>).  A good proof of concept but not quite right.</p>


	<p>I was reminded that we collect the purchaser&#8217;s postcode from our retailers.  This, in combination with a <a href="http://www.easypeasy.com/guides/article.php?article=64">free list</a> of UK <a href="http://en.wikipedia.org/wiki/UK_postcodes">outcodes</a> (the first bit of the postcode) against latitude/longitude, allowed for much greater accuracy (well, to within about 2km) in plotting the location of the reviewer.</p>


	<p>The next step was to polish up the rough demo.  Instead of the previous server side hackery, I used the excellent <a href="http://jquery.com">jquery</a> javascript library to perform an &#8220;Ajax&#8221; request of the reviews and parse the xml to build a simple hash of the required data.  Using the twittervision source as reference, I got a &#8216;proper&#8217; (i.e. reviews popping up in sequence) demo running.</p>


	<p>From here, it was a basic case of tidying up some rough edges.  Instead of returning the reviews data as xml, I converted it to <a href="http://json.org/">json</a> to make for trivial parsing in javascript.  I also added the jquery <a href="http://jquery.com/plugins/project/dimensions">dimensions</a> plugin to resize the containing div, and in turn the map, to the size of the page.  The final touch was attempting to keep the UK centered in the window.</p>


	<p>Reevoovision currently selects and displays published reviews at random to provide a constantly updating map, although maybe it&#8217;d be cool to get it to display submitted/published reviews in real-time.</p>


	<p>I can&#8217;t get over how addictive it is to watch the reviews pop-up all over the country, it really emphasises the fact that these are actually real people writing about their experiences.  Hmm, that sounds a bit sales &#38; marketing.  I do mean it though, honest.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/reevoovision" rel="tag">reevoovision</a>, 
                    
                      <a href="/articles/tag/reviews" rel="tag">reviews</a>, 
                    
                      <a href="/articles/tag/twitter" rel="tag">twitter</a>, 
                    
                      <a href="/articles/tag/twittervision" rel="tag">twittervision</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/23/automatically-downloading-my-ing-direct-transactions">Automatically downloading my Ing Direct transactions</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 23 Jun 2007 18:00:00">
                    Sat, 23 Jun 2007 18:00:00
                  </span>
                </p>

                <p>I wanted to <a href="http://blog.seagul.co.uk/articles/2007/06/23/automatically-download-egg-credit-card-transactions">automate</a> the <a href="http://blog.seagul.co.uk/articles/2007/05/14/automatically-downloading-my-recent-transactions-from-lloyds-tsb">download</a> of <a href="http://blog.seagul.co.uk/articles/2007/05/04/automatically-downloading-my-most-recent-hsbc-transactions">transaction</a> data for my <a href="http://www.ingdirect.co.uk">ing direct</a> account.  Instead of just pasting up the finished result, I&#8217;ve tried to capture the process I went through, on the off chance it&#8217;s of interest to anyone&#8230;</p>


	<h3>Earlier</h3>


	<p>Open the <a href="http://www.ingdirect.co.uk">homepage</a></p>


	<p>Click the login link. (goes to https://secure.ingdirect.co.uk/InitialINGDirect.html?command=displayLogin&#38;device=web&#38;locale=en_GB)</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/601727552/"><img src="http://farm2.static.flickr.com/1358/601727552_238151d7e8_m.jpg" alt="" /></a></p>


	<p>Type our Customer Number and Last Name into the login form.</p>


	<p>Before submitting the form, we open the <a href="http://livehttpheaders.mozdev.org/">Live Http headers</a> <a href="http://www.mozilla.com/en-US/firefox/">firefox</a> extension.</p>


	<p>We see that the following information gets POSTed to InitialINGDirect.html</p>


<div class="typocode"><pre><code class="typocode_default">command=enterCustomerNumber&amp;locale=en_GB&amp;device=web&amp;ACN=&lt;YOUR_CUSTOMER_NUMBER&gt;&amp;LNAME=&lt;YOUR_LAST_NAME&gt;&amp;GO.x=23&amp;GO.y=12</code></pre></div>

	<p>We are redirected to a second security page.</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/601727868/"><img src="http://farm2.static.flickr.com/1344/601727868_4569c11af6_m.jpg" alt="" /></a></p>


	<p>The first use of <a href="http://curl.haxx.se/">curl</a> is to see whether we can get this far from the command line.</p>


<div class="typocode"><pre><code class="typocode_default">curl -X&quot;POST&quot; -d&quot;command=enterCustomerNumber&quot; -d&quot;locale=en_GB&quot; -d&quot;device=web&quot; -d&quot;ACN=YOUR_CUSTOMER_NUMBER&quot; -d&quot;LNAME=YOUR_LAST_NAME&quot; -d&quot;GO.x=23&quot; -d&quot;GO.y=12&quot; &quot;https://secure.ingdirect.co.uk/InitialINGDirect.html&quot; -o&quot;&lt;FILENAME_FOR_OUTPUT&gt;&quot;</code></pre></div>

	<p>The actual output in this instance is</p>


<div class="typocode"><pre><code class="typocode_default">&lt;SCRIPT&gt;
location.replace(&quot;/INGDirect.html?command=displayValidateCustomer&amp;fill=1&quot;);
&lt;/SCRIPT&gt;</code></pre></div>

	<p>So we amend the curl command to see exactly what&#8217;s going on (the removal of -o and the addition of -v)</p>


	<p>Right, so this is interesting &#8211; I was expecting to see an <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.30"><span class="caps">HTTP</span> Location</a> header directing us to the second security page.  Instead the body of the response is the javascript seen above.  I guess they want to ensure that we have javascript enabled eh.</p>


	<p>Let&#8217;s just see what happens if we request the page returned in the javascript (https://secure.ingdirect.co.uk/INGDirect.html?command=displayValidateCustomer&#38;fill=1)</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/601442615/"><img src="http://farm2.static.flickr.com/1130/601442615_2ce8dafc21_m.jpg" alt="" /></a></p>


	<p>Ok, so that&#8217;s not unexpected.  How about, if we store the cookies sent to us in the original response, and then request the page returned in the javascript.</p>


<div class="typocode"><pre><code class="typocode_default">curl -X&quot;POST&quot; -c&quot;/Users/chrisroos/Desktop/ing-cookie&quot; -d&quot;command=enterCustomerNumber&quot; -d&quot;locale=en_GB&quot; -d&quot;device=web&quot; -d&quot;ACN=YOUR_CUSTOMER_NUMBER&quot; -d&quot;LNAME=YOUR_LAST_NAME&quot; -d&quot;GO.x=23&quot; -d&quot;GO.y=12&quot; &quot;https://secure.ingdirect.co.uk/InitialINGDirect.html&quot;

curl -b&quot;/Users/chrisroos/Desktop/ing-cookie&quot; &quot;https://secure.ingdirect.co.uk/INGDirect.html?command=displayValidateCustomer&amp;fill=1&quot; -o&quot;/Users/chrisroos/Desktop/ing.html&quot;</code></pre></div>

	<p>Ok, this looks promising.  We can now proceed to the second security page.</p>


	<p>Let&#8217;s use firefox to log in and get to the second security page again.  Fill in the details as requested, open live http headers and get hold of the data we are sending.  Right, so we <span class="caps">POST</span> the following details to InitialINGDirect.html</p>


<div class="typocode"><pre><code class="typocode_default">command=validateCustomer&amp;locale=en_GB&amp;device=web&amp;PIN_A=5&amp;PIN_B=1&amp;PIN_C=4&amp;DAYS=65&amp;MONTHS=65&amp;YEARS=66&amp;GO.x=41&amp;GO.y=9</code></pre></div>

	<p>Ah, so this looks interesting.  It seems that each key on the keypad is assigned a number (potentially different to the number displayed on the key).  It is that number that gets sent.  The numbers on the keypad appear in a random order, so I wonder if the same number is always assigned to the same key, or whether something else is required to tell the server the order of the keys.  Let&#8217;s log in one more time and see if the results differ.  The assumption being that if they do then the server must know what order the keys have been displayed in.</p>


	<p>Bugger &#8211; now it won&#8217;t let me log in anymore (too many failed attempts) and I have to call the call centre.  Ooops.</p>


	<h3>Later</h3>


	<p>Right, so it&#8217;s now about 5 weeks after starting this investigation.  I&#8217;m going to attempt to pick up where I left off and see if we can&#8217;t get it finished.  Previously, before I got locked out of my account, I was going to test whether each digit on the keypad got assigned a different number each time.  In order to test, I logged into my account twice.  Each time, I saved the content of the page containing the keypad, and the output from Live Http Headers.  A quick examination of the differences between the output seems to suggest that we only ever send the position of a number on the keypad.  A made-up example might help to make this clear, starting with a keypad in no particular order.</p>


<pre>
5 1 2
4 7 3
0 8 9
  6
</pre>

	<p>If our pin number is 1234 and we are asked for the first digit then, although we would push the button labeled 1 on the keypad, we would actually send the value 2 to the server.  The buttons (but not the values they represent) all have a constant position, where the top-left button is position 1, the bottom-right is position 9 and the bottom button is position 0 (same layout as phone keypads).  For the above example, the button labeled 1 is in position 2, hence us sending a 2 to the server.</p>


	<p>Right, so unless I&#8217;m missing something, the server must &#8216;know&#8217; which three digits we&#8217;re being asked for, along with the order of the keypad.  If we&#8217;re to log in automatically then we&#8217;re going to need to parse the text that asks us for certain digits and determine the order of the keypad.  A little experimentation with <a href="http://code.whytheluckystiff.net/hpricot/">hpricot</a> yielded the following code.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">hpricot</span><span class="punct">'</span>

<span class="ident">html</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">open</span><span class="punct">('</span><span class="string">/Users/chrisroos/Desktop/ingdirect-b1.html</span><span class="punct">')</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">f</span><span class="punct">|</span> <span class="ident">f</span><span class="punct">.</span><span class="ident">read</span> <span class="punct">}</span>

<span class="comment"># The request for our PIN digits appears within the following text</span>
<span class="comment"># &lt;b&gt;Using the Key Pad, please enter the 3rd, 5th and 2nd digits from your PIN&lt;/b&gt;</span>
<span class="ident">pin_a</span><span class="punct">,</span> <span class="ident">pin_b</span><span class="punct">,</span> <span class="ident">pin_c</span> <span class="punct">=</span> <span class="ident">html</span><span class="punct">.</span><span class="ident">scan</span><span class="punct">(/</span><span class="regex">Using the Key Pad, please enter the (<span class="escape">\d</span>).+?(<span class="escape">\d</span>).+?(<span class="escape">\d</span>).*?&lt;<span class="escape">\/</span>b&gt;</span><span class="punct">/).</span><span class="ident">flatten</span>

<span class="comment"># Ok, now let's find the order of the keypad (hey, it's in a div with id pin-pad - cool)</span>
<span class="comment"># This has turned out quite trivial.  The keypad is rendered within an html table, where each cell contains a button (input)</span>
<span class="comment"># that has a value of the number displayed on the button.  Hpricot makes it very easy to say 'get me all buttons (input)</span>
<span class="comment"># that appear in cells within the table that is in the div with an id of pin-pad'.  As hpricot will parse the html table</span>
<span class="comment"># 'in order', i.e. from top-left to bottom right, we just have to append each button value into an array, preserving the</span>
<span class="comment"># order of the keypad.</span>
<span class="ident">doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">html</span><span class="punct">)</span>
<span class="ident">keypad</span> <span class="punct">=</span> <span class="punct">(</span><span class="ident">doc</span><span class="punct">/'</span><span class="string">div#pin-pad/table/tr/td/input</span><span class="punct">').</span><span class="ident">inject</span><span class="punct">([])</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">array</span><span class="punct">,</span> <span class="ident">btn</span><span class="punct">|</span> <span class="ident">array</span> <span class="punct">&lt;&lt;</span> <span class="ident">btn</span><span class="punct">.</span><span class="ident">attributes</span><span class="punct">['</span><span class="string">value</span><span class="punct">'].</span><span class="ident">to_i</span><span class="punct">;</span> <span class="ident">array</span> <span class="punct">}</span>
<span class="comment"># The last value read from the html keypad table will appear at index 9 (our array is 0 based), where we actually want it to </span>
<span class="comment"># appear at index 0 (keypad is in phone keypad order, i.e. 0 at bottom).  Luckily, we can just pop it off the end and</span>
<span class="comment"># prepend it to the array</span>
<span class="ident">keypad</span><span class="punct">.</span><span class="ident">unshift</span><span class="punct">(</span><span class="ident">keypad</span><span class="punct">.</span><span class="ident">pop</span><span class="punct">)</span>
<span class="comment"># So, we can now convert a keypad like this</span>
<span class="comment"># 5 1 2</span>
<span class="comment"># 4 7 3</span>
<span class="comment"># 0 8 9</span>
<span class="comment">#   6</span>
<span class="comment"># into the equivalent ruby array [6, 5, 1, 2, 4, 7, 3, 0, 8, 9]</span>
<span class="comment"># We can then use Array#index to dive in grab the keypad position of a number</span>
<span class="comment"># keypad.index(5) #=&gt; 1</span>
<span class="comment"># keypad.index(7) #=&gt; 5</span></code></pre></div>

	<p>Cool, so we should be able to string together what we have and automatically login to our account, we need to dip into ruby so that we might parse the keypad page using our code above.</p>


	<p>Right, I&#8217;ve cobbled the code together but instead of seeing an account overview page, I&#8217;m actually receiving a page with more javascript relocation magic.</p>


<div class="typocode"><pre><code class="typocode_default">&lt;SCRIPT&gt;
location.replace(&quot;/InitialINGDirect.html?command=displayLoggedOutError&amp;locale=en_GB&amp;device=web&quot;);
&lt;/SCRIPT&gt;</code></pre></div>

	<p>I&#8217;m wondering if I&#8217;m missing some cookies &#8211; maybe some more cookies get added to the jar on the keypad page.  Using the <a href="https://addons.mozilla.org/en-US/firefox/addon/60">web developer extension</a> this is trivial to check.  Two cookies are set when we first visit the login page&#8230;  Hmm, and there are still two when we get to the keypad page.  So something else is different.  Ok, so I found it.  Somehow, I&#8217;d managed to miss out some data that was required for the login to work correctly.  I was not sending the command=validateCustomer key/pair even though I&#8217;d already pasted it once above.  Oh well.  With this &#8216;command&#8217; added, we still get a page with some javascript relocation but this time we get relocated to the account summary..</p>


<div class="typocode"><pre><code class="typocode_default">&lt;SCRIPT&gt;
location.replace(&quot;/INGDirect.html?command=accountSummary&amp;locale=en_GB&amp;device=web&amp;method=fetchClientAccountSummary&quot;);
&lt;/SCRIPT&gt;</code></pre></div>

	<p>If we finally <span class="caps">GET</span> this page then we should be able to &#8216;see&#8217; our account overview on the command line.  Of course it wasn&#8217;t that simple.  This just yields another javascript redirect.</p>


<div class="typocode"><pre><code class="typocode_default">&lt;SCRIPT&gt;
location.replace(&quot;/INGDirect.html?command=displayClientAccountSummary&amp;fill=1&quot;);
&lt;/SCRIPT&gt;</code></pre></div>

	<p>Let&#8217;s try to <span class="caps">GET</span> this page then.  Woohoo, we&#8217;re finally at the account overview page.  Wow that was hard work, so, so much harder than it should be for a web application.</p>


	<p>The final step is to <span class="caps">GET</span> and save the transaction page.  The url to the account page in the browser is:</p>


	<p>https://secure.ingdirect.co.uk/INGDirect.html?command=accountSummary&#38;method=fetchClientAccountSummary&#38;account=0&#38;stepName=saving</p>


	<p>GETting that url on the command line yields yet another javascript redirect (really, you do surprise me).</p>


<div class="typocode"><pre><code class="typocode_default">&lt;SCRIPT&gt;
location.replace(&quot;/INGDirect.html?command=displayAccountDetails&quot;);
&lt;/SCRIPT&gt;</code></pre></div>

	<p>Fine, let&#8217;s <span class="caps">GET</span> that url then (starting to get bored now).  And, wait for it&#8230;  Yeah, we have downloaded transactions.  Phew.  Right then, just a little code tidying and I&#8217;ll get it uploaded to google code and this article can be posted.  Yay.</p>


	<p>Ok, so we&#8217;re uploaded to <a href="http://chrisroos.googlecode.com/svn/trunk/ing-direct">google code</a>.  Now to set this little fella free&#8230;  An we&#8217;re done.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/curl" rel="tag">curl</a>, 
                    
                      <a href="/articles/tag/direct" rel="tag">direct</a>, 
                    
                      <a href="/articles/tag/finance" rel="tag">finance</a>, 
                    
                      <a href="/articles/tag/ing" rel="tag">ing</a>, 
                    
                      <a href="/articles/tag/ing-direct" rel="tag">ing-direct</a>, 
                    
                      <a href="/articles/tag/ofx" rel="tag">ofx</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/transaction" rel="tag">transaction</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/23/this-makes-me-happy">This makes me happy</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 23 Jun 2007 17:34:00">
                    Sat, 23 Jun 2007 17:34:00
                  </span>
                </p>

                <p>A <a href="http://birchington.blogspot.com/">local blogger</a> forwards a <a href="http://birchington.blogspot.com/2007/06/unusual-request.html">request</a> he&#8217;s received from a visiting pilot for photos to be taken of him practising at our <a href="http://en.wikipedia.org/wiki/Kent_International_Airport">local airstrip</a>.  I duly <a href="http://www.flickr.com/photos/chrisjroos/sets/72157600450060497/">obliged</a> (not hard as I live under the flight path) as has <a href="http://www.flickr.com/photos/doverpast/sets/72157600449864913/">one other</a> so far.  The Internet is great isn&#8217;t it.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/airlines" rel="tag">airlines</a>, 
                    
                      <a href="/articles/tag/blog" rel="tag">blog</a>, 
                    
                      <a href="/articles/tag/flickr" rel="tag">flickr</a>, 
                    
                      <a href="/articles/tag/internet" rel="tag">internet</a>, 
                    
                      <a href="/articles/tag/kia" rel="tag">kia</a>, 
                    
                      <a href="/articles/tag/manston" rel="tag">manston</a>, 
                    
                      <a href="/articles/tag/oasis" rel="tag">oasis</a>, 
                    
                      <a href="/articles/tag/oasis-airlines" rel="tag">oasis-airlines</a>, 
                    
                      <a href="/articles/tag/photo" rel="tag">photo</a>, 
                    
                      <a href="/articles/tag/plane" rel="tag">plane</a>, 
                    
                      <a href="/articles/tag/thanet" rel="tag">thanet</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/23/automatically-download-egg-credit-card-transactions">Automatically download egg credit card transactions</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 23 Jun 2007 12:34:00">
                    Sat, 23 Jun 2007 12:34:00
                  </span>
                </p>

                <p>I&#8217;ve followed in my <a href="http://blog.seagul.co.uk/articles/2007/05/14/automatically-downloading-my-recent-transactions-from-lloyds-tsb">previous</a> <a href="http://blog.seagul.co.uk/articles/2007/05/04/automatically-downloading-my-most-recent-hsbc-transactions">footsteps</a> and automated the download of my <a href="http://egg.com">egg</a> credit card transactions and statements.  Using this in combination with my <a href="http://blog.seagul.co.uk/articles/2007/04/01/converting-egg-credit-card-statements-to-ofx-for-upload-to-wesabe">ofx convertor</a> makes it easier for me to upload my financial data to <a href="http://www.wesabe.com">wesabe</a>.</p>


	<p>As always, the code is in <a href="http://chrisroos.googlecode.com/svn/trunk/egg/">google code</a> and pasted below for your viewing pleasure&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">egg-credentials</span><span class="punct">'</span>

<span class="keyword">def </span><span class="method">execute_curl</span><span class="punct">(</span><span class="ident">cmd</span><span class="punct">)</span>
  `<span class="comment">#{cmd}`</span>
<span class="keyword">end</span>

<span class="constant">COOKIE_LOCATION</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">/tmp/egg.cookie</span><span class="punct">&quot;</span>
<span class="constant">STATEMENT_DATE</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">18 January 2007</span><span class="punct">'</span>

<span class="constant">RECENT_TRANSACTIONS_FILE</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">/Users/chrisroos/Desktop/egg-recent-transactions.html</span><span class="punct">'</span>
<span class="constant">STATEMENT_FILE</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">/Users/chrisroos/Desktop/egg-statement.html</span><span class="punct">'</span>

<span class="comment"># Logging in requires a cookie that is set when we first visit the login page</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -c&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://new.egg.com/security/customer/logon?URI=https://new.egg.com/customer/youraccounts&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># POST our login credentials</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; -c&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; -L &quot;https://logon.egg.com/LoginWebServer/services/CustomerLogin&quot; -d&quot;firstName=<span class="expr">#{FIRST_NAME}</span>&quot; -d&quot;lastName=<span class="expr">#{LAST_NAME}</span>&quot; -d&quot;dobDay=<span class="expr">#{DOB_DAY}</span>&quot; -d&quot;dobMonth=<span class="expr">#{DOB_MONTH}</span>&quot; -d&quot;dobYear=<span class="expr">#{DOB_YEAR}</span>&quot; -d&quot;postcode=<span class="expr">#{POSTCODE}</span>&quot; -d&quot;mmn=<span class="expr">#{MOTHERS_MAIDEN_NAME}</span>&quot; -d&quot;password=<span class="expr">#{PASSWORD}</span>&quot; -d&quot;HiddenURI=https%3A%2F%2Fnew.egg.com%2Fcustomer%2Fyouraccounts&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># List and save recent transactions</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -o&quot;<span class="expr">#{RECENT_TRANSACTIONS_FILE}</span>&quot; -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://your.egg.com/customer/eggcard/recenttransactions.aspx&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># There is no sensible way to get your statements.  I'd hope for something like /statements/18-jun-2007.html but no such luck</span>
<span class="comment"># Instead, there is a zero indexed array of statement dates.  Selecting one of these statement dates allows us to construct</span>
<span class="comment"># a uri using the index of the date in the list.  So, if 18 June 2007 is the first date in the list (i.e. index 0) then we can view that</span>
<span class="comment"># statement at https://your.egg.com/customer/eggcard/statements.aspx?index=0</span>
<span class="comment"># Interestingly, this is how it works from the recent transactions page, from any actual statement page, it appears that this is</span>
<span class="comment"># too hard (it's not) and instead the developers have resorted to using some magical .net/javascript voodoo to obtain a different</span>
<span class="comment"># statement.</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">hpricot</span><span class="punct">'</span>

<span class="ident">recent_transactions</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">open</span><span class="punct">(</span><span class="constant">RECENT_TRANSACTIONS_FILE</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">f</span><span class="punct">|</span> <span class="ident">f</span><span class="punct">.</span><span class="ident">read</span> <span class="punct">}</span>
<span class="ident">doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">recent_transactions</span><span class="punct">)</span>
<span class="ident">statement_dates</span> <span class="punct">=</span> <span class="punct">[]</span>
<span class="punct">(</span><span class="ident">doc</span><span class="punct">/'</span><span class="string">select#ctl01_content_recenttransactions_lstPreviousStatements/option</span><span class="punct">').</span><span class="ident">each</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">e</span><span class="punct">|</span> <span class="ident">statement_dates</span> <span class="punct">&lt;&lt;</span> <span class="ident">e</span><span class="punct">.</span><span class="ident">inner_text</span> <span class="punct">}</span>
<span class="ident">statement_index</span> <span class="punct">=</span> <span class="ident">statement_dates</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span><span class="constant">STATEMENT_DATE</span><span class="punct">)</span>

<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -o&quot;<span class="expr">#{STATEMENT_FILE}</span>&quot; -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://your.egg.com/customer/eggcard/statements.aspx?index=<span class="expr">#{statement_index}</span>&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

</code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/curl" rel="tag">curl</a>, 
                    
                      <a href="/articles/tag/egg" rel="tag">egg</a>, 
                    
                      <a href="/articles/tag/finance" rel="tag">finance</a>, 
                    
                      <a href="/articles/tag/ofx" rel="tag">ofx</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/13/i-really-dont-know-whether-this-is-spam-or-not">I really don't know whether this is spam or not...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 13 Jun 2007 22:18:00">
                    Wed, 13 Jun 2007 22:18:00
                  </span>
                </p>

                <p>I&#8217;ve received another innocent looking comment, &#8220;Hey man, thanks for article!&#8221;, this time from gribitonline.com.</p>


	<p>I followed the same procedure as <a href="http://blog.seagul.co.uk/articles/2007/06/06/a-little-further-investigation-into-those-pesky-scammers">last time</a>  and found that this site contains  the same style porn links at the bottom of the page.  The site looks more genuine than all the others, hence the title &#8211; I&#8217;m really not sure whether this is intentional spam or whether it&#8217;s been hijacked.</p>


	<p>I did some investigation to see if I could find the provider of the porn links.  Unfortunately I&#8217;ve not found anything obvious, although I have noticed some patterns.</p>


	<ul>
	<li>The porn links are embedded within the body of the page and then moved to the bottom with the help of javascript.  I assume that this is an <a href="http://www.wikipedia.org/wiki/SEO"><span class="caps">SEO</span></a> trick, based on the understanding that links in content are granted higher ratings than links just for navigation.</li>
	</ul>


	<h3>Site without javascript enabled</h3>


	<p><img src="http://farm2.static.flickr.com/1208/544423293_cdf567e9a2_o.jpg" alt="" /></p>


	<h3>Site with javascript enabled</h3>


	<p><img src="http://farm2.static.flickr.com/1040/544325496_41bc3cb742_o.jpg" alt="" /></p>


	<ul>
	<li>The javascript used to move the links always looks like this.</li>
	</ul>


<div class="typocode"><pre><code class="typocode_default">var el, el2;
el = document.getElementById('cbceddfd');
el2 = document.getElementById('cceedfda');
if (el &amp;&amp; el2)
el2.appendChild(el);
el = document.getElementById('bfabedba');
el2 = // ... and repeat</code></pre></div>

	<ul>
	<li>Each link is inserted into its own empty span at the bottom of the page.  The spans seem to have the same ids on each of the sites that have these type of links.  The first span is always cceedfda, the second is cecfaabe, with subsequent ids also being the same across different sites.  There doesn&#8217;t appear to be any other pattern to the ids.</li>
	</ul>


	<ul>
	<li>Sites from previous experiment that follow this pattern
	<ul>
	<li>timesofsooz.com</li>
		<li>pinkyspaperhause.com</li>
		<li>moradblog.com</li>
		<li>fromgreghead.com</li>
	</ul></li>
	</ul>


	<ul>
	<li>I&#8217;m really quite intrigued by these sites.  Sad, I know.</li>
	</ul>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/sad" rel="tag">sad</a>, 
                    
                      <a href="/articles/tag/spam" rel="tag">spam</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/07/steel-mounted-photographic-wall-prints-or-cool-pictures-printed-on-metal-in-thanet">Steel mounted photographic wall prints (or, cool pictures printed on metal) in Thanet</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 07 Jun 2007 08:44:00">
                    Thu, 07 Jun 2007 08:44:00
                  </span>
                </p>

                <p><a href="http://www.printeriordesign.co.uk">Printerior Design</a> are a <a href="http://en.wikipedia.org/wiki/Thanet">local</a> (to me, probably not to you) firm that produce cool pictures.  They are beautiful <a href="http://www.printeriordesign.co.uk/galleries.html">photos</a> printed directly onto heavy duty metal &#8211; &#8216;man-art&#8217; if you will.  I bought <a href="http://www.printeriordesign.co.uk/landscapes/pages/Dawn%201500%20thumbnail%20with%20drop%20shadow_jpg.htm">this one</a> as a Christmas present.</p>


	<p><a href="http://www.printeriordesign.co.uk/landscapes/pages/Dawn%201500%20thumbnail%20with%20drop%20shadow_jpg.htm"><img src="http://farm2.static.flickr.com/1239/534275282_2d4ba6dde1.jpg" alt="" /></a></p>


	<p>The reason for this post is because a friend recently asked me where I got the picture.  Not remembering the name of the company, I started googling.  I knew that they had pictures in Harpers Wine Bar (I thought they had a website but I can&#8217;t find it) in <a href="http://en.wikipedia.org/wiki/Broadstairs">Broadstairs</a>, and in the <a href="http://www.albionbroadstairs.co.uk/">Albion Hotel</a>, also in Broadstairs.  I also knew that their workshop was on Pysons Road Industrial estate.  Sadly, even with this info, they just weren&#8217;t appearing in google.  So, I&#8217;m hoping that this might help them out a little bit.</p>


	<p>I can&#8217;t help but think that they&#8217;d benefit massively from a blog about their work &#8211; I&#8217;m of the belief that what they do is pretty different.</p>


	<p><strong>Update</strong> I&#8217;ve uploaded a copy of the picture I have to <a href="http://www.flickr.com">flickr</a> and embedded it in this post &#8211; hoping the printerior guys don&#8217;t mind too much&#8230;</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/art" rel="tag">art</a>, 
                    
                      <a href="/articles/tag/broadstairs" rel="tag">broadstairs</a>, 
                    
                      <a href="/articles/tag/graphic" rel="tag">graphic</a>, 
                    
                      <a href="/articles/tag/photo" rel="tag">photo</a>, 
                    
                      <a href="/articles/tag/print" rel="tag">print</a>, 
                    
                      <a href="/articles/tag/printeriordesign" rel="tag">printeriordesign</a>, 
                    
                      <a href="/articles/tag/thanet" rel="tag">thanet</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/07/reevoo-com-and-seo">Reevoo.com and Seo</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 07 Jun 2007 08:30:00">
                    Thu, 07 Jun 2007 08:30:00
                  </span>
                </p>

                <p><a href="http://www.reevoo.com">We</a> had an <a href="http://en.wikipedia.org/wiki/Search_engine_optimization">Seo</a> consultant in yesterday.  Although a lot of what was suggested was common sense there were a few interesting snippets of information.</p>


	<ul>
	<li>Seo is only just starting to become a viable marketing option in the Uk.  Are we really that far behind the states?</li>
		<li>Google are working really hard on getting their bots to &#8216;see&#8217; the page exactly the same as a user.  This allows them to give a higher rating to content appearing in the top left hand corner of the page (the bit a user looks at first), regardless of where it is in the document.</li>
		<li>Google accounts for about 97% of search in the Uk, so although we talk about search engine optimisation, we really mean google optimisation.</li>
		<li><a href="http://www.sitemaps.org">Xml sitemaps</a> have little or no effect.  The majority of reevoo.com may soon be made up of pages with little or no review content.  The suggestion is that we keep these pages hidden from google, but by using <a href="http://microformats.org/wiki/rel-nofollow">rel=&#8217;nofollow&#8217;</a> when linking to these pages from within the site, not by removing them from the sitemap.</li>
		<li>Having an unbalanced number of links-out vs links-in is bad.  This is related to the above point.  The reason we may well end up with lots of pages with little content is that we have a relatively long lead time between a product being released and us collecting reviews for it.  We would like to be able to present some useful info for these products even if we don&#8217;t have reviews &#8211; links to relevant material elsewhere on the net seems like one way of reaching that goal.</li>
		<li>Google still recognises dial-up as the lowest common denominator when taking into account page download size and time.  It was suggested that each page be no larger than 100KB.  Hmm, <a href="http://www.prototypejs.org">prototype</a> alone seems to weigh in at around 97KB, and we are sending 225KB of javascript for any given product page (<a href="http://www.reevoo.com/reviews/mpn/nikon/d70">example</a>).</li>
		<li>Title attributes on anchors carry a lot of weighting.</li>
		<li>Links in content are more valuable than a bunch of stand-alone links.</li>
		<li>People aren&#8217;t particular interested in searching/filtering by price.  Really?</li>
	</ul>


	<p>A lot of the advice boils down to having a site that people actually find useful.  I think that if we can work on that in combination with the basic principles of well formed documents, clean separation of <a href="http://en.wikipedia.org/wiki/CSS">presentation</a> from content and of <a href="http://en.wikipedia.org/wiki/Unobtrusive_JavaScript">behaviour from markup</a>, we&#8217;ll have a solid base on which to apply the tips above.</p>


	<p>Oh, and the reason for the Seo chap coming in was in an attempt to find out why we fell off the google radar a few months back.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/seo" rel="tag">seo</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/06/a-little-further-investigation-into-those-pesky-scammers">A little further investigation into those pesky scammers</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 06 Jun 2007 23:11:00">
                    Wed, 06 Jun 2007 23:11:00
                  </span>
                </p>

                <p>I <a href="http://blog.seagul.co.uk/articles/2007/05/17/pesky-scammers">wrote</a> a short while ago about receiving comments that were not obviously spam.  In the few weeks  between that post and this, I&#8217;ve received several more legitimate looking comments.  Tonight, I finally looked in some detail at the comments I&#8217;d received.  The comments were either very generic (&#8216;nice post&#8217; or &#8216;thanks for the info&#8217;) or were copied from previous comments on the site.  The &#8216;homepages&#8217; came in four different flavours.</p>


	<h3>Look like legitimate blogs but contain hidden content and porn links at the bottom of the page.</h3>


	<ul>
	<li>moradblog.com</li>
		<li>fromgreghead.com</li>
	</ul>


	<h3>Crappy web shops.  These only really caught my attention because they all look identical.</h3>


	<ul>
	<li>camikon.com</li>
		<li>leaderdvd.com</li>
		<li>pet-supplies-store.info</li>
	</ul>


	<h3>Look like legitimate blogs but are noticeable due to a complete lack of style and porn links at the bottom of the page.</h3>


	<ul>
	<li>pinkyspaperhause.com</li>
		<li>timesofsooz.com</li>
	</ul>


	<h3>Look like legitimate websites but a <code>site:&lt;website&gt;</code> search in google reveals lots of porn pages.</h3>


	<ul>
	<li>smachex.info</li>
		<li>wampy.info</li>
		<li>www.valmux.com</li>
	</ul>


	<p>Oh, there is also one other site that I really cannot decide whether to classify as spam or not &#8211; ireadnews.net (sorry if you&#8217;re not spam).</p>


	<p>The addresses are here (and not linked to) for the benefit of anyone that happens to stumble across this page.  I&#8217;m actually quite amazed at the depth of some of these sites.  moradblog.com in particular has links to lots of &#8216;web 2.0&#8217; sites for &#8216;morad&#8217; (flickr, del.icio.us etc).  It makes me half wonder if they are actual spam sites or whether the site has been hijacked in some way..</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/comments" rel="tag">comments</a>, 
                    
                      <a href="/articles/tag/spam" rel="tag">spam</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/05/ranting-about-sky">Ranting about Sky</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 05 Jun 2007 23:03:00">
                    Tue, 05 Jun 2007 23:03:00
                  </span>
                </p>

                <p>I have three minor outstanding issues with a recent sky installation.  Not wanting to phone them (as previous experience suggests that it&#8217;s going to waste a lot of my life) I thought I&#8217;d drop them an email.</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/532292949/"><img src="http://farm2.static.flickr.com/1324/532292949_c503f0b1db.jpg" alt="" /></a></p>


	<p>Uh oh.  Looks like they don&#8217;t want my email.</p>


	<blockquote>
		<p>&#8220;The highlighted field above has an invalid value.  Please correct it.
Please make sure that no more than 500 characters have been entered in this field.&#8221;</p>
	</blockquote>


	<p>So now, not only have I wasted time waiting for their website to time out while signing up, but I&#8217;ve also wasted time filling in a useless feedback form, taking a screenshot and even blogging about it.  Oh, and I&#8217;m still going to have to speak to someone.  Brilliant.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/shit" rel="tag">shit</a>, 
                    
                      <a href="/articles/tag/sky" rel="tag">sky</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/01/an-open-letter-to-my-local-newspapers">An open letter to my local newspapers</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 01 Jun 2007 12:00:00">
                    Fri, 01 Jun 2007 12:00:00
                  </span>
                </p>

                <p>I just sent this email to the editors of four local papers.</p>


<blockquote>
Hi,

	<p>I&#8217;m emailing you as representatives of (what I believe to be) the four main newspapers in Thanet.</p>


	<ul>
	<li>KM Extra</li>
		<li>Thanet Adscene</li>
		<li>Isle of Thanet Gazette</li>
		<li>Thanet Times</li>
	</ul>


	<p>On the off chance you&#8217;re already bored or have filed me to spam (please don&#8217;t), a quick summary is that I&#8217;m offering to do some work, for free, that might help foster discussion around your newspaper content.</p>


	<p>I&#8217;d love it if all of your newspaper content was on-line.  I realise that both kentonline.co.uk and ickent.co.uk already exist and carry <strong>some</strong> of the content from your papers.  I also realise that it may not be commercially wise to publish all newspaper content on-line.</p>


	<p>So, I&#8217;ve come up with a very cunning (it&#8217;s not that cunning) plan.  I&#8217;m thinking of creating a blog-type site, where each post will represent a newspaper story.  I propose that the title of the blog post will be the title of the article in the paper, and that the body of the blog post will be left blank.  My intention is that people that buy/receive any of the above papers can use the permalink of the blog post as a central discussion point.  They can either comment right there on the blog or they can ping/trackback to the post from their own blogs.  The best thing that could happen is that other people stumble across these conversations and want to get involved, at which point they have to go buy a copy of the paper to get the original content.</p>


	<p>I&#8217;m planning on doing this stuff anyway, but I wanted to give you guys a heads up.  I figure that this mail will either a) land in spamland, b) be received with a negative response, or c) be received with a positive response.  Oh, or d) received and ignored.  Pretty much covered all bases there haven&#8217;t I?  Anyhoo, I&#8217;d love to hear any thoughts you have, especially if they are strongly for or against the idea.</p>


	<p>This letter will be posted to my blog<sup><a href="#fn1">1</a></sup> shortly.  On the off chance you&#8217;ve read this far and feel like replying, I&#8217;d like to post them to my blog too, but that&#8217;s completely up to you.</p>


	<p>To summarize.</p>


	<ul>
	<li>I&#8217;d like to converse with other people that have read the same article that I have.</li>
		<li>The only content from your newspapers that will appear on-line is the heading of each article.</li>
		<li>I&#8217;m offering to do all the work.</li>
		<li>I&#8217;ll host the site and transcribe each article from each of the four weekly papers.</li>
		<li>The site won&#8217;t have advertising.</li>
		<li>Anyone can comment on the site.</li>
		<li>Anyone can trackback/pingback to the site.</li>
		<li>I can&#8217;t promise that I&#8217;ll keep up the work forever.</li>
		<li>All the content of the site will be available to anyone that wants it &#8211; probably under a creative commons license or something similar.</li>
		<li>I have no intention of making money from this.  In fact, I&#8217;m willing to pay money to make it happen.</li>
	</ul>


	<p>Cheers,</p>


	<p>Chris</p>


[1] http://blog.seagul.co.uk
</blockquote>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/converse" rel="tag">converse</a>, 
                    
                      <a href="/articles/tag/discourse" rel="tag">discourse</a>, 
                    
                      <a href="/articles/tag/kent" rel="tag">kent</a>, 
                    
                      <a href="/articles/tag/media" rel="tag">media</a>, 
                    
                      <a href="/articles/tag/newspaper" rel="tag">newspaper</a>, 
                    
                      <a href="/articles/tag/thanet" rel="tag">thanet</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/06/01/i-wanna-be-cool-too">I wanna be cool too</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 01 Jun 2007 09:10:00">
                    Fri, 01 Jun 2007 09:10:00
                  </span>
                </p>

                <p>Err, right.  Anyhoo, I&#8217;ve started using <a href="http://www.tumblr.com">tumblr</a> to aggregate (currently) my <a href="http://flickr.com/photos/chrisjroos">flickr</a>, <a href="http://twitter.com/chrisroos">twitter</a> and <a href="http://del.icio.us/chrisjroos">del.icio.us</a> feeds.  What&#8217;s that you say, &#8220;where is it?&#8221;, why, it&#8217;s right <a href="http://life.chrisroos.co.uk">here</a> of course.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/lifestream" rel="tag">lifestream</a>, 
                    
                      <a href="/articles/tag/tumblr" rel="tag">tumblr</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/05/17/pesky-scammers">Pesky Scammers</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 17 May 2007 22:55:00">
                    Thu, 17 May 2007 22:55:00
                  </span>
                </p>

                <p>A couple of days ago, I received a comment to one of my articles.  &#8220;Hmm, that looks familiar I thought&#8221;, and not without good reason.  You see, the comment had been copied verbatim from another comment on the same article.  The only change was the author&#8217;s name and the url of their &#8216;homepage&#8217;.  After a little deliberation I deleted the comment.  I found it interesting for two reasons.</p>


	<ol>
	<li>The &#8216;homepage&#8217; link wasn&#8217;t obviously spam (it was some kind of kitchen site I believe), although a quick search did reveal it on some blacklists.</li>
		<li>I am unable to teach <a href="http://akismet.com/">akismet</a> (my current form of spam protection) to recognise these types of messages as spam, after all, the content itself is perfectly valid.</li>
	</ol>


	<p>Anyway, I got on with my life until, whoah, it happened again this morning.  Same article but a different comment had been copied.  The mystery continues&#8230; (at least, until I forget about it again).</p>


	<p>Anyone else experienced this?</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/spam" rel="tag">spam</a>, 
                    
                      <a href="/articles/tag/spammed" rel="tag">spammed</a>, 
                    
                      <a href="/articles/tag/spammedy" rel="tag">spammedy</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/05/14/automatically-downloading-my-recent-transactions-from-lloyds-tsb">Automatically downloading my recent transactions from Lloyds Tsb</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 14 May 2007 22:39:00">
                    Mon, 14 May 2007 22:39:00
                  </span>
                </p>

                <p>In my continuing quest to cut down my use of banking websites (and increase my use of <a href="http://www.wesabe.com">wesabe</a>), I&#8217;ve hacked together a script to download my recent transactions from <a href="http://www.lloydstsb.com">Lloyds Tsb</a>.  Sadly, the transactions are in <a href="http://en.wikipedia.org/wiki/QIF"><span class="caps">QIF</span></a> format, as only <span class="caps">QIF</span> and <a href="http://en.wikipedia.org/wiki/Comma-separated_values"><span class="caps">CSV</span></a> formats are offered.  Maybe I&#8217;ll get round to exporting the data in <a href="http://www.ofx.net"><span class="caps">OFX</span></a> format sometime in the future.</p>


	<p>Code is hosted on <a href="http://chrisroos.googlecode.com/svn/trunk/lloydstsb/">google code</a>, and pasted in all its syntax-highlighted glory below.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">lloydstsb_credentials</span><span class="punct">'</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">hpricot</span><span class="punct">'</span>

<span class="keyword">def </span><span class="method">execute_curl</span><span class="punct">(</span><span class="ident">cmd</span><span class="punct">)</span>
  `<span class="comment">#{cmd}`</span>
<span class="keyword">end</span>

<span class="constant">COOKIE_LOCATION</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">/Users/chrisroos/lloydstsb_cookie</span><span class="punct">'</span>
<span class="constant">DOWNLOADED_STATEMENT_LOCATION</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">/Users/chrisroos/Desktop/lloyds.qif</span><span class="punct">'</span>

<span class="comment"># Store some cookies for later</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -c&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://online.lloydstsb.co.uk/customer.ibc&quot;</span><span class="punct">]</span>
<span class="ident">html</span> <span class="punct">=</span> <span class="ident">execute_curl</span><span class="punct">(</span><span class="ident">curl_cmd</span><span class="punct">)</span>

<span class="comment"># Obtain the key that we need to POST along with our Username and Password</span>
<span class="ident">doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">html</span><span class="punct">)</span>
<span class="ident">key</span> <span class="punct">=</span> <span class="punct">(</span><span class="ident">doc</span><span class="punct">/'</span><span class="string">input[@name=Key]</span><span class="punct">').</span><span class="ident">first</span><span class="punct">.</span><span class="ident">attributes</span><span class="punct">['</span><span class="string">value</span><span class="punct">']</span>

<span class="comment"># POST the key, userid and password</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://online.lloydstsb.co.uk/logon.ibc&quot; -d&quot;Java=Off&quot; -d&quot;Key=<span class="expr">#{key}</span>&quot; -d&quot;UserId1=<span class="expr">#{USERID}</span>&quot; -d&quot;Password=<span class="expr">#{PASSWORD}</span>&quot;</span><span class="punct">]</span>
<span class="ident">html</span> <span class="punct">=</span> <span class="ident">execute_curl</span><span class="punct">(</span><span class="ident">curl_cmd</span><span class="punct">)</span>

<span class="comment"># Obtain the three characters from our memorable info that we need to POST</span>
<span class="ident">doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">html</span><span class="punct">)</span>
<span class="ident">position_of_char1</span> <span class="punct">=</span> <span class="constant">Integer</span><span class="punct">((</span><span class="ident">doc</span><span class="punct">/'</span><span class="string">input[@name=ResponseKey0]</span><span class="punct">').</span><span class="ident">first</span><span class="punct">.</span><span class="ident">attributes</span><span class="punct">['</span><span class="string">value</span><span class="punct">'])</span>
<span class="ident">position_of_char2</span> <span class="punct">=</span> <span class="constant">Integer</span><span class="punct">((</span><span class="ident">doc</span><span class="punct">/'</span><span class="string">input[@name=ResponseKey1]</span><span class="punct">').</span><span class="ident">first</span><span class="punct">.</span><span class="ident">attributes</span><span class="punct">['</span><span class="string">value</span><span class="punct">'])</span>
<span class="ident">position_of_char3</span> <span class="punct">=</span> <span class="constant">Integer</span><span class="punct">((</span><span class="ident">doc</span><span class="punct">/'</span><span class="string">input[@name=ResponseKey2]</span><span class="punct">').</span><span class="ident">first</span><span class="punct">.</span><span class="ident">attributes</span><span class="punct">['</span><span class="string">value</span><span class="punct">'])</span>
<span class="ident">char1</span> <span class="punct">=</span> <span class="constant">MEMORABLE</span><span class="punct">.</span><span class="ident">split</span><span class="punct">('</span><span class="string"></span><span class="punct">')[</span><span class="ident">position_of_char1</span> <span class="punct">-</span> <span class="number">1</span><span class="punct">]</span>
<span class="ident">char2</span> <span class="punct">=</span> <span class="constant">MEMORABLE</span><span class="punct">.</span><span class="ident">split</span><span class="punct">('</span><span class="string"></span><span class="punct">')[</span><span class="ident">position_of_char2</span> <span class="punct">-</span> <span class="number">1</span><span class="punct">]</span>
<span class="ident">char3</span> <span class="punct">=</span> <span class="constant">MEMORABLE</span><span class="punct">.</span><span class="ident">split</span><span class="punct">('</span><span class="string"></span><span class="punct">')[</span><span class="ident">position_of_char3</span> <span class="punct">-</span> <span class="number">1</span><span class="punct">]</span>

<span class="comment"># POST our memorable info</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -L -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://online.lloydstsb.co.uk/miheld.ibc&quot; -d&quot;ResponseKey0=<span class="expr">#{position_of_char1}</span>&quot; -d&quot;ResponseValue0=<span class="expr">#{char1}</span>&quot; -d&quot;ResponseKey1=<span class="expr">#{position_of_char2}</span>&quot; -d&quot;ResponseValue1=<span class="expr">#{char2}</span>&quot; -d&quot;ResponseKey2=<span class="expr">#{position_of_char3}</span>&quot; -d&quot;ResponseValue2=<span class="expr">#{char3}</span>&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># SELECT OUR ACCOUNT</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://online.lloydstsb.co.uk/account.ibc?Account=<span class="expr">#{SORT_CODE_AND_ACCOUNT_NUMBER}</span>&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># GET OUR MOST RECENT TRANSACTIONS</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://online.lloydstsb.co.uk/statement.ibc?Account=<span class="expr">#{SORT_CODE_AND_ACCOUNT_NUMBER}</span>&amp;PageRequired=MostRecent&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># GET THE DOWNLOAD STATEMENT FORM</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://online.lloydstsb.co.uk/statement.ibc?Account=<span class="expr">#{SORT_CODE_AND_ACCOUNT_NUMBER}</span>&amp;selectbox=6&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># DOWNLOAD THE MOST RECENT TRANSACTIONS IN QIF FORMAT</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -L -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://online.lloydstsb.co.uk/statementdownload.ibc?Account=<span class="expr">#{SORT_CODE_AND_ACCOUNT_NUMBER}</span>&amp;Download=DownloadLatest&amp;Format=104&quot; -o&quot;<span class="expr">#{DOWNLOADED_STATEMENT_LOCATION}</span>&quot;</span><span class="punct">]</span>
<span class="ident">execute_curl</span> <span class="ident">curl_cmd</span>

<span class="comment"># Remove the cookie</span>
`<span class="ident">rm</span> <span class="comment">#{COOKIE_LOCATION}`</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/banking" rel="tag">banking</a>, 
                    
                      <a href="/articles/tag/lloyds" rel="tag">lloyds</a>, 
                    
                      <a href="/articles/tag/lloyds-tsb" rel="tag">lloyds-tsb</a>, 
                    
                      <a href="/articles/tag/qif" rel="tag">qif</a>, 
                    
                      <a href="/articles/tag/tsb" rel="tag">tsb</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/05/04/automatically-downloading-my-most-recent-hsbc-transactions">Automatically downloading my most recent Hsbc transactions</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 04 May 2007 12:53:00">
                    Fri, 04 May 2007 12:53:00
                  </span>
                </p>

                <p>I&#8217;ve updated my <a href="http://blog.seagul.co.uk/articles/2006/12/24/curl-is-fast-becoming-my-favourite-toy">previous</a> curl/ruby script to automatically download my most recent transactions from Hsbc.  I created the original script as I had a couple of hours spare and wanted to see if I could do it.  The update has been driven by my continued use of <a href="http://www.wesabe.com">wesabe</a>.  Not only does it make my life a bit easier (which is, after all, the point of software) but the wesabe guys have suggested that they may be able to roll it into their client.  Cool.</p>


	<p>As an aside.  It really, really, really shouldn&#8217;t be as hard as it is to automatically get a downloaded list of my transactions.  At least Hsbc offer transactions in <a href="http://www.ofx.net">ofx</a> format, unlike <a href="http://blog.seagul.co.uk/articles/2007/04/01/converting-egg-credit-card-statements-to-ofx-for-upload-to-wesabe">egg</a> and <a href="http://chrisroos.googlecode.com/svn/trunk/egg-ofx/ing_direct">ing direct</a>.  Come on, The Banks, sort it out eh.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/curl" rel="tag">curl</a>, 
                    
                      <a href="/articles/tag/egg" rel="tag">egg</a>, 
                    
                      <a href="/articles/tag/hsbc" rel="tag">hsbc</a>, 
                    
                      <a href="/articles/tag/ingdirect" rel="tag">ingdirect</a>, 
                    
                      <a href="/articles/tag/ofx" rel="tag">ofx</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/30/a-fun-and-crappy-monday-morning-quiz">A fun (and crappy) Monday morning quiz</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 30 Apr 2007 09:08:00">
                    Mon, 30 Apr 2007 09:08:00
                  </span>
                </p>

                <div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>

<span class="keyword">class </span><span class="class">CandidateTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">setup</span>
    <span class="attribute">@candidate</span> <span class="punct">=</span> <span class="constant">Candidate</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">test_should_love_learning</span>
    <span class="ident">assert</span> <span class="attribute">@candidate</span><span class="punct">.</span><span class="ident">loves_learning?</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">test_should_love_ruby</span>
    <span class="ident">assert</span> <span class="attribute">@candidate</span><span class="punct">.</span><span class="ident">loves_ruby?</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">test_should_love_problem_solving</span>
    <span class="ident">assert</span> <span class="attribute">@candidate</span><span class="punct">.</span><span class="ident">loves_problem_solving?</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">test_should_not_be_a_job_agency</span>
    <span class="ident">assert</span> <span class="punct">!</span><span class="attribute">@candidate</span><span class="punct">.</span><span class="ident">is_a_job_agency?</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">test_should_know_the_secret_password</span>
    <span class="ident">secret_password</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">hmm, so you think you know the secret password huh?</span><span class="punct">'</span>
    <span class="ident">candidate</span> <span class="punct">=</span> <span class="constant">Candidate</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="ident">secret_password</span><span class="punct">)</span>
    <span class="ident">i_know_it_so_please_show_me_the_money</span><span class="punct">(</span><span class="ident">candidate</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">__END__
Y2xhc3MgQ2FuZGlkYXRlCiAgZGVmIGluaXRpYWxpemUodG9wX3NlY3JldF9w
YXNzd29yZCA9IG5pbCkKICAgIEBzZWNyZXRfbWVzc2FnZSA9IG5pbAogICAg
aWYgdG9wX3NlY3JldF9wYXNzd29yZCA9PSAncnVieSBpcyBjb29sJwogICAg
ICBAc2VjcmV0X21lc3NhZ2UgPSAiQ2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9x
S2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9xCktpb3FLaW9x
S2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9xS2lvcUtpb3FL
aW9xQ2xkdgpiMmh2Ynl3Z2VXOTFJR1p2ZFc1a0lIUm9hWE1nZG1WeWVTQndi
Mjl5YkhrZ2FHbGtaR1Z1TENCdFpXZGgKTFhObFkzSmxkQ3dnYldWemMyRm5a
UzRLQ2trZ2MyRjVJRzFsWjJFdGMyVmpjbVYwTENCaWRYUWdkRzhnClltVWdh
Rzl1WlhOMExDQjBhR2x6SUdseklHcDFjM1FnWVNCMGFHbHViSGtnZG1WcGJH
VmtJR3B2WWlCaApaSFpsY25RZ1ptOXlDbkpsWlhadmJ5NWpiMjB1SUNCVGIz
SnllU3dnWW5WMElFa2dkMkZ6SUdKdmNtVmsKSUc5dUlIUm9aU0IwY21GcGJp
NHVMZ29LUVc1NWFHOXZMQ0JwWmlCNWIzVWdabUZ1WTNrZ2QyOXlhMmx1Clp5
QjNhWFJvSUhWeklIUm9aVzRnWTJobFkyc2dRbVZ1SjNNZ2NHOXpkRnN4WFNC
aGJtUWdZWEJ3YkhrcwpJR0Z3Y0d4NUxDQmhjSEJzZVM0S0Nsc3hYU0JvZEhS
d09pOHZkM2QzTG5KbFpYWnZieTVqYjIwdllteHYKWjNNdlltVnVaM0pwWm1a
cGRHaHpMekl3TURjdk1EUXZNRE12Y21GcGJITXRaR1YyWld4dmNHVnlMV3B2
CllpOEtLaW9xS2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9x
S2lvcUtpb3FLaW9xS2lvcQpLaW9xS2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9x
S2lvcUtpb3FLaW9xS2lvcUtpb3FLaW9xS2lvcUtpb0sKQ2c9PQoiCiAgICBl
bmQKICBlbmQKICBkZWYga25vd3NfdGhlX3NlY3JldF9wYXNzd29yZD8KICAg
IEBzZWNyZXRfbWVzc2FnZQogIGVuZAogIGRlZiBsb3Zlc19sZWFybmluZz8K
ICAgIHRydWUKICBlbmQKICBkZWYgbG92ZXNfcnVieT8KICAgIHRydWUKICBl
bmQKICBkZWYgbG92ZXNfcHJvYmxlbV9zb2x2aW5nPwogICAgdHJ1ZQogIGVu
ZAogIGRlZiBpc19hX2pvYl9hZ2VuY3k/CiAgICBmYWxzZQogIGVuZAogIGRl
ZiBzZWNyZXRfbWVzc2FnZQogICAgcmFpc2UgIlVoIG9oLCBsb29rcyBsaWtl
IHlvdSBoYXZlIG9uZSBvdGhlciBsaXR0bGUgbWV0aG9kIHRvIGltcGxlbWVu
dC4uLiIKICBlbmQKZW5kCgpjbGFzcyBUZXN0OjpVbml0OjpUZXN0Q2FzZQog
IGRlZiBpX2tub3dfaXRfc29fcGxlYXNlX3Nob3dfbWVfdGhlX21vbmV5KGNh
bmRpZGF0ZSkKICAgIHJhaXNlICJVaCBvaCwgdGhhdCdzIG5vdCB0aGUgcmln
aHQgcGFzc3dvcmQiIHVubGVzcyBjYW5kaWRhdGUua25vd3NfdGhlX3NlY3Jl
dF9wYXNzd29yZD8KICAgIHB1dHMgQ2FuZGlkYXRlLm5ldygncnVieSBpcyBj
b29sJykuc2VjcmV0X21lc3NhZ2UKICBlbmQKZW5kCg==</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/job" rel="tag">job</a>, 
                    
                      <a href="/articles/tag/quiz" rel="tag">quiz</a>, 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/20/tonic-systems-tonicpoint-free-powerpoint-viewer">Tonic Systems TonicPoint free Powerpoint viewer</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 20 Apr 2007 09:01:00">
                    Fri, 20 Apr 2007 09:01:00
                  </span>
                </p>

                <p>I had need to view a powerpoint presentation on my Mac.  In the past, I&#8217;ve uploaded them to <a href="http://www.slideshare.net">slideshare</a>, but that wasn&#8217;t suitable in this instance.  A quick google reveals some free java software by tonic systems.  Unfortunately (well, fortunately for tonic systems), they&#8217;ve been <a href="http://www.tonicsystems.com/">bought</a> by google and the link to their software has disappeared.  Luckily, the google cache has a copy of the <a href="http://www.google.co.uk/search?q=cache:4BswR-sgicYJ:www.tonicsystems.com/products/viewer/+tonicsystems+java+viewer&#38;hl=en&#38;ct=clnk&#38;cd=1&#38;gl=uk">original page</a> with a <a href="http://downloads.tonicsystems.com/viewer/TonicPointViewer-1.4-OSX.zip">working link</a> to the download.</p>


	<p>This probably won&#8217;t remain relevant very long, what with the recent <a href="http://www.techcrunch.com/2007/04/17/googles-office-suite-complete-google-powerpoint-confirmed/">news</a> of google adding a powerpoint clone to their office suite.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                      <a href="/articles/tag/office" rel="tag">office</a>, 
                    
                      <a href="/articles/tag/powerpoint" rel="tag">powerpoint</a>, 
                    
                      <a href="/articles/tag/software" rel="tag">software</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/14/ebay-feedback">ebay feedback</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 14 Apr 2007 08:47:00">
                    Sat, 14 Apr 2007 08:47:00
                  </span>
                </p>

                <p>This is a pathetic moan about something that is really not important at all.</p>


	<p>I bought an <a href="http://cgi.ebay.co.uk/ws/eBayISAPI.dll?ViewItem&#38;ih=014&#38;sspagename=STRK%3AMEWN%3AIT&#38;viewitem=&#38;item=330105019114&#38;rd=1&#38;rd=1">Apple mini <span class="caps">DVI</span> to <span class="caps">VGA</span> adapter</a> from someone on <a href="http://www.ebay.co.uk">ebay</a>.  For various reasons, I was unable to test the adapter until yesterday (Fri 13th Apr), two weeks after the purchase.  That didn&#8217;t stop the seller emailing me a week ago, suggesting that I leave feedback before they do.  That&#8217;s pathetic &#8211; feedback should be left for me based on the speed of my purchase alone, which was immediate.  What the seller is actually saying in that email is that if I decide to leave them bad feedback then they&#8217;ll probably do the same to me out of retaliation.  Grow up eh.</p>


	<p>The adapter actually works great, and I&#8217;ve now left the seller positive feedback.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ebay" rel="tag">ebay</a>, 
                    
                      <a href="/articles/tag/feedback" rel="tag">feedback</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/14/small-specific-mongrel-web-servers">Small, specific mongrel web servers</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 14 Apr 2007 00:44:00">
                    Sat, 14 Apr 2007 00:44:00
                  </span>
                </p>

                <p>I&#8217;ve created a simple <a href="http://mongrel.rubyforge.org/">mongrel</a> server that allows you to upload text files for subsequent deletion and retrieval.  If it sounds pretty pointless, that&#8217;s because it is&#8230;currently.  I wonder though, if the basic premise couldn&#8217;t be used to create some text-transformation tools.  I&#8217;m thinking of really simple tools that might spell-check a text file, or convert text from <a href="http://www.textism.com/tools/textile/">textile</a> to html.  My end goal would be to have lots of super simple tools that I can chain together to use as a blogging platform, removing my current dependence on <a href="http://trac.typosphere.org/">typo</a>.</p>


	<p>I&#8217;ve made the <a href="http://chrisroos.googlecode.com/svn/trunk/text_file_server/server.rb">server</a> slightly more complex than it needs to be by imposing some artificial constraints (<a href="http://chrisroos.googlecode.com/svn/trunk/text_file_server/server-test.rb">examples</a>).  The basic premise is that you <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.5">post</a> a text file, between 1 and 5000 bytes in size, with a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.17">content-type</a> of <a href="http://www.iana.org/assignments/media-types/text/">plain/text</a>.  All being well, the server responds with <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.2">201 Created</a> and the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.30">location</a> of the new resource.  The resource is actually retrieved by <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.7">deleting</a> it &#8211; the contents of the file are returned in the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.3">body</a> with a &#8220;200 OK&#8221; response.  I&#8217;ve tried to use the relevant <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4"><span class="caps">HTTP</span> error</a> when resource creation fails.  The whole &#8216;post&#8217; and &#8216;delete&#8217; pattern for these transformations feels kinda <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">restful</a>, but I may be way off the mark.</p>


	<p>I&#8217;m wondering how much of <a href="http://pipes.yahoo.com/pipes/">yahoo pipes</a> could be replicated with lots of small, specific web servers.</p>


	<p>Anyone have any thoughts on any of this?</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/http" rel="tag">http</a>, 
                    
                      <a href="/articles/tag/mongrel" rel="tag">mongrel</a>, 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/restful" rel="tag">restful</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/servers" rel="tag">servers</a>, 
                    
                      <a href="/articles/tag/web" rel="tag">web</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/11/getting-to-grips-with-pwdhash">Getting to grips with pwdhash</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 11 Apr 2007 22:27:00">
                    Wed, 11 Apr 2007 22:27:00
                  </span>
                </p>

                <h3>Overview</h3>


	<p>Having used <a href="http://www.pwdhash.com">pwdhash</a> for a while, I decided it was about time I dived into the implementation to see what was actually going on.  I figured that the best way for me to get an understanding of the library was to translate it from <a href="http://en.wikipedia.org/wiki/Javascript">javascript</a> to <a href="http://www.ruby-lang.org">ruby</a>.</p>


	<h3>Investigating the javascript libraries</h3>


	<p>The first step was to create a basic environment within which I could explore the existing javascript functionality.  Relying on <a href="http://www.getfirebug.com/">Firebug</a> to provide a javascript console, this was as simple as creating a very basic html page.</p>


<div class="typocode"><pre><code class="typocode_default">&lt;html&gt;
  &lt;head&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;md5.js&quot; /&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;hashed-password.js&quot; /&gt;
    &lt;title&gt;pwdhash client&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre></div>

	<p>It actually took me a good few minutes to get up and running with this environment.  It seems that <a href="http://crypto.stanford.edu/PwdHash/RemotePwdHash/hashed-password.js">hashed-password.js</a> relies on a variable, <span class="caps">SPH</span>_kPasswordPrefix, being defined.  Although defined in <a href="http://crypto.stanford.edu/PwdHash/RemotePwdHash/pwdhash.js">pwdhash.js</a>, it turns out to be our only dependency on that file.  In wanting to keep the environment as simple as possible, I chose to copy the definition of that variable to hashed-password.js, allowing us to remain independent of pwdhash.js.</p>


	<h3>Starting to implement the javascript functions in ruby</h3>


	<p>Knowing that <a href="http://pajhome.org.uk/crypt/md5/md5src.html">md5.js</a> implemented pretty standard <a href="http://en.wikipedia.org/wiki/Md5">md5</a> (<a href="http://www.faqs.org/rfcs/rfc1321.html">rfc</a>) and <a href="http://en.wikipedia.org/wiki/Hmac">hmac</a> (<a href="http://www.faqs.org/rfcs/rfc2104.html">rfc</a>) routines, for which there are equivalents in ruby, I chose to concentrate on translating hashed-password.js.  Although the code is pretty simple, it took me a while to understand because of my limited javascript knowledge.  We essentially construct an object (SPH_HashedPassword), supplying it with password and realm (domain), that generates, and represents, the hashed password.</p>


	<p>The very first thing that a newly created <span class="caps">SPH</span>_HashedPassword does, is to use the b64_hmac_md5 function, supplied in the md5.js library, to generate the initial hash.  I really didn&#8217;t expect to be tripped up quite this early on, but I just couldn&#8217;t replicate the value obtained from b64_hmac_md5 (using <a href="http://ruby-doc.org/stdlib/libdoc/digest/rdoc/index.html">digest/md5</a> and <a href="http://deisui.org/~ueno/ruby/hmac.html">ruby-hmac</a>.)  I now realise that I didn&#8217;t fully understand what I was actually trying to replicate &#8211; I really should have paid more attention to those three little letters (b64 / <a href="http://www.faqs.org/rfcs/rfc3548.html">base64</a>) at the beginning of the function name&#8230;</p>


	<h3>Back to the drawing-board &#8211; starting to implement the md5.js library in ruby</h3>


	<p>Without thinking about it as much as I should have, I decided that maybe I needed to implement the functionality provided in md5.js in ruby (<a href="http://chrisroos.googlecode.com/svn/trunk/pwdhash-rb/md5-rb/md5.rb">code</a> for reference).  I dived in and started replicating one function at a time.  All was going OK until I came across the <a href="http://developer.mozilla.org/en/docs/Core_JavaScript_1.5_Guide:Operators:Bitwise_Operators#Bitwise_Shift_Operators">zero fill right shift</a> bitwise operator in javascript.  There is no standard equivalent in ruby, but a little help from the <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/144877">mailing list</a> allowed me to come up with this implementation.</p>


<div class="typocode"><pre><code class="typocode_default">class Integer
  def zero_fill_right_shift(count)
    (self &gt;&gt; count) &amp; ((2 ** (size_in_bits-count))-1) # defined in Integer, size_in_bits is self.size * 8
  end
end</code></pre></div>

	<p>Although this allowed me to move a little further, progress completely ground to a halt when trying to replicate the bit_rol function.  It seems that bitwise left-shifting by a negative number offers a different result in javascript and ruby.</p>


<div class="typocode"><pre><code class="typocode_default">javascript: 1 &lt;&lt; -1 = -2147483648
ruby: 1 &lt;&lt; -1 = 0</code></pre></div>

	<h3>Back to the drawing-board (again) &#8211; using digest/md5 and ruby-hmac to replicate the results given by md5.js</h3>


	<p>This time, I decided to break the b64_hmac_md5 function down into its component parts and see which, if any, differed between ruby and javascript.  The first step was to compare the hex output of a simple md5 of a string.</p>


<div class="typocode"><pre><code class="typocode_default">javascript: hex_md5(text) =&gt; &quot;1cb251ec0d568de6a929b520c4aed8d1&quot;
ruby: Digest::MD5.new(text).hexdigest =&gt; 1cb251ec0d568de6a929b520c4aed8d1</code></pre></div>

	<p>Next up was a comparison of an <span class="caps">HMAC MD5</span> of a key and some data.</p>


<div class="typocode"><pre><code class="typocode_default">javascript: hex_hmac_md5(key, data) =&gt; &quot;9d5c73ef85594d34ec4438b7c97e51d8&quot;
ruby: HMAC::MD5.hexdigest(key, data) =&gt; &quot;9d5c73ef85594d34ec4438b7c97e51d8&quot;</code></pre></div>

	<p>Although we can easily replicate the result of hex_hmac_md5 in ruby, we actually want to replicate the result of b64_hmac_md5 (i.e. the hashed data encoded in base64 representation.)
With a bit of thinking, and some trial and error, I realised that I needed to calculate the binary digest of the key and data, and then base64 encode the result.  <strong>Note</strong>.  My original problems arose when comparing the output of the binary string data, what with Javascript being able to display unicode characters and ruby just displaying their code points in octal representation.</p>


<div class="typocode"><pre><code class="typocode_default">javascript: b64_hmac_md5(key, data) =&gt; &quot;nVxz74VZTTTsRDi3yX5R2A&quot;
ruby: # This requires both ruby-hmac and base64
ruby: Base64.encode64(HMAC::MD5.digest(key, data)) =&gt; &quot;nVxz74VZTTTsRDi3yX5R2A==&quot;</code></pre></div>

	<p>This is the first time we see any difference in the values obtained from javascript and ruby.  It turns out that there&#8217;s a clue to this difference in the md5.js library:</p>


<div class="typocode"><pre><code class="typocode_default">var b64pad  = &quot;&quot;; /* base-64 pad character. &quot;=&quot; for strict RFC compliance   */</code></pre></div>

	<p>Ok, so it seems I should just be able to remove the pad characters (=) from my generated hash and I&#8217;ll achieve the same value.  Happy that this was a pretty easy difference to resolve, I could move forward with actually implementing the pwdhash magic in ruby&#8230;</p>


	<h3>Implementing the pwdhash magic in ruby</h3>


	<p>The pwdhash specific stuff is actually very simple.  It alters the initial base 64 encoded hash to ensure that we have:</p>


	<ul>
	<li>One upper case char</li>
		<li>One lower case char</li>
		<li>One non alpha-numeric char</li>
		<li>One number</li>
	</ul>


	<p>So, having got over the first hurdle, the remainder of the translation was pretty simple.  In fact, in its current <a href="http://chrisroos.googlecode.com/svn/trunk/pwdhash-rb/pwdhash.rb">incarnation</a> (revision 62), there are only a few small syntactical differences between the javascript and ruby versions.</p>


	<h3>Next steps</h3>


	<p>Rubify the code.  Although I&#8217;ve copied it almost directly from the javascript I think I&#8217;ve actually managed to make it slightly less readable.</p>


	<p>Investigate the whole world of <a href="http://www.unicode.org">unicode</a> a bit more &#8211; I definitely don&#8217;t know as much about it as I should.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/hashing" rel="tag">hashing</a>, 
                    
                      <a href="/articles/tag/hmac" rel="tag">hmac</a>, 
                    
                      <a href="/articles/tag/javascript" rel="tag">javascript</a>, 
                    
                      <a href="/articles/tag/md5" rel="tag">md5</a>, 
                    
                      <a href="/articles/tag/pwdhash" rel="tag">pwdhash</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/04/i-want-fast-trains">I want fast trains</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 04 Apr 2007 20:19:00">
                    Wed, 04 Apr 2007 20:19:00
                  </span>
                </p>

                <p><strong>Update Tue Apr 10th</strong> Maybe <a href="http://maps.google.com/help/maps/userguide/index.html">google</a> read my question.</p>


	<p>The <a href="http://news.bbc.co.uk/1/hi/world/europe/6521295.stm">news</a> of the very, very, very fast train in France made me wonder how one of my <a href="http://www.wayfaring.com/maps/show/35440">regular routes</a> compared.</p>


<iframe src="http://www.wayfaring.com/maps/export/35440" scrolling="no" frameborder="0" style="width:400px;height:250px;border:2px solid #cccccc;"></iframe>

	<p>At the time I travel, the journey takes 2 hours 10 minutes.  So, 130 minutes to travel 84 miles.  That&#8217;ll be about 38 miles an hour then.  Brilliant.</p>


	<p>Actually, does anyone know of any sites (like wayfaring) where I might plot some points on a map and get either a <a href="http://www.georss.org/">georss</a> or <a href="http://earth.google.com/kml/">kml</a> feed of the data?  I like <a href="http://www.wayfaring.com">wayfaring</a> an&#8217; all, but it&#8217;d be nice to be able to separate the route data from their site.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/commute" rel="tag">commute</a>, 
                    
                      <a href="/articles/tag/train" rel="tag">train</a>, 
                    
                      <a href="/articles/tag/travel" rel="tag">travel</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/03/obtaining-latitude-longitude-for-uk-postcodes">Obtaining latitude/longitude for UK postcodes</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 03 Apr 2007 21:33:00">
                    Tue, 03 Apr 2007 21:33:00
                  </span>
                </p>

                <p>It turns out that we can use <a href="http://streetmap.co.uk">streetmap.co.uk</a> to <a href="http://streetmap.co.uk/streetmap.dll?GridConvert">convert</a> a UK postcode to latitude/longitude.  It also turns out that a combination of <a href="http://curl.haxx.se/">curl</a>, <a href="http://www.ruby-lang.org">ruby</a> and <a href="http://code.whytheluckystiff.net/hpricot/">hpricot</a> make it very easy to bypass the streetmap site to perform the conversion.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">postcode</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">SW1A 2AJ</span><span class="punct">'</span>

<span class="ident">html</span> <span class="punct">=</span> `<span class="ident">curl</span> <span class="punct">&quot;</span><span class="string">http://streetmap.co.uk/streetmap.dll</span><span class="punct">&quot;</span> <span class="punct">-</span><span class="ident">d</span><span class="punct">&quot;</span><span class="string">MfcISAPICommand=GridConvert</span><span class="punct">&quot;</span> <span class="punct">-</span><span class="ident">d</span><span class="punct">&quot;</span><span class="string">name=<span class="expr">#{postcode}</span></span><span class="punct">&quot;</span> <span class="punct">-</span><span class="ident">d</span><span class="punct">&quot;</span><span class="string">type=PostCode</span><span class="punct">&quot;`</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">hpricot</span><span class="punct">'</span>

<span class="ident">doc</span> <span class="punct">=</span> <span class="constant">Hpricot</span><span class="punct">(</span><span class="ident">html</span><span class="punct">)</span>

<span class="ident">latitude</span><span class="punct">,</span> <span class="ident">longitude</span> <span class="punct">=</span> <span class="number">0</span><span class="punct">,</span> <span class="number">0</span>

<span class="punct">(</span><span class="ident">doc</span><span class="punct">/&quot;</span><span class="string">div</span><span class="punct">&quot;/&quot;</span><span class="string">center</span><span class="punct">&quot;/&quot;</span><span class="string">table</span><span class="punct">&quot;/&quot;</span><span class="string">tr</span><span class="punct">&quot;).</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">row</span><span class="punct">|</span>
  <span class="ident">attribute</span> <span class="punct">=</span> <span class="punct">(</span><span class="ident">row</span><span class="punct">/&quot;</span><span class="string">td</span><span class="punct">&quot;).</span><span class="ident">first</span><span class="punct">.</span><span class="ident">inner_text</span>
  <span class="ident">value</span> <span class="punct">=</span> <span class="punct">(</span><span class="ident">row</span><span class="punct">/&quot;</span><span class="string">td</span><span class="punct">&quot;).</span><span class="ident">last</span><span class="punct">.</span><span class="ident">inner_text</span>
  <span class="keyword">if</span> <span class="ident">attribute</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">lat</span><span class="punct">/</span><span class="ident">i</span>
    <span class="ident">latitude</span> <span class="punct">=</span> <span class="constant">Float</span><span class="punct">(</span><span class="ident">value</span><span class="punct">[/</span><span class="regex"><span class="escape">\(</span>(.*)<span class="escape">\)</span></span><span class="punct">/,</span> <span class="number">1</span><span class="punct">])</span>
  <span class="keyword">elsif</span> <span class="ident">attribute</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">long</span><span class="punct">/</span><span class="ident">i</span>
    <span class="ident">longitude</span> <span class="punct">=</span> <span class="constant">Float</span><span class="punct">(</span><span class="ident">value</span><span class="punct">[/</span><span class="regex"><span class="escape">\(</span>(.*)<span class="escape">\)</span></span><span class="punct">/,</span> <span class="number">1</span><span class="punct">])</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">p</span> <span class="punct">[</span><span class="ident">latitude</span><span class="punct">,</span> <span class="ident">longitude</span><span class="punct">]</span></code></pre></div>

	<p>Err, this is probably a bit naughty.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/naughty" rel="tag">naughty</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/streetmap" rel="tag">streetmap</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/01/converting-egg-credit-card-statements-to-ofx-for-upload-to-wesabe">Converting Egg Credit Card Statements to Ofx (for upload to wesabe)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 01 Apr 2007 13:48:00">
                    Sun, 01 Apr 2007 13:48:00
                  </span>
                </p>

                <p>I&#8217;ve cobbled together some pretty nasty code to convert an <a href="http://www.egg.com">Egg</a> Credit Card statement to <a href="http://www.ofx.net">Ofx</a>.</p>


	<p>Grab the <a href="http://chrisroos.googlecode.com/svn/trunk/egg-ofx/">source</a> from <a href="http://code.google.com">google code</a>.</p>


<div class="typocode"><pre><code class="typocode_default">svn checkout http://chrisroos.googlecode.com/svn/trunk/egg-ofx</code></pre></div>

	<p>As well as requiring <a href="http://code.whytheluckystiff.net/hpricot/">hpricot</a>, you will need to edit the StatementsFolder and OfxOutputFolder variables in egg.rb.  These need to point to a directory containing html statements, and an empty output directory respectively.</p>


	<p>I&#8217;ve used the script to upload my last 12 statements to <a href="http://www.wesabe.com">wesabe</a> and everything seems to work Ok. If you have any questions, just post a comment here.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/egg.com" rel="tag">egg.com</a>, 
                    
                      <a href="/articles/tag/finance" rel="tag">finance</a>, 
                    
                      <a href="/articles/tag/ofx" rel="tag">ofx</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/03/19/monkey-patching-rails-routing">Monkey patching rails routing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 19 Mar 2007 22:16:00">
                    Mon, 19 Mar 2007 22:16:00
                  </span>
                </p>

                <p>This <a href="http://chrisroos.googlecode.com/svn/trunk/plugins/routing_redirection/">plugin</a> offers the following two features.</p>


	<ol>
	<li>Permanently redirecting requests for urls that end in a slash to the equivalent url with no slash, helping disambiguate urls, as <a href="http://simonwillison.net/2007/Feb/4/urls/">explained</a> by <a href="http://simonwillison.net/">Simon Willison</a>.</li>
		<li>The addition of ActionController::Routing::RouteSet::Mapper#permanently_redirect, allowing us to declare permanent redirections within our <a href="http://api.rubyonrails.com/classes/ActionController/Routing.html">route config</a>.</li>
	</ol>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">ActionController</span><span class="punct">::</span><span class="constant">Routing</span><span class="symbol">:Routes</span><span class="punct">.</span><span class="ident">draw</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">map</span><span class="punct">|</span>
  <span class="ident">map</span><span class="punct">.</span><span class="ident">permanently_redirect</span> <span class="punct">'</span><span class="string">legacy/view/:id</span><span class="punct">',</span> <span class="symbol">:controller</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">current</span><span class="punct">',</span> <span class="symbol">:action</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">show</span><span class="punct">'</span>
<span class="keyword">end</span></code></pre></div>

	<p>A quick <a href="http://www.google.co.uk/search?hl=en&#38;q=rails+disambiguated+urls&#38;btnG=Search">google</a> reveals that <a href="http://fleetingideas.com/">Rob McKinnon</a> has an <a href="http://fleetingideas.com/2007/2/6/disambiguated-urls-with-ruby-on-rails">alternative suggestion</a> for removing the trailing slashes.</p>


	<p>The plugin is known to work with Rails 1.1.6.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/routing" rel="tag">routing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/03/18/repairing-an-hp-pavilion-n5241-laptop">Repairing an Hp Pavilion N5241 laptop</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 18 Mar 2007 20:22:00">
                    Sun, 18 Mar 2007 20:22:00
                  </span>
                </p>

                <p>A mate&#8217;s laptop was making very strange noises.  I wondered if dust could be causing the &#8216;interference&#8217; and so took the laptop apart to clean.  Although it didn&#8217;t look too dirty, it seems to have done the trick.  Photos of the re-assembly are on <a href="http://www.flickr.com/photos/chrisjroos/sets/72157600007191066/">flickr</a>.</p>

                
              
                <h2>
                  <a href="/articles/2007/03/16/orange-orange-orange">Orange, orange, orange</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 16 Mar 2007 19:58:00">
                    Fri, 16 Mar 2007 19:58:00
                  </span>
                </p>

                <p>Tuttety tut tut tut.  I unsubscribed from you guys, don&#8217;t you <a href="http://blog.seagul.co.uk/articles/2007/01/12/move-over-seetickets-com-youve-got-nothing-on-orange-co-uk">remember</a>?  Obviously not, as you&#8217;ve just emailed me again.  Oh well, might as well hit that unsubscribe link one more time&#8230;</p>


	<p><img src="http://farm1.static.flickr.com/157/423345893_fa4f1d707b_o.jpg" alt="" /></p>


	<p>Unless I&#8217;m very much mistaken, there have been about two months between the 12th January and now, one month more than the, err, very reasonable<sup><a href="#fn1">1</a></sup>, 28 days they say it should take.</p>


	<p id="fn1"><sup>1</sup> It&#8217;s not reasonable.  In fact, I may go as far as to say it&#8217;s unjustifiable.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                      <a href="/articles/tag/naughty" rel="tag">naughty</a>, 
                    
                      <a href="/articles/tag/orange" rel="tag">orange</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/03/12/frustrating-user-experience-with-hsbc-online-banking">Frustrating user experience with Hsbc online banking</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 12 Mar 2007 23:13:00">
                    Mon, 12 Mar 2007 23:13:00
                  </span>
                </p>

                <p>I needed to pay some money to <a href="http://www.hmrc.gov.uk"><span class="caps">HMRC</span></a> to cover my tax.  <span class="caps">HMRC</span> kindly supply me with their sort code and account number so that I could transfer the money directly from my bank account.  Logged into <a href="http://www.hsbc.co.uk">Hsbc</a>, I entered the relevant details and tried to make the payment.  Instead of going through like a good payment should, I was presented with this useless error message.</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/419309333/"><img src="http://farm1.static.flickr.com/130/419309333_f03474b3c8_m.jpg" alt="" /></a></p>


	<p>&#8220;We are unable to deal with your request. Please call us on 0845 600 2290 quoting reference 841, and we will be happy to help.  Select an option from the left-hand menu to continue.&#8221;</p>


	<p>I happen to know that, in English, this means, &#8220;You have tried to make a payment to a known bank account using the Friends and Family option.  You&#8217;re a dumbass.  It&#8217;s obvious that instead of blindly typing in the sort code and account number, you should select from this helpful list of accounts that we already know about.&#8221;</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/419309488/"><img src="http://farm1.static.flickr.com/176/419309488_df2ab0fb53_m.jpg" alt="" /></a></p>


	<p>Hmm, now if only I knew which of 12 cryptic names to choose I&#8217;d be away&#8230;  Anyway.  A short phone call later, filled with such insights as &#8220;lots of people seem to phone up about this&#8221;, and, &#8220;we can&#8217;t give out the list of names vs sort codes as it&#8217;s against data protection&#8221;, I was all set.  For anyone that cares, the sort code and account number I had (10-50-41 and 23456000) match to the incredibly obvious &#8216;HMRC <span class="caps">CORP TAX SHIP</span>&#8217;.  Actually, I&#8217;ve just come across a <a href="http://www.hmrc.gov.uk/howtopay/bank-account-checker.htm">page</a> detailing all the different <span class="caps">HMRC</span> accounts and what they&#8217;re for.  A quick scan suggests that you can probably derive the cryptic Hsbc name from the more human friendly name on that page.</p>


	<p>If anyone happens to come across this page while searching for the error above, maybe you could leave details in the comments of the sort code, account number and Hsbc cryptic name, in order to help out any future visitors.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                      <a href="/articles/tag/hsbc" rel="tag">hsbc</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/03/09/the-worst-word-in-the-world-ever">The worst word in the world... ever</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 09 Mar 2007 10:28:00">
                    Fri, 09 Mar 2007 10:28:00
                  </span>
                </p>

                <p>I don&#8217;t know why, but I really don&#8217;t like the word &#8216;texted&#8217;.  It hurts my ears when I hear it, and my eyes when I see it.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/made" rel="tag">made</a>, 
                    
                      <a href="/articles/tag/made-up-words" rel="tag">made-up-words</a>, 
                    
                      <a href="/articles/tag/neologism" rel="tag">neologism</a>, 
                    
                      <a href="/articles/tag/up" rel="tag">up</a>, 
                    
                      <a href="/articles/tag/words" rel="tag">words</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/03/05/itll-grow-back-right">It'll grow back, right?</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 05 Mar 2007 22:16:00">
                    Mon, 05 Mar 2007 22:16:00
                  </span>
                </p>

                <p>Hmm.  I need to remove this, very firmly attached, processor from the heatsink and fan assembly.</p>


	<p><img src="http://farm1.static.flickr.com/174/411792179_f302416633.jpg?v=0" alt="" /></p>


	<p>I&#8217;m sure if I just apply a little pressure<sup><a href="#fn2">2</a></sup>...</p>


	<p><img src="http://farm1.static.flickr.com/147/411792926_f61db3d103.jpg?v=0" alt="" /></p>


	<p>Bugger.</p>


	<p>In an effort to take something positive from the experience, I&#8217;ve created a <a href="http://flickr.com/photos/chrisjroos/sets/72157594571965120/">photoset</a> on <a href="http://www.flickr.com">flickr</a> that describes the re-assembly process of the Sony Vaio <span class="caps">K315B</span>.</p>


	<p id="fn1"><sup>1</sup>  More like a combination of pressure (on the processor, not me), lessening patience and a knife (resulting in two cut fingers.)  Ho hum.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/oops" rel="tag">oops</a>, 
                    
                      <a href="/articles/tag/sony" rel="tag">sony</a>, 
                    
                      <a href="/articles/tag/vaio" rel="tag">vaio</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/03/04/digital-photo-prints-from-photobox">Digital Photo Prints from PhotoBox</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 04 Mar 2007 08:13:00">
                    Sun, 04 Mar 2007 08:13:00
                  </span>
                </p>

                <p>I just wanted to write a short note to recommend <a href="http://www.photobox.co.uk">PhotoBox</a>.  I&#8217;ve been meaning to get some of my <a href="http://www.flickr.com/photos/chrisjroos">photos</a> printed for a while, but was put off by having to pay for a service that I knew nothing about.  A short while ago, a friend <a href="http://ademblog.blogspot.com/2007/02/is-that-where-it-ends-with-your-life.html">mentioned</a> photobox.  Not only do I trust Adem&#8217;s opinion, but photobox were (and still are, having just checked their homepage) offering 30 free prints when you sign-up.  I signed up at around midday on Friday (23rd Feb 2007), selected 30 photos that I&#8217;d like printed, and uploaded them to photobox.  I paid my £1.50 postage and duly received my confirmation email at 16:27 that day.  The best thing was that 56 minutes later (17:23) I received an email to say that the photos had been dispatched.  That&#8217;s pretty cool.  They were sent First Class with <a href="http://www.royalmail.co.uk">Royal Mail</a> and I received them the next morning.</p>


	<p>I know that Adem has already used their service again, and I can only imagine that I will too.  Would I have used them without Adem&#8217;s advocacy?  Probably if they had the free offer (I&#8217;d have nothing to lose after all), almost certainly not if they didn&#8217;t.</p>


	<p>After all that praise, I&#8217;d like to suggest a couple of improvements.</p>


	<ol>
	<li>I already have all of my photos on <a href="http://www.flickr.com">flickr</a>.  I should have been able to supply photobox with the location of these photos rather than having to painstakingly download and re-upload.</li>
		<li>I found the interface a little clumsy.  At the checkout, it looked like some of my photos were going to be cropped, even though I didn&#8217;t ask for it, or see why they would be (they were &#8216;photo-size&#8217; already.)  This resulted in a bit of back and forth, on my part, through the interface, to ensure I hadn&#8217;t selected some option by mistake (I hadn&#8217;t and my photos weren&#8217;t cropped.)  I feel that it could be made easier for the &#8216;just upload and print&#8217; crowd.</li>
	</ol>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/flickr" rel="tag">flickr</a>, 
                    
                      <a href="/articles/tag/photo" rel="tag">photo</a>, 
                    
                      <a href="/articles/tag/photobox" rel="tag">photobox</a>, 
                    
                      <a href="/articles/tag/printing" rel="tag">printing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/02/15/crashing-ie-6-with-style-sheets">Crashing IE 6 with style(sheets)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 15 Feb 2007 22:49:00">
                    Thu, 15 Feb 2007 22:49:00
                  </span>
                </p>

                <p>Over about the last day and a half, if you used <a href="http://en.wikipedia.org/wiki/Internet_Explorer_6">Internet Explorer 6</a> to browse any of the reviews on <a href="http://www.reevoo.com">reevoo.com</a>, then we should apologise.  It seems that, apart from breaking the layout somewhat, we&#8217;d actually managed to cause <span class="caps">IE 6</span> to crash.  Not cool.  A concerted effort this morning got the problem sorted, but it took longer than it should&#8217;ve done, especially when you consider that about 75% of our traffic is from users of <span class="caps">IE 6</span>&#8230;</p>


	<p>Anyway, with the embarrassment out of the way, I thought I&#8217;d share the remotely interesting<sup><a href="#fn1">1</a></sup> findings of the investigation into the browser crash.  It turns out that a combination of these three little lines of <a href="http://en.wikipedia.org/wiki/CSS">css</a>, and any <a href="http://en.wikipedia.org/wiki/Doctype">doctype</a> declaration<sup><a href="#fn2">2</a></sup>, will cause <span class="caps">IE 6</span> to hang while waiting for the magic <a href="http://en.wikipedia.org/wiki/Control-Alt-Delete#Windows_NT">Windows kiss of life</a>.</p>


<div class="typocode"><pre><code class="typocode_default">margin-left: 240px;
margin-right: 10%;
width: expression(document.body.offsetWidth - 256);</code></pre></div>

	<p>It is not the specific values (240px, 10% and 256) in the lines above that are of interest &#8211; I was able to express and suppress the problem by altering those.  Unfortunately, I didn&#8217;t spend any time trying to find the threshold of the problem, and am therefore unsure as to the reason for this behaviour.</p>


	<p>The offending, nasty, IE hack has now been removed.  In addition, the day has been spent working with the <a href="http://daftpixel.wordpress.com">designer monkey</a> (ahh, you can call him Adam if you like) to start tidying up the, still somewhat cumbersome, stylesheets.</p>


	<p>For the curious, the simplest html page I could come up with that exhibits the crash behaviour in <span class="caps">IE 6</span> is below.</p>


<div class="typocode"><pre><code class="typocode_default">&lt;!-- &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt; --&gt;
&lt;!-- &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt; --&gt;
&lt;!-- &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt; --&gt;
&lt;!-- &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt; --&gt;
&lt;!-- ANY OF THE ABOVE DOCTYPES CAUSE THE PROBLEM.  NO DOCTYPE = NO PROBLEM --&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;style type=&quot;text/css&quot;&gt;
      #content {
        margin-left: 240px;
        margin-right: 10%;
        width: expression(document.body.offsetWidth - 256);
      }
    &lt;/style&gt;
    &lt;title&gt;testing ie6&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;content&quot;&gt;blurgh&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre></div>

	<p>[1] They&#8217;re really not interesting.</p>


	<p>[2] If there is no doctype declaration, the browser doesn&#8217;t crash (something to do with standards mode I believe).</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ie" rel="tag">ie</a>, 
                    
                      <a href="/articles/tag/internetexplorer" rel="tag">internetexplorer</a>, 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/01/29/visualising-the-changing-responsibilities-of-objects">Visualising the changing responsibilities of objects</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 29 Jan 2007 21:17:00">
                    Mon, 29 Jan 2007 21:17:00
                  </span>
                </p>

                <p>By parsing the output of svn diff, we can concisely display the responsibilities that have been added/removed to various objects.  It is based on the assumption that our tests capture these changes.</p>


	<p>Taking a very simple (and partially made up) diff:</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Index</span><span class="punct">:</span> <span class="ident">test</span><span class="punct">/</span><span class="ident">amount_test</span><span class="punct">.</span><span class="ident">rb</span>
<span class="punct">===================================================================</span>
<span class="punct">---</span> <span class="ident">test</span><span class="punct">/</span><span class="ident">amount_test</span><span class="punct">.</span><span class="ident">rb</span> <span class="punct">(</span><span class="ident">revision</span> <span class="number">2</span><span class="punct">)</span>
<span class="punct">+++</span> <span class="ident">test</span><span class="punct">/</span><span class="ident">amount_test</span><span class="punct">.</span><span class="ident">rb</span> <span class="punct">(</span><span class="ident">working</span> <span class="ident">copy</span><span class="punct">)</span>
<span class="attribute">@@</span> <span class="punct">-</span><span class="number">2</span><span class="punct">,</span><span class="number">9</span> <span class="punct">+</span><span class="number">2</span><span class="punct">,</span><span class="number">8</span> <span class="attribute">@@</span>

 <span class="keyword">class </span><span class="class">AmountTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>

<span class="punct">-</span>  <span class="keyword">def </span><span class="method">test_should_format_amount</span>
<span class="punct">-</span>    <span class="ident">formatted_amount</span> <span class="punct">=</span> <span class="constant">Amount</span><span class="punct">.</span><span class="ident">format</span><span class="punct">(</span><span class="number">5</span><span class="punct">,</span> <span class="punct">'</span><span class="string">$</span><span class="punct">')</span>
<span class="punct">-</span>    <span class="ident">assert_equal</span> <span class="punct">'</span><span class="string">$5.00</span><span class="punct">',</span> <span class="ident">formatted_amount</span>
<span class="punct">+</span>  <span class="keyword">def </span><span class="method">test_should_flunk</span>
<span class="punct">+</span>    <span class="ident">flunk</span>
   <span class="keyword">end</span></code></pre></div>

	<p>And piping it through the diff_parser, we get:</p>


<div class="typocode"><pre><code class="typocode_default">--- Amount
+ should flunk
- should format amount</code></pre></div>

	<p>The output is in a diff-like format so that we can pipe it straight into <a href="http://www.macromates.com">TextMate</a> and benefit from the colour formatting therein.</p>


	<h3>diff_parser.rb</h3>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment">#!/usr/bin/env ruby</span>

<span class="keyword">class </span><span class="class">Test</span>
  <span class="keyword">def </span><span class="method">initialize</span>
    <span class="attribute">@added</span><span class="punct">,</span> <span class="attribute">@removed</span> <span class="punct">=</span> <span class="punct">[],</span> <span class="punct">[]</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">add_responsibility</span><span class="punct">(</span><span class="ident">responsibility</span><span class="punct">)</span>
    <span class="attribute">@added</span> <span class="punct">&lt;&lt;</span> <span class="ident">responsibility</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">remove_responsibility</span><span class="punct">(</span><span class="ident">responsibility</span><span class="punct">)</span>
    <span class="attribute">@removed</span> <span class="punct">&lt;&lt;</span> <span class="ident">responsibility</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">added_responsibilities</span>
    <span class="punct">(</span><span class="attribute">@added</span> <span class="punct">-</span> <span class="attribute">@removed</span><span class="punct">).</span><span class="ident">sort</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">removed_responsibilities</span>
    <span class="punct">(</span><span class="attribute">@removed</span> <span class="punct">-</span> <span class="attribute">@added</span><span class="punct">).</span><span class="ident">sort</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">added_responsibilities?</span>
    <span class="punct">!</span><span class="ident">added_responsibilities</span><span class="punct">.</span><span class="ident">empty?</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">removed_responsibilities?</span>
    <span class="punct">!</span><span class="ident">removed_responsibilities</span><span class="punct">.</span><span class="ident">empty?</span>
  <span class="keyword">end</span>
  <span class="keyword">def </span><span class="method">changed_responsibilities?</span>
    <span class="ident">added_responsibilities?</span> <span class="punct">||</span> <span class="ident">removed_responsibilities?</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">tests</span> <span class="punct">=</span> <span class="punct">{}</span>
<span class="ident">class_under_test</span> <span class="punct">=</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span>

<span class="keyword">while</span> <span class="ident">line</span> <span class="punct">=</span> <span class="ident">gets</span>
  <span class="keyword">if</span> <span class="ident">line</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">Index: (.*)</span><span class="punct">/</span>
    <span class="keyword">if</span> <span class="punct">(</span><span class="ident">test_name</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">basename</span><span class="punct">(</span><span class="global">$1</span><span class="punct">,</span> <span class="punct">'</span><span class="string">.rb</span><span class="punct">'))</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">_test$</span><span class="punct">/</span>
      <span class="ident">name_of_class_under_test</span> <span class="punct">=</span> <span class="ident">test_name</span><span class="punct">.</span><span class="ident">sub</span><span class="punct">(/</span><span class="regex">_test</span><span class="punct">/,</span> <span class="punct">'</span><span class="string"></span><span class="punct">')</span>
      <span class="ident">class_under_test</span> <span class="punct">=</span> <span class="ident">name_of_class_under_test</span><span class="punct">.</span><span class="ident">capitalize</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(/</span><span class="regex">_(<span class="escape">\w</span>)</span><span class="punct">/)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">m</span><span class="punct">|</span> <span class="global">$1</span><span class="punct">.</span><span class="ident">capitalize</span> <span class="punct">}</span>
      <span class="ident">tests</span><span class="punct">[</span><span class="ident">class_under_test</span><span class="punct">]</span> <span class="punct">=</span> <span class="constant">Test</span><span class="punct">.</span><span class="ident">new</span>
    <span class="keyword">end</span>
  <span class="keyword">else</span>
    <span class="keyword">if</span> <span class="ident">line</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">-<span class="escape">\s</span>*def test_(.*)</span><span class="punct">/</span>
      <span class="ident">responsibility</span> <span class="punct">=</span> <span class="global">$1</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(/</span><span class="regex">_</span><span class="punct">/,</span> <span class="punct">'</span><span class="string"> </span><span class="punct">')</span>
      <span class="ident">tests</span><span class="punct">[</span><span class="ident">class_under_test</span><span class="punct">].</span><span class="ident">remove_responsibility</span><span class="punct">(</span><span class="ident">responsibility</span><span class="punct">)</span>
    <span class="keyword">elsif</span> <span class="ident">line</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex"><span class="escape">\+\s</span>*def test_(.*)</span><span class="punct">/</span>
      <span class="ident">responsibility</span> <span class="punct">=</span> <span class="global">$1</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(/</span><span class="regex">_</span><span class="punct">/,</span> <span class="punct">'</span><span class="string"> </span><span class="punct">')</span>
      <span class="ident">tests</span><span class="punct">[</span><span class="ident">class_under_test</span><span class="punct">].</span><span class="ident">add_responsibility</span><span class="punct">(</span><span class="ident">responsibility</span><span class="punct">)</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">tests</span><span class="punct">.</span><span class="ident">sort</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">test_name</span><span class="punct">,</span> <span class="ident">test</span><span class="punct">|</span>
  <span class="keyword">if</span> <span class="ident">test</span><span class="punct">.</span><span class="ident">changed_responsibilities?</span>
    <span class="ident">puts</span> <span class="punct">'</span><span class="string">--- </span><span class="punct">'</span> <span class="punct">+</span> <span class="ident">test_name</span>
    <span class="ident">test</span><span class="punct">.</span><span class="ident">added_responsibilities</span><span class="punct">.</span><span class="ident">each</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">responsibility</span><span class="punct">|</span> <span class="ident">puts</span> <span class="punct">'</span><span class="string">+ </span><span class="punct">'</span> <span class="punct">+</span> <span class="ident">responsibility</span> <span class="punct">}</span> <span class="keyword">if</span> <span class="ident">test</span><span class="punct">.</span><span class="ident">added_responsibilities?</span>
    <span class="ident">test</span><span class="punct">.</span><span class="ident">removed_responsibilities</span><span class="punct">.</span><span class="ident">each</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">responsibility</span><span class="punct">|</span> <span class="ident">puts</span> <span class="punct">'</span><span class="string">- </span><span class="punct">'</span> <span class="punct">+</span> <span class="ident">responsibility</span> <span class="punct">}</span> <span class="keyword">if</span> <span class="ident">test</span><span class="punct">.</span><span class="ident">removed_responsibilities?</span>
    <span class="ident">puts</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/diff" rel="tag">diff</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/01/12/combining-distributed-small-tools-as-an-alternative-to-backpack-et-al">Combining distributed small tools as an alternative to Backpack et al</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 12 Jan 2007 11:53:00">
                    Fri, 12 Jan 2007 11:53:00
                  </span>
                </p>

                <p>For a while now, I&#8217;ve been thinking/dreaming of having a number of very specific, distributed services.  These would be no more than additions to the single purpose services we already use (notably, in my case, <a href="http://flickr.com">flickr</a> for photos, this blog for articulating thought and <a href="http://del.icio.us">del.icio.us</a> for storing bookmarks).  Some additions I&#8217;d like to see<sup><a href="#fn1">1</a></sup> are:</p>


	<ul>
	<li>A way to record and tag financial transactions

	<p>Although I want to be able to record the transactions in some kind of accounting app, I also want each transaction to be a resource on the web that I can link to and bookmark (a RESTful accounts app if you like)</p></li>
	</ul>


	<ul>
	<li>A way to record and tag any text (i.e. thoughts and ideas that are not quite blog posts)

	<p>To be fair, a secondary blog could be set-up to do this.</p></li>
	</ul>


	<ul>
	<li>A way to add multiple comments to any resource on the web

	<p>Think &#8211; being able to bookmark the same uri multiple times in del.icio.us with different notes against each bookmark.  Actually, I wonder why these sort of distributed comment systems are not more prevalent &#8211; it seems kinda odd that every blogging engine re-implements something that could be done once, and done well.</p></li>
	</ul>


	<ul>
	<li>A way to expose an email or an email conversation at a given uri (a permailink maybe? he he)

	<p>I think one immediate benefit of this is the ability to share emails with people in the same organisation/group as you without having to forward them all on.</p></li>
	</ul>


	<p>So, how would having these types of services help us re-create a backpack type page at present?</p>


	<p>Well, I&#8217;m not sure how good this example is, but let&#8217;s think of selling an item on <a href="http://www.ebay.co.uk">ebay</a>.  At the moment, I end up with lots of distributed information about a single sale:</p>


	<ul>
	<li>invoices from ebay</li>
		<li>transactions on a statement (from my bank and paypal)</li>
		<li>emails from ebay and buyers</li>
		<li>a page that represents the item on ebay</li>
		<li>pictures of the item on flickr</li>
		<li>physical receipts for posting the item</li>
	</ul>


	<p>This is fine until you want to interrogate the data.  Try finding out how much money you made/lost, when it was sent, who it was sent to, and the problems are obvious.</p>


	<p>One solution would be to record all the information for a given item in a page in backpack (or any similar service &#8211; a simple wiki would do).  But now try to query the data for two items sold, or partially query one item and the problems become evident again.</p>


	<p>I think this is where our funky new distributed system can help.  Following the same ebay selling process as above:</p>


	<ul>
	<li>We create a text snippet that provides us with a placeholder uri for this item.  This would be something like &#8216;sale of computer&#8217;</li>
		<li>We upload photos of the item to flickr, tagged with our placeholder</li>
		<li>We list the item in ebay, tagged with our placeholder</li>
		<li>We record a financial transaction that represents the cost of listing the item, tagged with our placeholder</li>
		<li>We upload any relevant emails from ebay about the listing/sale of our item, tagged with our placeholder</li>
		<li>We record a financial transaction that represents our income from the sale of the item, tagged with our placeholder</li>
		<li>We record a note that states when and how we sent the item, tagged with our placeholder</li>
		<li>We record a financial transaction that represents our cost for sending the item, tagged with our placeholder</li>
	</ul>


	<p>The important thing is that all of these resources are tagged with a common uri.  The uri that represents our item for sale.  At the simplest level, this makes auto-generating a backpack type page very simple &#8211; we just aggregate<sup><a href="#fn2">2</a></sup> all of the data tagged with our item uri.  Tagging these items with a higher level tag, such as &#8216;ebay&#8217;, will allow us to search across multiple sales/purchase.</p>


	<p>Going even further, using opensearch with a simple custom front-end (basically just a parser) gives us even greater querying capabilities.  I could imagine searching for something like &#8220;ebay finance:expenditure&#8221; to get a list of all items (descriptions, notes, pictures etc) we&#8217;ve sold on ebay along with our expenditure.  Our simple search engine would know to search for all items tagged with ebay, but only those transactions that are tagged with expenditure (i.e. costs to us).</p>


	<p>Does this make sense/sound feasible to anyone else?  Indeed, has someone else already presented these ideas in a more legible/understandable way?  It all seems to make great sense to me but I&#8217;ve spent quite a while thinking about it (and what seems like ages just writing this post), meaning there&#8217;s every chance I&#8217;ve missed something obvious.  I&#8217;d appreciate any thoughts.</p>


	<p id="fn1"><sup>1</sup> I did had every intention of developing these things as a proof of concept, but, on the basis that I&#8217;m unlikely to get around to it, and that I do actually think something like this is a good idea, I thought I&#8217;d jot my thoughts here.</p>


	<p id="fn2"><sup>2</sup> I started out thinking that the tags would be stored against the resource itself &#8211; the same way that the tag for a photo in flickr is stored against that photo.  I was also assuming that these services would be <a href="http://opensearch.org">opensearch</a> enabled to allow searching of the tags.  As I&#8217;ve been writing the post I&#8217;ve realised that, providing everything has a uri, we can use del.icio.us as our tagging mechanism and as our search engine.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/distributed" rel="tag">distributed</a>, 
                    
                      <a href="/articles/tag/opensearch" rel="tag">opensearch</a>, 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/software" rel="tag">software</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/01/12/encapsulation-in-active-record-objects">Encapsulation in Active Record objects</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 12 Jan 2007 01:37:00">
                    Fri, 12 Jan 2007 01:37:00
                  </span>
                </p>

                <p>I&#8217;ve been meaning to finish a post on this subject for ages.  As I probably won&#8217;t finish it in its current incarnation, I thought I&#8217;d at least get something up here.</p>


	<p><a href="http://www.rubyonrails.org/api/classes/ActiveRecord/Base.html">Active Record</a> <a href="http://www.rubyonrails.org/api/classes/ActiveRecord/Associations/ClassMethods.html">associations</a> are brilliant for quickly putting together an object graph.  They&#8217;re not so brilliant for testing, or keeping the code particularly tidy.  They quickly lead to (and even encourage) train-wreck expressions in your code.  Diving straight into an example:</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">Person</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
  <span class="ident">has_many</span> <span class="symbol">:hobbies</span>
<span class="keyword">end</span>
<span class="keyword">class </span><span class="class">Hobby</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
  <span class="ident">belongs_to</span> <span class="symbol">:person</span>
<span class="keyword">end</span></code></pre></div>

	<p>Because the hobbies object is publicly accessible from a person object, it allows us to reach in and touch things we shouldn&#8217;t.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">cycling</span> <span class="punct">=</span> <span class="constant">Hobby</span><span class="punct">.</span><span class="ident">new</span>

<span class="comment"># We shouldn't manipulate the hobbies object directly...</span>
<span class="ident">chris</span> <span class="punct">=</span> <span class="constant">Person</span><span class="punct">.</span><span class="ident">new</span>
<span class="ident">chris</span><span class="punct">.</span><span class="ident">hobbies</span><span class="punct">.</span><span class="ident">add</span><span class="punct">(</span><span class="ident">cycling</span><span class="punct">)</span> <span class="comment"># Uh oh - touching things we shouldn't</span>

<span class="comment"># ...rather, it'd be better to add a wrapper method for the functionality we actually need</span>
<span class="keyword">class </span><span class="class">Person</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
  <span class="keyword">def </span><span class="method">add_hobby</span><span class="punct">(</span><span class="ident">hobby</span><span class="punct">)</span>
    <span class="ident">hobbies</span><span class="punct">.</span><span class="ident">add</span><span class="punct">(</span><span class="ident">hobby</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="ident">chris</span> <span class="punct">=</span> <span class="constant">Person</span><span class="punct">.</span><span class="ident">new</span>
<span class="ident">chris</span><span class="punct">.</span><span class="ident">add_hobby</span><span class="punct">(</span><span class="ident">cycling</span><span class="punct">)</span> <span class="comment"># Ahh, that's much better</span></code></pre></div>

	<p>The revised Person class above follows the <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">law of demeter</a>.  As well as making the code look a little neater (no train-wrecks to see here), it makes it easier to test.  To illustrate the testing point, I&#8217;m going to <a href="http://weblog.jamisbuck.org/2007/1/9/extending-activerecord-associations">extend</a> the <a href="http://ryandaigle.com/articles/2006/12/03/extend-your-activerecord-association-methods">association</a> in this example.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment"># We end up with a large and not very clear test</span>
<span class="keyword">class </span><span class="class">Person</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
  <span class="ident">has_many</span> <span class="symbol">:hobbies</span> <span class="keyword">do</span>
    <span class="keyword">def </span><span class="method">find_favourite</span>
      <span class="ident">find</span><span class="punct">(</span><span class="symbol">:first</span><span class="punct">,</span> <span class="symbol">:conditions</span> <span class="punct">=&gt;</span> <span class="punct">['</span><span class="string">favourite = true</span><span class="punct">'])</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">MyContrivedTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">test_should_find_my_favourite_hobby</span>
    <span class="ident">hobbies</span> <span class="punct">=</span> <span class="ident">mock</span>
    <span class="ident">hobbies</span><span class="punct">.</span><span class="ident">expects</span><span class="punct">(</span><span class="symbol">:find_favourite</span><span class="punct">)</span>
    <span class="ident">person</span> <span class="punct">=</span> <span class="ident">stub</span><span class="punct">(</span><span class="symbol">:hobbies</span> <span class="punct">=&gt;</span> <span class="ident">hobbies</span><span class="punct">)</span>
    <span class="ident">hobby_finder</span> <span class="punct">=</span> <span class="constant">HobbyFinder</span><span class="punct">.</span><span class="ident">new</span>
    <span class="ident">hobby_finder</span><span class="punct">.</span><span class="ident">find_favourite</span><span class="punct">(</span><span class="ident">person</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment"># This way, we end up with a slightly cleaner looking class (imo) and a smaller, cleaner test</span>
<span class="keyword">class </span><span class="class">Person</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
  <span class="ident">has_many</span> <span class="symbol">:hobbies</span>
  <span class="keyword">def </span><span class="method">find_my_favourite_hobby</span>
    <span class="ident">hobbies</span><span class="punct">.</span><span class="ident">find</span><span class="punct">(</span><span class="symbol">:first</span><span class="punct">,</span> <span class="symbol">:conditions</span> <span class="punct">=&gt;</span> <span class="punct">['</span><span class="string">favourite = true</span><span class="punct">'])</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">MyContrivedTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">test_should_find_my_favourite_hobby</span>
    <span class="ident">person</span> <span class="punct">=</span> <span class="ident">mock</span>
    <span class="ident">person</span><span class="punct">.</span><span class="ident">expects</span><span class="punct">(</span><span class="symbol">:find_my_favourite_hobby</span><span class="punct">)</span>
    <span class="ident">hobby_finder</span> <span class="punct">=</span> <span class="constant">HobbyFinder</span><span class="punct">.</span><span class="ident">new</span>
    <span class="ident">hobby_finder</span><span class="punct">.</span><span class="ident">find_favourite</span><span class="punct">(</span><span class="ident">person</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>Interestingly enough, if we had <a href="http://en.wikipedia.org/wiki/Test_driven_development">test driven</a> the development of the above code, we would almost certainly have ended up with something similar (interface-wise) to the example that has a wrapper around the association proxy.</p>


	<p>So, with all of this in mind, I&#8217;ve hacked together a real quick <a href="http://chrisroos.googlecode.com/svn/trunk/plugins/private_associations/">plugin</a> that adds a corresponding _private method for each of the four (has_one, has_many, belongs_to and has_and_belongs_to_many) associations.  Using the _private alternative will do exactly the same as the original method but it will make all of the dynamically created methods private.  So.  It&#8217;ll still be possible to write the wrapper around the association (as we did in the test above) but it won&#8217;t be possible to reach in and touch things that we shouldn&#8217;t.[1]</p>


	<p>There is at least one problem (there may be many more I&#8217;m not aware of) with using the _private association methods.  If you have validation set-up for one of the associations (e.g. validates_associated) it will fail.  This is because validation happens from outside the instance of the object and therefore needs to access the association.  Although I haven&#8217;t thought this through fully, I&#8217;m actually wondering if validation (in its current form) takes a bit of a back seat under this new world order.  I think that one of the reasons validation is on the object itself is because there are many many ways to create the said object.  However, using these private associations and disabling the persistence methods (create, save, update etc) on an associated object may allow us to have a single point of object creation and persistence.  If we had that, then we wouldn&#8217;t need the Active Record validations anyway.  Just a thought&#8230;</p>


	<p>Just one final note.  <a href="http://www.daveastels.com/">Dave Astels</a> has a good <a href="http://blog.daveastels.com/articles/2006/10/24/encapsulation-in-action">article</a> about encapsulation in rails, as <a href="http://www.reevoo.com/blogs/bengriffiths/2006/10/24/rails-like-or-oo/">referred to</a> by <a href="http://www.reevoo.com/blogs/bengriffiths">Ben</a></p>


	<p id="fn1"><sup>1</sup>  Ok.  That is, of course, a blatant lie &#8211; we can still access the private association &#8211; this is <a href="http://www.ruby-lang.org">ruby</a> remember.  The important point is that we&#8217;ve made our intentions more explicit.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/encapsulation" rel="tag">encapsulation</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/01/12/move-over-seetickets-com-youve-got-nothing-on-orange-co-uk">Move over seetickets.com - you've got nothing on orange.co.uk</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 12 Jan 2007 00:03:00">
                    Fri, 12 Jan 2007 00:03:00
                  </span>
                </p>

                <p><img src="http://farm1.static.flickr.com/160/353838276_1b4a5b6ecf_o.jpg" alt="" /></p>


	<p><strong>&#8220;The unsubscribe process may take up to 28 working days&#8221;</strong></p>


	<p>Hmmm.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                      <a href="/articles/tag/email" rel="tag">email</a>, 
                    
                      <a href="/articles/tag/naughty" rel="tag">naughty</a>, 
                    
                      <a href="/articles/tag/unsubscribe" rel="tag">unsubscribe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/01/05/bad-seetickets-com">Bad seetickets.com</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 05 Jan 2007 17:54:00">
                    Fri, 05 Jan 2007 17:54:00
                  </span>
                </p>

                <p>Ah, a seetickets.com email has fallen into my spam bucket.  I don&#8217;t really read them anyway, I might as well unsubscribe.  Not so fast though it seems&#8230;</p>


	<p>First of all, what&#8217;s the deal with the email confirmation box?</p>


	<p><img src="http://farm1.static.flickr.com/151/346810590_00bbd1598c_o.jpg" alt="" /></p>


	<p>Oh well, might as well fill it in and submit.  But wait.  What&#8217;s this?</p>


	<p><img src="http://farm1.static.flickr.com/126/346810700_29ff72c5a4_o.jpg" alt="" /></p>


	<p>Wow, an email server that takes upto 60 seconds to:</p>


<div class="typocode"><pre><code class="typocode_default">DELETE FROM newsletters WHERE email = 'MY_EMAIL';</code></pre></div>

	<p>Oh well, I best click OK and wait.  Oh.</p>


	<p><img src="http://farm1.static.flickr.com/149/346810630_2311d30035_o.jpg" alt="" /></p>


	<p>Naughty naughty seetickets.com</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                      <a href="/articles/tag/naughty" rel="tag">naughty</a>, 
                    
                      <a href="/articles/tag/seetickets" rel="tag">seetickets</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/01/04/homegrown-gooogie">Homegrown gooogie</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 04 Jan 2007 14:37:00">
                    Thu, 04 Jan 2007 14:37:00
                  </span>
                </p>

                <p>So, I just saw a <a href="http://blog.outer-court.com/archive/2007-01-04.html#n31">post</a> about <a href="http://www.gooogie.co.uk">gooogie</a>, and it reminded me of my <a href="http://blog.seagul.co.uk/articles/2006/12/15/might-as-well-aim-high">own</a>, &#8216;did you mean&#8217;, page<sup><a href="#fn1">1</a></sup>.</p>


	<p>You can achieve the same effect as gooogie by using the excellent <a href="https://addons.mozilla.org/firefox/1843/">firebug</a> firefox extension to execute javascript in the context of the page you are viewing.</p>


	<p>To achieve the effect:</p>


	<ul>
	<li>Open up <a href="http://www.google.co.uk">google</a></li>
	</ul>


	<ul>
	<li>Type something into the search box that will generate a &#8216;did you mean&#8217; response (tip. use any <a href="http://www.google.co.uk/search?hl=en&#38;q=mispeled&#38;btnG=Google+Search">misspelled</a> word)</li>
	</ul>


	<ul>
	<li>Use the handy <a href="https://addons.mozilla.org/firefox/1192/">XPather</a> firefox extension to find the XPath expression of the suggested word (in italics).  At this time, the relevant xpath seems to be &#8217;/html/body/p<sup><a href="#fn1">1</a></sup>/a/b/i&#8217;</li>
	</ul>


	<ul>
	<li>Fire up firebug and execute the following line in the console, substituting your desired suggestion first (the text on the page should change immediately)</li>
	</ul>


<div class="typocode"><pre><code class="typocode_default">document.evaluate('/html/body/p[1]/a/b/i', document, null, XPathResult.ANY_TYPE, null).iterateNext().textContent = 'THE_WORD_YOU_WANT_TO_SUGGEST'</code></pre></div>

	<ul>
	<li>Finish by typing a new word into the search box and taking a screenshot to impress your friends (or not, as the case may be).</li>
	</ul>


	<p>On second thoughts, just use gooogie, it&#8217;s much quicker and cross-browser compatible.</p>


	<p id="fn1"><sup>1</sup> A handful of people have stated that they don&#8217;t get the &#8216;did you mean reevoo&#8217; message when typing &#8216;review&#8217; into google.  Well, no, they wouldn&#8217;t.  It&#8217;s completely made up.  He he.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                      <a href="/articles/tag/gooogie" rel="tag">gooogie</a>, 
                    
                      <a href="/articles/tag/hack" rel="tag">hack</a>, 
                    
                  </p>
                
              

            </div>
          </div>
        </div>
        <div class="yui-b">
          <ul class="navigation">
            <li>
              <a href="/contents">contents</a>
            </li>
            <li>
              <a href="http://twitter.com/chrisroos">twitter</a>
            </li>
            <li>
              <a href="http://flickr.com/photos/chrisjroos">flickr</a>
            </li>
            <li>
              <a href="http://del.icio.us/chrisjroos">del.icio.us</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
  
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-160238-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>
  </body>

</html>