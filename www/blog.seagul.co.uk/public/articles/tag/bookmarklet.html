<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

  <head>
    <!--#include virtual="/includes/_head.html"-->
    <title>Posts tagged bookmarklet - deferred until inspiration hits</title>
    <meta name="robots" content="noindex" />
  </head>
  
  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <!--#include virtual="/includes/_header.html"-->
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">

              
                <h2>
                  <a href="/articles/2007/12/14/cross-browser-well-ie-6-firefox-2-and-safari-3-bookmarklet-script">Cross browser (well, IE 6, Firefox 2 and Safari 3) bookmarklet script</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 14 Dec 2007 21:27:00">
                    Fri, 14 Dec 2007 21:27:00
                  </span>
                </p>

                <p>I <a href="http://blog.seagul.co.uk/articles/2007/12/14/bookmarklet-favelet-limits-in-internet-explorer-6-and-7">mentioned</a> that I&#8217;d been playing with bookmarklets in Internet Explorer 6 (among other, proper, browsers).</p>


	<p>I thought it might be useful to paste the script that bootstraps the bookmarklet.  The concept is that we use the bookmarklet javascript to insert a script tag into the page that links to the full javascript file containing the function(s) that we wish to execute.  I know this has been documented elsewhere and I&#8217;ve probably missed some important stuff out but it may prove useful to someone.</p>


	<h3>The commented, un-compressed, version</h3>


<div class="typocode"><pre><code class="typocode_javascript">if (typeof(rvmBM) == 'undefined') { // Best to name rvmBM to something unlikely to clash with pre-defined variables
  var s = document.createElement('script'); // Use of s versus script saves some precious space
  s.type = 'text/javascript';
  s.src = 'http://example.com/my-external-bookmarklet.js'; // The location of your bookmarklet javascript that does all the work
  void(rvmBM = true); // Prevent the bookmarklet javascript from being loaded multiple times by setting this flag
  void(document.body.appendChild(s)); // Place the script tag in the body of the document
  // If we don't use void() above then we end up writing either 'true' or some junk to the screen in Internet Explorer (only)
};
function addRvm() { // A wrapper function around the actual function we want to call
  if (typeof(addReevooMark) == 'function') { // We want to make sure our bookmarklet function is defined (there's some delay in it becoming available in Firefox.  It's defined immediately in Internet Explorer.)
    addReevooMark();
  } else {
    void(setTimeout(addRvm, 100)); // If our function isn't ready yet we'll just hang on 1/10th of a second and try again
  };
};
addRvm(); // Ask our wrapper function to call the actual bookmarklet function</code></pre></div>

	<h3>The compressed version</h3>


<div class="typocode"><pre><code class="typocode_javascript">javascript:if(typeof(rvmBM)=='undefined'){var s=document.createElement('script');s.type='text/javascript';s.src='http://example.com/my-external-bookmarklet.js';void(rvmBM=true);void(document.body.appendChild(s));};function addRvm(){if(typeof(addReevooMark)=='function'){addReevooMark();}else{void(setTimeout(addRvm,100));};};addRvm();</code></pre></div>

              
                <h2>
                  <a href="/articles/2007/12/14/bookmarklet-favelet-limits-in-internet-explorer-6-and-7">Bookmarklet (Favelet) limits in Internet Explorer 6 (and 7?)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 14 Dec 2007 08:46:00">
                    Fri, 14 Dec 2007 08:46:00
                  </span>
                </p>

                <p>I wasted quite a bit of time over the last couple of days trying to get a <a href="http://en.wikipedia.org/wiki/Bookmarklet">bookmarklet</a> (or favelet) working in Internet Explorer 6.  It worked perfectly in Firefox and Safari but wasn&#8217;t doing anything at all in IE.  Through lots of trial and error, I came to the conclusion that it was because of the length of the bookmarklet: it seems that Microsoft <a href="http://www.squarefree.com/2005/01/12/internet-explorer-drops-support-for-bookmarklets/">reduced the maximum length of a bookmarklet in <span class="caps">IE 6</span></a></p>


	<p>Although my original bookmarklet wasn&#8217;t all that long, I had it spread over multiple lines for readability.  The fix in my case was to remove all the spaces and place the bookmarklet on one line.</p>


	<p>I started to think that it might be nice to have a bookmarklet <a href="http://www.rubyonrails.com">rails</a> helper.  The bookmarklet helper would allow you to format your javascript for readability but shorten it all in the resulting html (it could even warn if the bookmarklet is too long for IE).  I couldn&#8217;t find anything similar, and I probably won&#8217;t get around to doing it myself, but I did decide to investigate the limit in IE (which could form the basis of such a helper).</p>


	<p>I used the html page below to test the limits of Internet Explorer.  This is the longest bookmarklet that I could get to work: one more character (a 2 on the end of those numbers, for example) and the bookmarklet won&#8217;t work (it still works if you click the link in the page &#8211; it only fails when used as an actual bookmarklet).</p>


<div class="typocode"><pre><code class="typocode_default">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;a href=&quot;javascript:
      var msg = 'hello world, this is my message.  i\'m trying to see how long i can be until internet explorer blows up in my face.';
      var msg = msg + '\n';
      var msg = msg + 'this is the second line of my long message';
      var msg = msg + '\n';
      var msg = msg + '12345679012345678901';
      alert(msg);&quot;&gt;bookmarklet&lt;/a&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre></div>

	<p>I noticed that, once added to Internet Explorer, the bookmarklet appeared to be <a href="http://www.blooberry.com/indexdot/html/topics/urlencoding.htm"><span class="caps">URL</span> encoded</a> (my assumption was based on the conversion of spaces to %20.)</p>


	<p><a href="http://www.flickr.com/photos/chrisjroos/2109757023/"><img src="http://farm3.static.flickr.com/2321/2109757023_0f69015c44.jpg" alt="" /></a></p>


	<p>I tried to replicate this encoded string in <a href="http://www.ruby-lang.org">ruby</a> but failed:  A simple <span class="caps">URI</span>.escape in ruby was escaping too much.  Inspecting the bookmarklet again seemed to suggest that the only encoding performed is to remove newlines and convert spaces to %20.  Replicating this in irb gave me the same string that Internet Explorer had in its favourites.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">irb</span><span class="punct">)</span> <span class="ident">str</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">javascript:
  var msg = 'hello world, this is my message.  i<span class="escape">\'</span>m trying to see how long i can be until internet explorer blows up in my face.';
  var msg = msg + '<span class="escape">\n</span>';
  var msg = msg + 'this is the second line of my long message';
  var msg = msg + '<span class="escape">\n</span>';
  var msg = msg + '12345679012345678901';
  alert(msg);</span><span class="punct">&quot;</span>
<span class="ident">irb</span><span class="punct">)</span> <span class="ident">p</span> <span class="ident">str</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(&quot;</span><span class="string">'<span class="escape">\n</span>'</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">'--NEW-LINE--'</span><span class="punct">&quot;).</span><span class="ident">gsub</span><span class="punct">(&quot;</span><span class="string"><span class="escape">\n</span></span><span class="punct">&quot;,</span> <span class="punct">'</span><span class="string"></span><span class="punct">').</span><span class="ident">gsub</span><span class="punct">(&quot;</span><span class="string">'--NEW-LINE--'</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">'<span class="escape">\n</span>'</span><span class="punct">&quot;).</span><span class="ident">gsub</span><span class="punct">('</span><span class="string"> </span><span class="punct">',</span> <span class="punct">&quot;</span><span class="string">%20</span><span class="punct">&quot;).</span><span class="ident">length</span>
<span class="punct">=&gt;</span> <span class="number">505</span></code></pre></div>

	<p>Everything I&#8217;d read about these bookmarklets in Internet Explorer suggested that the limit was 508 characters: the length of the bookmarklet above (once encoded) is only 505 characters.  Adding one more character makes it fail as a bookmarklet.  Hmm, maybe I&#8217;m doing something dumb?</p>


	<p>I&#8217;ve cheated a bit in the &#8216;encoding&#8217; above.  IE removes all newlines (I wonder if this happens in the <span class="caps">DOM</span> or just when you add it as a favourite?) so that the bookmarklet appears on one line.  I needed to do the same but also needed those newlines in the msg to remain (hence the <span class="caps">NEW</span>-LINE replacement stuff).  This is a very naive imlpementation: if you have &#8217;\n\n&#8217;, for example, then it breaks.  The &#8216;encoding&#8217; would need to be a little more intelligent in an actual helper (but only if you wanted to report on the size of the bookmarklet).</p>


	<p>I couldn&#8217;t find any reference to source of this 508 character limit in Internet Explorer: all the blog articles just state it as fact.  So, maybe it&#8217;s not 508.  Maybe it&#8217;s actually 505&#8230;</p>

              
                <h2>
                  <a href="/articles/2005/11/26/tadalist-bookmarklet">Tadalist bookmarklet</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 26 Nov 2005 20:30:00">
                    Sat, 26 Nov 2005 20:30:00
                  </span>
                </p>

                <p>I&#8217;ve been aware of, and used periodically, <a href="http://www.tadalists.com">tadalist</a> from <a href="http://www.37signals.com">37 signals</a>.</p>


	<p>Over about the last week I&#8217;ve started to use tadalist far more.  It&#8217;s great but I really want a way to add items without having to use tada each time.  Apparently there <a href="http://www.keeganjones.com/widgets/tada/">used to be</a> a <a href="http://www.apple.com/uk/downloads/dashboard/">dashboard</a> widget (which would be handy as I use mac&#8217;s at work) but it&#8217;s been long lost.</p>


	<p>I&#8217;d eventually like to develop a dashboard widget myself but until I get there I wondered about developing a <a href="http://en.wikipedia.org/wiki/Bookmarklet">bookmarklet</a> to achieve similar effect.</p>


	<p>I played around for a bit and came up with the following.</p>


<div class="typocode">
<pre>
var new_item=prompt('Add Item');
location.href='http://USERNAME.tadalist.com/item/add?list_id=LISTID&#38;content='+encodeURIComponent(new_item);
alert('Added');
location.href='http://USERNAME.tadalist.com/lists/show/LISTID';
</pre>
</div>

	<p>It even kinda works, although if you press cancel when it prompts for the list text, it will add a new item of null, obviously&#8230;</p>


	<p>If you really feel the need to try this, just copy this <a href="javascript:var new_item=prompt('Add Item'); location.href = 'http://USERNAME.tadalist.com/item/add?list_id=LIST_ID&#38;content='+encodeURIComponent(new_item); alert('Added'); location.href='http://USERNAME.tadalist.com/lists/show/LIST_ID';">link</a> to your bookmarks.  You will need to replace <span class="caps">USERNAME</span> with your username and <span class="caps">LISTID</span> with the id of the list that you want items to be added to.  To find the id (I&#8217;d suggest creating a new list like &#8216;added from browser&#8217;) click on the relevant list in tada and copy the number from the url after lists/show.</p>


	<p>Oh yeah, you will also need to be logged into tada for this to work, otherwise you get a nasty looking <a href="http://www.tadalist.com/no_page_here">error page</a>.</p>

              

            </div>
          </div>
        </div>
        <div class="yui-b">
          <!--#include virtual="/includes/_navigation.html"-->
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <!--#include virtual="/includes/_twitter.html" -->
    <!--#include virtual="/includes/_delicious.html" -->
    <!--#include virtual="/includes/_google_analytics.html" -->
  </body>

</html>
