<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

  <head>
    <!--#include virtual="/includes/_head.html"-->
    <title>Posts tagged rest - deferred until inspiration hits</title>
  </head>
  
  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <!--#include virtual="/includes/_header.html"-->
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">

              
                <h2>
                  <a href="/articles/2007/07/13/web-service-to-convert-uk-postcodes-outcode-to-latitude-and-longitude">Web service to convert UK Postcodes (outcode) to Latitude and Longitude</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 13 Jul 2007 14:41:00">
                    Fri, 13 Jul 2007 14:41:00
                  </span>
                </p>

                <p>Using the data supplied in this <a href="http://postcodes.easypeasy.com">article</a>, by <a href="http://www.niksargent.com">Nik Sargent</a>, I&#8217;ve created a simple web service that returns <a href="http://www.json.org"><span class="caps">JSON</span></a> formatted data about UK Outcodes (the first bit of the postcode).</p>


	<p>The idea is that you can request, for example, /postcodes/se1 and get some json in return.  For se1, we receive the following data.</p>


<div class="typocode"><pre><code class="typocode_default">{&quot;latitude&quot;:&quot;51.498&quot;,&quot;x&quot;:&quot;532600&quot;,&quot;postcode&quot;:&quot;SE1&quot;,&quot;y&quot;:&quot;179500&quot;,&quot;longitude&quot;:&quot;51.498&quot;}</code></pre></div>

	<p>The service is currently running at <a href="http://seagul.co.uk/postcodes">http://seagul.co.uk/postcodes</a> (<a href="http://seagul.co.uk/postcodes/se1">se1</a>) but I make no guarantees as to its reliability.  I&#8217;d suggest that if anyone actually finds this useful that they go host it somewhere for themselves in order to control the availability.</p>


	<p>The code is, as always, on <a href="http://chrisroos.googlecode.com/svn/trunk/uk-postcodes/">google code</a> and pasted below.</p>


	<p>I&#8217;ve created it as a proof of concept but I figure that, given a little love, it may prove useful to some folks.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">mongrel</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">json</span><span class="punct">'</span>

<span class="ident">postcodes_file</span> <span class="punct">=</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/uk-postcodes.json</span><span class="punct">'</span>
<span class="constant">Postcodes</span> <span class="punct">=</span> <span class="constant">JSON</span><span class="punct">.</span><span class="ident">parse</span><span class="punct">(</span><span class="constant">File</span><span class="punct">.</span><span class="ident">open</span><span class="punct">(</span><span class="ident">postcodes_file</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">f</span><span class="punct">|</span> <span class="ident">f</span><span class="punct">.</span><span class="ident">read</span> <span class="punct">})</span>
<span class="constant">Index</span> <span class="punct">=</span> <span class="constant">Postcodes</span><span class="punct">.</span><span class="ident">inject</span><span class="punct">([])</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">index</span><span class="punct">,</span> <span class="ident">postcode</span><span class="punct">|</span> <span class="ident">index</span> <span class="punct">&lt;&lt;</span> <span class="ident">postcode</span><span class="punct">['</span><span class="string">postcode</span><span class="punct">'].</span><span class="ident">downcase</span> <span class="punct">}</span>

<span class="keyword">class </span><span class="class">PostcodeHandler</span> <span class="punct">&lt;</span> <span class="constant">Mongrel</span><span class="punct">::</span><span class="constant">HttpHandler</span>
  <span class="keyword">def </span><span class="method">process</span><span class="punct">(</span><span class="ident">request</span><span class="punct">,</span> <span class="ident">response</span><span class="punct">)</span>
    <span class="ident">outcode</span> <span class="punct">=</span> <span class="ident">request</span><span class="punct">.</span><span class="ident">params</span><span class="punct">['</span><span class="string">PATH_INFO</span><span class="punct">'].</span><span class="ident">sub</span><span class="punct">(/</span><span class="regex">^<span class="escape">\/</span></span><span class="punct">/,</span> <span class="punct">'</span><span class="string"></span><span class="punct">').</span><span class="ident">downcase</span>
    <span class="ident">postcode_index</span> <span class="punct">=</span> <span class="constant">Index</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span><span class="ident">outcode</span><span class="punct">)</span>
    <span class="keyword">if</span> <span class="ident">postcode_index</span>
      <span class="ident">response</span><span class="punct">.</span><span class="ident">start</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">head</span><span class="punct">,</span> <span class="ident">out</span><span class="punct">|</span>
        <span class="ident">head</span><span class="punct">[&quot;</span><span class="string">Content-Type</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">text/plain</span><span class="punct">&quot;</span>
        <span class="ident">out</span> <span class="punct">&lt;&lt;</span> <span class="constant">Postcodes</span><span class="punct">[</span><span class="ident">postcode_index</span><span class="punct">].</span><span class="ident">to_json</span>
      <span class="keyword">end</span>
    <span class="keyword">else</span>
      <span class="ident">response</span><span class="punct">.</span><span class="ident">start</span><span class="punct">(</span><span class="number">404</span><span class="punct">)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">head</span><span class="punct">,</span><span class="ident">out</span><span class="punct">|</span>
        <span class="ident">out</span> <span class="punct">&lt;&lt;</span> <span class="punct">&quot;</span><span class="string">Postcode not found<span class="escape">\n</span></span><span class="punct">&quot;</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="ident">config</span> <span class="punct">=</span> <span class="constant">Mongrel</span><span class="punct">::</span><span class="constant">Configurator</span><span class="punct">.</span><span class="ident">new</span> <span class="symbol">:host</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">localhost</span><span class="punct">',</span> <span class="symbol">:port</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">4000</span><span class="punct">'</span> <span class="keyword">do</span>
  <span class="ident">listener</span> <span class="keyword">do</span>
    <span class="ident">uri</span> <span class="punct">&quot;</span><span class="string">/postcodes</span><span class="punct">&quot;,</span> <span class="symbol">:handler</span> <span class="punct">=&gt;</span> <span class="constant">PostcodeHandler</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>
  <span class="ident">trap</span><span class="punct">(&quot;</span><span class="string">INT</span><span class="punct">&quot;)</span> <span class="punct">{</span> <span class="ident">stop</span> <span class="punct">}</span>
  <span class="ident">run</span>
<span class="keyword">end</span>

<span class="ident">config</span><span class="punct">.</span><span class="ident">join</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/mongrel" rel="tag">mongrel</a>, 
                    
                      <a href="/articles/tag/outcodes" rel="tag">outcodes</a>, 
                    
                      <a href="/articles/tag/postcodes" rel="tag">postcodes</a>, 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/service" rel="tag">service</a>, 
                    
                      <a href="/articles/tag/web" rel="tag">web</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/04/14/small-specific-mongrel-web-servers">Small, specific mongrel web servers</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 14 Apr 2007 00:44:00">
                    Sat, 14 Apr 2007 00:44:00
                  </span>
                </p>

                <p>I&#8217;ve created a simple <a href="http://mongrel.rubyforge.org/">mongrel</a> server that allows you to upload text files for subsequent deletion and retrieval.  If it sounds pretty pointless, that&#8217;s because it is&#8230;currently.  I wonder though, if the basic premise couldn&#8217;t be used to create some text-transformation tools.  I&#8217;m thinking of really simple tools that might spell-check a text file, or convert text from <a href="http://www.textism.com/tools/textile/">textile</a> to html.  My end goal would be to have lots of super simple tools that I can chain together to use as a blogging platform, removing my current dependence on <a href="http://trac.typosphere.org/">typo</a>.</p>


	<p>I&#8217;ve made the <a href="http://chrisroos.googlecode.com/svn/trunk/text_file_server/server.rb">server</a> slightly more complex than it needs to be by imposing some artificial constraints (<a href="http://chrisroos.googlecode.com/svn/trunk/text_file_server/server-test.rb">examples</a>).  The basic premise is that you <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.5">post</a> a text file, between 1 and 5000 bytes in size, with a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.17">content-type</a> of <a href="http://www.iana.org/assignments/media-types/text/">plain/text</a>.  All being well, the server responds with <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.2">201 Created</a> and the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.30">location</a> of the new resource.  The resource is actually retrieved by <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.7">deleting</a> it &#8211; the contents of the file are returned in the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.3">body</a> with a &#8220;200 OK&#8221; response.  I&#8217;ve tried to use the relevant <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4"><span class="caps">HTTP</span> error</a> when resource creation fails.  The whole &#8216;post&#8217; and &#8216;delete&#8217; pattern for these transformations feels kinda <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">restful</a>, but I may be way off the mark.</p>


	<p>I&#8217;m wondering how much of <a href="http://pipes.yahoo.com/pipes/">yahoo pipes</a> could be replicated with lots of small, specific web servers.</p>


	<p>Anyone have any thoughts on any of this?</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/http" rel="tag">http</a>, 
                    
                      <a href="/articles/tag/mongrel" rel="tag">mongrel</a>, 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/restful" rel="tag">restful</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/servers" rel="tag">servers</a>, 
                    
                      <a href="/articles/tag/web" rel="tag">web</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2007/01/12/combining-distributed-small-tools-as-an-alternative-to-backpack-et-al">Combining distributed small tools as an alternative to Backpack et al</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 12 Jan 2007 11:53:00">
                    Fri, 12 Jan 2007 11:53:00
                  </span>
                </p>

                <p>For a while now, I&#8217;ve been thinking/dreaming of having a number of very specific, distributed services.  These would be no more than additions to the single purpose services we already use (notably, in my case, <a href="http://flickr.com">flickr</a> for photos, this blog for articulating thought and <a href="http://del.icio.us">del.icio.us</a> for storing bookmarks).  Some additions I&#8217;d like to see<sup><a href="#fn1">1</a></sup> are:</p>


	<ul>
	<li>A way to record and tag financial transactions

	<p>Although I want to be able to record the transactions in some kind of accounting app, I also want each transaction to be a resource on the web that I can link to and bookmark (a RESTful accounts app if you like)</p></li>
	</ul>


	<ul>
	<li>A way to record and tag any text (i.e. thoughts and ideas that are not quite blog posts)

	<p>To be fair, a secondary blog could be set-up to do this.</p></li>
	</ul>


	<ul>
	<li>A way to add multiple comments to any resource on the web

	<p>Think &#8211; being able to bookmark the same uri multiple times in del.icio.us with different notes against each bookmark.  Actually, I wonder why these sort of distributed comment systems are not more prevalent &#8211; it seems kinda odd that every blogging engine re-implements something that could be done once, and done well.</p></li>
	</ul>


	<ul>
	<li>A way to expose an email or an email conversation at a given uri (a permailink maybe? he he)

	<p>I think one immediate benefit of this is the ability to share emails with people in the same organisation/group as you without having to forward them all on.</p></li>
	</ul>


	<p>So, how would having these types of services help us re-create a backpack type page at present?</p>


	<p>Well, I&#8217;m not sure how good this example is, but let&#8217;s think of selling an item on <a href="http://www.ebay.co.uk">ebay</a>.  At the moment, I end up with lots of distributed information about a single sale:</p>


	<ul>
	<li>invoices from ebay</li>
		<li>transactions on a statement (from my bank and paypal)</li>
		<li>emails from ebay and buyers</li>
		<li>a page that represents the item on ebay</li>
		<li>pictures of the item on flickr</li>
		<li>physical receipts for posting the item</li>
	</ul>


	<p>This is fine until you want to interrogate the data.  Try finding out how much money you made/lost, when it was sent, who it was sent to, and the problems are obvious.</p>


	<p>One solution would be to record all the information for a given item in a page in backpack (or any similar service &#8211; a simple wiki would do).  But now try to query the data for two items sold, or partially query one item and the problems become evident again.</p>


	<p>I think this is where our funky new distributed system can help.  Following the same ebay selling process as above:</p>


	<ul>
	<li>We create a text snippet that provides us with a placeholder uri for this item.  This would be something like &#8216;sale of computer&#8217;</li>
		<li>We upload photos of the item to flickr, tagged with our placeholder</li>
		<li>We list the item in ebay, tagged with our placeholder</li>
		<li>We record a financial transaction that represents the cost of listing the item, tagged with our placeholder</li>
		<li>We upload any relevant emails from ebay about the listing/sale of our item, tagged with our placeholder</li>
		<li>We record a financial transaction that represents our income from the sale of the item, tagged with our placeholder</li>
		<li>We record a note that states when and how we sent the item, tagged with our placeholder</li>
		<li>We record a financial transaction that represents our cost for sending the item, tagged with our placeholder</li>
	</ul>


	<p>The important thing is that all of these resources are tagged with a common uri.  The uri that represents our item for sale.  At the simplest level, this makes auto-generating a backpack type page very simple &#8211; we just aggregate<sup><a href="#fn2">2</a></sup> all of the data tagged with our item uri.  Tagging these items with a higher level tag, such as &#8216;ebay&#8217;, will allow us to search across multiple sales/purchase.</p>


	<p>Going even further, using opensearch with a simple custom front-end (basically just a parser) gives us even greater querying capabilities.  I could imagine searching for something like &#8220;ebay finance:expenditure&#8221; to get a list of all items (descriptions, notes, pictures etc) we&#8217;ve sold on ebay along with our expenditure.  Our simple search engine would know to search for all items tagged with ebay, but only those transactions that are tagged with expenditure (i.e. costs to us).</p>


	<p>Does this make sense/sound feasible to anyone else?  Indeed, has someone else already presented these ideas in a more legible/understandable way?  It all seems to make great sense to me but I&#8217;ve spent quite a while thinking about it (and what seems like ages just writing this post), meaning there&#8217;s every chance I&#8217;ve missed something obvious.  I&#8217;d appreciate any thoughts.</p>


	<p id="fn1"><sup>1</sup> I did had every intention of developing these things as a proof of concept, but, on the basis that I&#8217;m unlikely to get around to it, and that I do actually think something like this is a good idea, I thought I&#8217;d jot my thoughts here.</p>


	<p id="fn2"><sup>2</sup> I started out thinking that the tags would be stored against the resource itself &#8211; the same way that the tag for a photo in flickr is stored against that photo.  I was also assuming that these services would be <a href="http://opensearch.org">opensearch</a> enabled to allow searching of the tags.  As I&#8217;ve been writing the post I&#8217;ve realised that, providing everything has a uri, we can use del.icio.us as our tagging mechanism and as our search engine.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/distributed" rel="tag">distributed</a>, 
                    
                      <a href="/articles/tag/opensearch" rel="tag">opensearch</a>, 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/software" rel="tag">software</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/11/27/maybe-i-need-some-more-rest">Maybe I need some more REST</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 27 Nov 2006 22:26:00">
                    Mon, 27 Nov 2006 22:26:00
                  </span>
                </p>

                <p>This post isn&#8217;t about sleep deprevation.  Instead, the witty title is referring to everyone&#8217;s newest, favouritist buzzword: <a href="http://www.wikipedia.org/wiki/REST"><span class="caps">REST</span></a> (or Representational State Transfer).</p>


	<p>Scene setting with some things that have happened recently (in roughly this order):</p>


	<ul>
	<li><a href="http://www.reevoo.com/blogs/bengriffiths/">Ben</a> mentions that we need to think about splitting our application up to better distribute the load on servers.  I don&#8217;t completely &#8216;get it&#8217;.</li>
		<li><a href="http://www.rubyonrails.com">Rails</a> gets <a href="http://www.wikipedia.org/wiki/REST"><span class="caps">REST</span></a> support <a href="http://www.ryandaigle.com/articles/2006/08/01/whats-new-in-edge-rails-simply-restful-support-and-how-to-use-it">baked in</a> (Ok, so this is pretty old news now)</li>
		<li>We spent quite a lot of time at <a href="http://www.reevoo.com">work</a> writing code to access the <a href="http://adwords.google.com">google adwords</a> <a href="http://www.google.com/apis/adwords/">soap api</a></li>
		<li>I finally got (thanks to <a href="http://blog.floehopper.org">James</a>) why <a href="http://habtm.com/articles/2006/07/01/if-your-models-arent-namespaced-why-should-your-controllers-be-or-how-i-learned-to-stop-worrying-and-love-the-crud">some</a> rails folk have stated that following a RESTful design frees them up from having namespaced admin controllers.</li>
		<li>I spent quite a bit of time over the last two weeks really looking into the <a href="http://www.ietf.org/rfc/rfc4287.txt">atom syndication format</a> and <a href="http://www.ietf.org/internet-drafts/draft-ietf-atompub-protocol-11.txt">atom publishing protocol</a></li>
		<li>I spent a few hours at the weekend playing with the <a href="http://www.amazon.com/s3">amazon s3</a> service</li>
		<li><a href="http://wanderingbarque.com/nonintersecting/2006/11/15/the-s-stands-for-simple/">This</a> popped up recently and got an incredible amount of attention.</li>
		<li>I read an <a href="http://www.acmqueue.com/modules.php?name=Content&#38;pa=showpage&#38;pid=388">interview</a> with <a href="http://www.allthingsdistributed.com/">Werner Vogel</a> (CTO of Amazon) that talks about everything being a service.  One quote in particular caught my attention.</li>
	</ul>


	<blockquote>
		<p>If you hit the Amazon.com gateway page, the application calls more than 100 services to collect data and construct the page for you.</p>
	</blockquote>


	<ul>
	<li>I took the plunge and just about stayed awake through <a href="http://roy.gbiv.com/pubs/dissertation/top.htm">The Document</a>.  I found chapter 6 (and in particular 6.3.4) the most relevant as it explains <span class="caps">REST</span> in the context of the <span class="caps">URI</span> and <span class="caps">HTTP</span>.  I tend to drift off on when things are explained without real examples.</li>
		<li>I watched <a href="http://nubyonrails.com">Geoffrey Grosenbach&#8217;s</a> <a href="http://www.peepcode.org">peepcode</a> screencast on <a href="http://peepcode.com/articles/2006/10/08/restful-rails">restful rails</a>.</li>
		<li>I worked out how to use <a href="http://del.icio.us">del.icio.us</a> and subscribed to some of the tags (keywords) mentioned above.</li>
	</ul>


	<p>Wow.  You&#8217;d think with all that reading, listening and viewing I&#8217;d be right up on the subject.  Sadly I don&#8217;t feel as though that&#8217;s quite the case.</p>


	<p>Now.  I do see an advantage of a RESTful approach (particular the style currently advocated in <a href="http://www.rubyonrails.com">rails</a>), over <span class="caps">SOAP</span>, when dealing with something like the google adwords api<sup><a href="#fn1">1</a></sup>.  But, what about services like currency conversion and syntax highlighting?  I can&#8217;t get these to fit into a RESTful style in my head (I guess I can&#8217;t find the resource in each case).  Instead, I see them as analogous to unix command line applications: pipe simple data in (an amount with two curencies or ruby code) and get simple data out (an amount in the new currency or syntax-highlighted ruby code).  Actually, I see them as remote procedure calls.  Are these types of services incompatible with the <span class="caps">REST</span> architectural style or have I missed something?  I&#8217;m starting to wonder if I&#8217;m getting too hung up on <span class="caps">REST</span> = <span class="caps">CRUD</span> and therefore missing some of the more fundamental points.  Either way, I definitely feel that it&#8217;d be good to see some more concrete examples in the <span class="caps">REST</span> vs <span class="caps">SOAP</span>/RPC/SOA arguments.  As stated above, I&#8217;m not so great in the abstract.</p>


	<p id="fn1"><sup>1</sup> I had a few problems when interacting with the adwords api.  I don&#8217;t, however, feel that I have enough information to know whether the pain was caused by <a href="http://dev.ctor.org/soap4r">soap4r</a>, <a href="http://en.wikipedia.org/wiki/SOAP">soap</a>, the <a href="http://www.google.com/apis/adwords/">api</a> or just my lack of knowledge.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/rpc" rel="tag">rpc</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/soap" rel="tag">soap</a>, 
                    
                  </p>
                
              

            </div>
          </div>
        </div>
        <div class="yui-b">
          <!--#include virtual="/includes/_navigation.html"-->
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <!--#include virtual="/includes/_twitter.html" -->
    <!--#include virtual="/includes/_delicious.html" -->
    <!--#include virtual="/includes/_google_analytics.html" -->
  </body>

</html>
