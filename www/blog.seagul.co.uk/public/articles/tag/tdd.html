<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

  <head>
    <meta name="microid" content="ff511e16d7108be450fccd6f4611cf8d1d5416d1" >
    <meta http-equiv="content-type" content="text/html; charset=utf-8" >
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/DeferredUntilInspirationHits" >
    <link rel="stylesheet" href="http://yui.yahooapis.com/2.5.1/build/reset-fonts-grids/reset-fonts-grids.css" type="text/css" media="all">
    <link rel="stylesheet" href="/blog.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="/syntax.css" type="text/css" media="screen" charset="utf-8">
    <link rel="openid.server" href="http://www.myopenid.com/server">
    <link rel="openid.delegate" href="http://chrisroos.myopenid.com/">
    <title>Posts tagged tdd - deferred until inspiration hits</title>
  </head>
  
  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <h1><a class="blogTitle" href="/">deferred until inspiration hits</a></h1>
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">

              
                <h2>
                  <a href="/articles/2007/09/27/why-should-it-do-that">Why should it do that?</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 27 Sep 2007 07:36:00">
                    Thu, 27 Sep 2007 07:36:00
                  </span>
                </p>

                <p>I&#8217;ve started looking into my *cough* promise *cough* to do that <a href="http://blog.seagul.co.uk/articles/2007/06/01/an-open-letter-to-my-local-newspapers">local paper</a> site I mentioned sometime ago.  The code is all in me <a href="http://chrisroos.googlecode.com">google code</a> <a href="http://chrisroos.googlecode.com/svn/trunk/the-local-paper/">repository</a> if you want to see how it&#8217;s going (or finish it when I inevitably get bored again&#8230;).</p>


	<p>Anyway, the point of this post is that I realised something about testing that I feel I may have missed in the past.  I&#8217;ve got used to stating the <a href="http://behaviour-driven.org/">behavior</a> of the objects in my system through tests.  So, when I wanted to ensure that an article couldn&#8217;t be created without a title, I added a test like so:</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">ArticleTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">test_should_validate_presence_of_title</span>
    <span class="punct">...</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>In fact, for an article comprised of a title, an edition, a page number and an author, I wanted to ensure that all were there apart from the author.  It was only once I&#8217;d added tests to <a href="http://api.rubyonrails.org/classes/ActiveRecord/Validations.html">validate</a> the presence of the other three attributes that I realised it was probably important to prove that an author wasn&#8217;t required.  So, I added the relevant test.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">ArticleTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">test_should_not_validate_presence_of_author</span>
    <span class="punct">...</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>That&#8217;s all well and good, but I&#8217;ve lost some information: <span class="caps">WHY</span> it shouldn&#8217;t validate the presence of an author.  I know at the moment why it shouldn&#8217;t (because short articles don&#8217;t have an author listed), but will I know at some point the future?  I suspect not.  The same obviously applies for the things that I do want to ensure are present.  Why do I care that an article has a title, edition and page number?  At the moment I care because I&#8217;m planning on making them part of the <span class="caps">URL</span>, but what if I decide not to go down that route, yet leave the tests there?  There&#8217;ll be no easy way for someone in the future to determine whether those things are actually important or not.</p>


	<p>I wonder if this issue was highlighted because of my lack of <a href="http://subversion.tigris.org/"><span class="caps">SVN</span></a> access.  I generally like really small checkins to my <a href="http://en.wikipedia.org/wiki/Revision_control">version control software</a> which would&#8217;ve allowed me to have added and committed those validation additions one at a time, and with messages that would have stated the reasons for that change<sup><a href="#fn1">1</a></sup>.  Being disconnected means that I end up with bigger checkins that inevitably lose some information.  Actually, the more I think about it, the more I think that the repository isn&#8217;t the right place for this information anyway &#8211; it&#8217;s too far away from the code that&#8217;s solving the problems.</p>


	<p>How do other people solve this potential loss of knowledge?  Am I missing something obvious, or have I really just not noticed this before?</p>


	<p>P.S. I spent a few minutes chatting with <a href="http://interblah.net/">James</a> about it today and he had some interesting suggestions, although I&#8217;ll leave it up to him to share those if he wants (no pressure James, I&#8217;m just running out of time right now I&#8217;m afraid).</p>


	<p id="fn1"><sup>1</sup> <a href="http://po-ru.com">Paul</a> suggested a while back that we use the commit note to explain the problem that we&#8217;ve solved, rather than just describing the changeset.  Unfortunately, I can&#8217;t find the source of that suggestion so no link I&#8217;m afraid.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/agiledox" rel="tag">agiledox</a>, 
                    
                      <a href="/articles/tag/bdd" rel="tag">bdd</a>, 
                    
                      <a href="/articles/tag/development" rel="tag">development</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/tdd" rel="tag">tdd</a>, 
                    
                      <a href="/articles/tag/test" rel="tag">test</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/17/some-realisations-about-testing">Some realisations about testing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 17 Jul 2006 09:19:00">
                    Mon, 17 Jul 2006 09:19:00
                  </span>
                </p>

                <p>Having been predominantly involved in <a href="http://www.rubyonrails.com">Rails</a> development just recently, <a href="http://api.rubyonrails.com/classes/Fixtures.html">fixtures</a> have taken on a slightly different meaning to what I now believe to be the original understanding.  Having recently re-read <a href="http://www.amazon.co.uk/gp/product/0321146530/202-8808398-1811851?v=glance&#38;n=266239">Test Driven Development: By Example</a> I re-discovered the &#8216;original&#8217; meaning of the word (essentially shared objects used by all tests in a test case).</p>


	<p>This has made me think about the way that I&#8217;ve been structuring my tests (or not structuring them as the case may be).  I have never been a fan of the setup and teardown methods provided to us in <a href="http://en.wikipedia.org/wiki/XUnit">xUnit</a> and I now believe this to be due to my misunderstanding of the term fixture and therefore their intention.  This has led to my test cases growing very large and containing many disparate tests.  If there was any separation of the testcase then it was usually based on functionality of a particular method (which separately leads me to believe that they may have been better expressed in a new object).  I now understand that test cases should be split to contain tests that rely on a common test fixture.  As soon as I started to do this, the setup and (to a lesser degree) teardown methods have become much more useful.</p>


	<p>I&#8217;ve also started to create my test cases as anonymous classes derived from Test::Unit::TestCase.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Class</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span><span class="punct">)</span> <span class="keyword">do</span>
  <span class="keyword">def </span><span class="method">test_</span>
    <span class="ident">assert</span> <span class="constant">true</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>I find that this helps when trying to determine where a new test should be placed.  If the class has a name I&#8217;m tempted to scan that and make a decision as to whether a new test belongs in this case.  By keeping them anonymous, I have to inspect the test fixture in order to understand whether a new test belongs here.</p>


	<p><strong>Note</strong> I may also add a comment right below Class.new to explicitly specify the fixture for this testcase.  This may seem to go against not naming the classes in the first place but I think part of the problem with class names is the lack of punctuation and therefore the difficulty in clearly expressing the test fixture.</p>


	<p>I&#8217;ve chosen a somewhat contrived example to demonstrate my new found test structure.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Class</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span><span class="punct">)</span> <span class="keyword">do</span>
  <span class="comment"># An empty stack</span>

  <span class="keyword">def </span><span class="method">setup</span>
    <span class="attribute">@stack</span> <span class="punct">=</span> <span class="constant">Stack</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_accept_an_item_when_sent_push</span>
    <span class="ident">assert_nothing_raised</span> <span class="punct">{</span> <span class="attribute">@stack</span><span class="punct">.</span><span class="ident">push</span><span class="punct">(</span><span class="number">1</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_complain_when_sent_top</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">StackUnderflowError</span><span class="punct">)</span> <span class="punct">{</span> <span class="attribute">@stack</span><span class="punct">.</span><span class="ident">top</span> <span class="punct">}</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_complain_when_sent_pop</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">StackUnderflowError</span><span class="punct">)</span> <span class="punct">{</span> <span class="attribute">@stack</span><span class="punct">.</span><span class="ident">pop</span> <span class="punct">}</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

	<p>The fixture for this test is an empty stack.  The individual tests prod and query the empty stack to ensure that it behaves as expected.  Although the example above is incredibly simple, I have consistently found that my individual test methods become much smaller.</p>


	<p>Notice that the names of the tests all start &#8216;test_should&#8217;.  Not only does this help us think about the responsibilities of the object; but it enables us to maintain living system specifications based on the tests.  I believe this idea first came from <a href="http://agiledox.sourceforge.net/index.html">testdox for Java</a> but was introduced to me by <a href="http://www.reevoo.com/blogs/bengriffiths/">Ben</a> at <a href="http://www.reevoo.com">work</a>.  In fact Ben has written a cool <a href="http://www.reevoo.com/blogs/bengriffiths/2006/04/05/rails-agiledox-browser/">Agiledox server</a> that displays the system specifications for your rails project.</p>


	<p>The realisations set out above have come at around the same time as my taking more of an interest in <a href="http://rspec.rubyforge.org/">rSpec</a> (the stack test above has been adapted directly from one of the rSpec examples); a <a href="http://behaviour-driven.org/">behaviour driven development</a> framework for <a href="http://www.ruby-lang.org">ruby</a>.  I haven&#8217;t done any real work with rSpec yet but am hoping it might improve the way I think of both testing and OO design in general.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/agiledox" rel="tag">agiledox</a>, 
                    
                      <a href="/articles/tag/bdd" rel="tag">bdd</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/rspec" rel="tag">rspec</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/tdd" rel="tag">tdd</a>, 
                    
                  </p>
                
              

            </div>
          </div>
        </div>
        <div class="yui-b">
          <img src="/images/me.jpg" width="170px" height="111px" alt="Me">
          <ul class="navigation">
            <li>
              <a href="/contents">contents</a>
            </li>
            <li>
              <a href="http://twitter.com/chrisroos">twitter</a>
            </li>
            <li>
              <a href="http://flickr.com/photos/chrisjroos">flickr</a>
            </li>
            <li>
              <a href="http://del.icio.us/chrisjroos">del.icio.us</a>
            </li>
          </ul>
          <div id="twitter_div">
            <h3><a href="http://twitter.com/chrisroos">twitter</a></h3>
            <ul id="twitter_update_list"></ul>
          </div>
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
    <script type="text/javascript" src="http://twitter.com/statuses/user_timeline/chrisroos.json?callback=twitterCallback2&count=5"></script>
  
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-160238-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>
  </body>

</html>