--- 
:published_at: 2006-06-21 08:10:00 +01:00
:body: "In testing (and production code) \"we\":http://www.reevoo.com always try to persist \"Active Record\":http://api.rubyonrails.com/classes/ActiveRecord/Base.html models with the bang variants (save! and create!).  This allows us to \"fail fast\":http://www.martinfowler.com/ieeeSoftware/failFast.pdf if any of our models fail our  \"validation\":http://api.rubyonrails.com/classes/ActiveRecord/Validations/ClassMethods.html rules.\r\n\
  \r\n\
  The problem is that the standard \"test/unit\":http://ruby-doc.org/stdlib/libdoc/test/unit/rdoc/index.html reporting framework displays the exception without any details of why the validation failed.\r\n\
  \r\n\
  <div class=\"code\">\r\n\
  <pre>\r\n 1) Error:\xE2\x80\x8B\r\n\
  test_should_fail_validation(AardvarkTest):\xE2\x80\x8B\r\n\
  ActiveRecord::RecordInvalid:\xE2\x80\x8BActiveRecord::RecordInvalid\r\n   /opt/local/lib/ruby/gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:711:in 'save!'\r\n   /opt/local/lib/ruby/gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:673:in 'create!'\r\n   /Users/chrisroos/dev/example_rails/test/unit/aardvark_test.rb:22:in 'test_should_fail_validation'\r\n\
  \r\n\
  1 tests, 0 assertions, 0 failures, 1 errors\r\n\
  </pre>\r\n\
  </div>\r\n\
  \r\n\
  *Note.* This isn't the fault of test/unit.  It has to deal with generic exceptions and so cannot 'know' that Active Record Exceptions can be used to find the reason for the failure.\r\n\
  \r\n\
  At this point, it would be very easy to jump into the code of the Active Record model, check out the validations and satisfy them within your code.  However, it'd be much cooler if we could just add the reason for the failures to the error message that is displayed.\r\n\
  \r\n\
  I initially played around with a method that took a block and would wrap the block with a begin/rescue clause to explicitly catch RecordInvalid exceptions, displaying the reason for failure.\r\n\
  \r\n\
  Then I thought it'd be cool if we could integrate slightly more with both test/unit and \"rails\":http://www.rubyonrails.com.  The result is a \"plugin\":http://wiki.rubyonrails.org/rails/pages/Plugins (\"source\":http://dev.seagul.co.uk/repository/browse/plugins/test_unit_active_record_errors) that can be installed as follows.\r\n\
  \r\n\
  <div class=\"code\">\r\n\
  <pre>\r\n\
  script/plugin install svn://dev.seagul.co.uk/plugins/test_unit_active_record_errors\r\n\
  </pre>\r\n\
  </div>\r\n\
  \r\n\
  The output from a failed validation now includes the validation errors.  Yay.\r\n\
  \r\n\
  <div class=\"code\">\r\n\
  <pre>\r\n 1) Error:\xE2\x80\x8B\r\n\
  test_should_fail_validation(AardvarkTest):\xE2\x80\x8B\r\n\
  ActiveRecord::RecordInvalid: ActiveRecord::RecordInvalid\r\n   /opt/local/lib//gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:711:in `save!'\r\n   /opt/local/lib/ruby/gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:673:in `create!'\r\n   /Users/chrisroos/dev/example_rails/test/unit/aardvark_test.rb:22:in `__test_should_fail_validation_without_custom_error_handling'\r\n   /Users/chrisroos/dev/example_rails/config/../vendor/plugins/test_unit_active_record_errors/lib/test_unit_active_record_errors.rb:29:in `__send__'\r\n   /Users/chrisroos/dev/example_rails/config/../vendor/plugins/test_unit_active_record_errors/lib/test_unit_active_record_errors.rb:29:in `test_should_fail_validation'\r\n   /Users/chrisroos/dev/example_rails/config/../vendor/plugins/test_unit_active_record_errors/lib/test_unit_active_record_errors.rb:27:in `test_should_fail_validation'\r\n\
  ActiveRecord Errors:\xE2\x80\x8BSurname can't be blank, Email can't be blank\r\n\
  \r\n\
  1 tests, 0 assertions, 0 failures, 1 errors\r\n\
  </pre>\r\n\
  </div>\r\n\
  \r\n\
  The code is pretty hacky and includes no tests.  It's only been tested on Mac Os X 10.4.6 with Ruby 1.8.2 and Rails 1.0.0 but please feel free to do what you will with it if you think it might be of some use to you."
:title: More helpful messages for Active Record validation errors in Rails testing
:guid: 185128fa-7400-4685-b909-6a94fa0fca87
